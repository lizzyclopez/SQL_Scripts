--PROCEDURE [dbo].[Get_AFE_Detail_ConsolidatedTower] 
drop view [dbo].[SP_Get_AFE_Resource_Detail_Airline_View]
drop view [dbo].[SP_Get_AFE_Resource_Detail_Airline_View2]
drop table #TEMP_IN
drop table #TEMP_OUT

-- Create new temp VIEW.
DECLARE @SQL_statement varchar(1000)
set @SQL_statement = 'Create View dbo.SP_Get_AFE_Resource_Detail_Airline_View AS select AFE_Resource_Summary_View.*, CO_Resource.Onshore, CO_Resource.Offshore, CO_Resource.Hourly, CO_BillingCode.Billing_CodeID, CO_BillingCode.Description AS NewBillingType
from AFE_Resource_Summary_View inner join CO_Resource ON AFE_Resource_Summary_View.ResourceNumber = CO_Resource.ResourceNumber inner join CO_BillingCode ON CO_BillingCode.Billing_CodeID = CO_Resource.Billing_CodeID
where WorkDate >= ''2019-05-01'' and WorkDate <= ''2019-05-31'' '  -- and Hours > 0' 
exec (@SQL_statement)

-- Copy the data from the temp VIEW into #TEMP_IN working storage.
select ProgramGroup, Program, AFEDesc, ITSABillingCat, ProjectTitle, TaskName, ResourceName, billingid, Prog_GroupID, ProgramID, AFE_DescID, Client, NewBillingType, TaskClientFundingPct, TaskClientFundedBy, Funding_CatID, ResourceNumber, ProjectID, TaskID, sum(hours) as hours, COBusinessLead, UA_VicePresident, Onshore, Offshore, Hourly
into #TEMP_IN from dbo.SP_Get_AFE_Resource_Detail_Airline_View 	group by ProgramGroup, Program, AFEDesc, ITSABillingCat, ProjectTitle, TaskName, ResourceName, billingid, Prog_GroupID, ProgramID, AFE_DescID, Client, NewBillingType, TaskClientFundingPct, TaskClientFundedBy, Funding_CatID, ResourceNumber, ProjectID, TaskID, COBusinessLead, UA_VicePresident, Onshore, Offshore, Hourly	order by ProgramGroup, Program, AFEDesc, ProjectTitle, TaskName, ResourceName

-- Alter table definitions.
ALTER TABLE #TEMP_IN ADD Appr_FTE_Hours decimal(7,2) NULL
ALTER TABLE #TEMP_IN ADD CurrentMonth varchar(6) NULL
ALTER TABLE #TEMP_IN ALTER COLUMN ResourceNumber varchar(15) NULL
ALTER TABLE #TEMP_IN ALTER COLUMN NewBillingType varchar(50) NULL
ALTER TABLE #TEMP_IN ALTER COLUMN TaskID varchar(100) NULL
ALTER TABLE #TEMP_IN ALTER COLUMN ProjectID varchar(100) NULL

-- Create the second temp VIEW.
--DECLARE @SQL_statement varchar(1000)
set @SQL_statement = 'Create View dbo.SP_Get_AFE_Resource_Detail_Airline_View2 AS select dbo.lkITSABillingCategory.Description AS ITSABillingCat, FTE_Approved_Time.* from FTE_Approved_Time LEFT OUTER JOIN	dbo.tblAFEDetail 		ON FTE_Approved_Time.AFE_DescID = dbo.tblAFEDetail.AFE_DescID  		LEFT OUTER JOIN dbo.lkITSABillingCategory ON dbo.tblAFEDetail.ITSABillingCategoryID = dbo.lkITSABillingCategory.ITSABillingCategoryID 
where Appr_FTE_Hours > 0 and CurrentMonth = ''201905'' '
exec (@SQL_statement)

-- Copy the data from the second temp VIEW into #TEMP_IN.
insert #TEMP_IN (AFEDesc, Program, ProgramGroup, UA_VicePresident, Prog_GroupID, ProgramID, Appr_FTE_Hours, CurrentMonth, AFE_DescID, Funding_CatID, COBusinessLead, ITSABillingCat)
select AFEDesc, Program, ProgramGroup, UA_VicePresident, Prog_GroupID, ProgramID, Appr_FTE_Hours, CurrentMonth, AFE_DescID, Funding_CatID ,COBusinessLead, ITSABillingCat from dbo.SP_Get_AFE_Resource_Detail_Airline_View2

-- Adjust the Hours according to the ClientFundingPct by CO
update #TEMP_IN set Hours = isnull(TaskClientFundingPct,100)/100*Hours where isnull(TaskClientFundingPct,0) > 0

---------------------------------------------------------------------------------------------------
--drop table #TEMP_OUT
-- Create the output table #TEMP_OUT.
CREATE TABLE [dbo].[#TEMP_OUT] ( 
	[AutoKey][int] IDENTITY (0, 1) NOT NULL, [RecNumber][int] NULL, [RecType] [varchar] (100) NULL, [RecDesc] [varchar] (100) NULL, [RecTypeID] [varchar] (100) NULL, [ITSABillingCat] [varchar] (30) NULL, [FundingCat] [varchar] (30) NULL, [AFENumber] [varchar] (20) NULL, [UAVP] [varchar] (50) NULL, [COBusinessLead] [varchar] (100) NULL, [ProgramMgr] [varchar] (50) NULL, [Location] [varchar] (30) NULL,
	[TotalHours] [decimal](10,2) NULL, [TotalFTEs] [decimal](10,2) NULL, [TotalFTPs] [decimal](10,2) NULL, [ActualFTEs] [decimal](10,2) NULL, [COApprovedFTEs] [decimal](10,2) NULL, [EDSVariance] [decimal](10,2) NULL,
	[JrSEOnshoreHours] [decimal](10,2) NULL, [JrSeOffshoreHours] [decimal](10,2) NULL, [MidSEOnshoreHours] [decimal](10,2) NULL, [MidSEOffshoreHours] [decimal](10,2) NULL, [AdvSEOnshoreHours] [decimal](10,2) NULL, [AdvSEOffshoreHours] [decimal](10,2) NULL, [SenSEOnshoreHours] [decimal](10,2) NULL, [SenSEOffshoreHours] [decimal](10,2) NULL, [ConsArchOnshoreHours] [decimal](10,2) NULL, [ConsArchOffshoreHours] [decimal](10,2) NULL, [ProjLeadOnshoreHours] [decimal](10,2) NULL, [ProjLeadOffshoreHours] [decimal](10,2) NULL, [ProjMgrOnshoreHours] [decimal](10,2) NULL, [ProjMgrOffshoreHours] [decimal](10,2) NULL, [ProgMgrOnshoreHours] [decimal](10,2) NULL, [ProgMgrOffshoreHours] [decimal](10,2) NULL, [JrProjMgrOffshoreHours] [decimal](10,2) NULL, [JrProgMgrOffshoreHours] [decimal](10,2) NULL, [SrProjMgrOffshoreHours] [decimal](10,2) NULL, [SrProgMgrOffshoreHours] [decimal](10,2) NULL						
) ON [PRIMARY]

-- Add FTP Staff Aug columns and other.
ALTER TABLE #TEMP_OUT ADD FTPStaffAugOnshoreHours decimal(10,2) NULL
ALTER TABLE #TEMP_OUT ADD FTPStaffAugOffshoreHours decimal(10,2) NULL
ALTER TABLE #TEMP_OUT ADD R10_ProgramGroup varchar(100) NULL
ALTER TABLE #TEMP_OUT ADD R20_Program varchar(100) NULL
ALTER TABLE #TEMP_OUT ADD R30_AFEDesc varchar(100) NULL
ALTER TABLE #TEMP_OUT ADD R40_Project varchar(100) NULL
ALTER TABLE #TEMP_OUT ADD R50_Task varchar(100) NULL

---------------------------------------------------------------------------------------------------
-- Populate summary rows.
insert #TEMP_OUT (RecNumber, RecType, RecDesc) select 0, 'GrandTotal', 'Total United (UA)'
insert #TEMP_OUT (RecNumber, RecType, RecDesc) select 0, 'GrandTotalConversion', 'FTE Conversion'
insert #TEMP_OUT (RecNumber, RecType, RecDesc) select 1, 'TotalAirline', 'Total Airline'
insert #TEMP_OUT (RecNumber, RecType, RecDesc) select 1, 'TotalAirlineConversion', 'FTE Conversion'
insert #TEMP_OUT (RecNumber, RecType, RecDesc) select 2, 'TotalADM', 'Total ADM'
insert #TEMP_OUT (RecNumber, RecType, RecDesc) select 2, 'TotalADMConversion', 'FTE Conversion'
insert #TEMP_OUT (RecNumber, RecType, RecDesc) select 3, 'TotalEMD', 'Total EMD'
insert #TEMP_OUT (RecNumber, RecType, RecDesc) select 3, 'TotalEMDConversion', 'FTE Conversion'
insert #TEMP_OUT (RecNumber, RecType, RecDesc) select 4, 'TotalOutsourceSvcs', 'Total Outsource Svcs'
insert #TEMP_OUT (RecNumber, RecType, RecDesc) select 4, 'TotalOutsourceSvcsConversion', 'FTE Conversion'	
insert #TEMP_OUT (RecNumber, RecType, RecDesc) select 5, 'TotalPSS', 'Total PSS Co Investment'
insert #TEMP_OUT (RecNumber, RecType, RecDesc) select 5, 'TotalPSSConversion', 'FTE Conversion'	
insert #TEMP_OUT (RecNumber, RecType, RecDesc) select 6, 'TotalIROP', 'Total IROP'
insert #TEMP_OUT (RecNumber, RecType, RecDesc) select 6, 'TotalIROPConversion', 'FTE Conversion'	
insert #TEMP_OUT (RecNumber, RecType, RecDesc) select 7, 'TotalStaffAug', 'Total Staff Augmentation (FTE Based)'
insert #TEMP_OUT (RecNumber, RecType, RecDesc) select 7, 'TotalStafAugConversion', 'FTE Conversion'	
insert #TEMP_OUT (RecNumber, RecType, RecDesc) select 8, 'TotalCOSMOSPgm', 'Total COSMOS Pgm'
insert #TEMP_OUT (RecNumber, RecType, RecDesc) select 8, 'TotalCOSMOSPgmConversion', 'FTE Conversion'
insert #TEMP_OUT (RecNumber, RecType, RecDesc) select 9, 'TotalACE', 'Total ACE'
insert #TEMP_OUT (RecNumber, RecType, RecDesc) select 9, 'TotalACEConversion', 'FTE Conversion'
insert #TEMP_OUT (RecNumber, RecType, RecDesc) select 91, 'TotalNDC', 'Total NDC'
insert #TEMP_OUT (RecNumber, RecType, RecDesc) select 91, 'TotalNDCConversion', 'FTE Conversion'

---------------------------------------------------------------------------------------------------
---------------------------------------------------------------------------------------------------
-- Declare variables.
DECLARE @CurProgramGroup varchar(100), @CurProg_GroupID varchar(100), @UPVP varchar (50), @CurProgram varchar(100), @CurProgramID varchar(100), @CurCOBusinessLead varchar(100), @CurAFEDesc varchar(100), @CurAFE_DescID varchar(100), @CurProjectTitle varchar(100), @CurProjID varchar(100), @CurTaskName varchar(100), @CurTaskID varchar(100), @CurResourceName varchar(100), @Billing_Type varchar(50), @Hours decimal(10,2), @MaxProgGroup int, @MaxProg int, @MaxAFEDesc int, @MaxProj bigint, @MaxTask int, @Onshore bit, @Offshore bit, @Hourly bit
DECLARE @JrSEOnshore decimal(10,2), @JrSEOffshore decimal(10,2), @MidSEOnshore decimal(10,2), @MidSEOffshore decimal(10,2), @AdvSEOnshore decimal(10,2), @AdvSEOffshore decimal(10,2), @SenSEOnshore decimal(10,2), @SenSEOffshore decimal(10,2), @ConsArchOnshore decimal(10,2), @ConsArchOffshore decimal(10,2), @ProjLeadOnshore decimal(10,2), @ProjLeadOffshore decimal(10,2), @ProjMgrOnshore decimal(10,2), @ProjMgrOffshore decimal(10,2), @ProgMgrOnshore decimal(10,2), @ProgMgrOffshore decimal(10,2), @JrProjMgrOffshore decimal(10,2), @JrProgMgrOffshore decimal(10,2), @SrProjMgrOffshore decimal(10,2), @SrProgMgrOffshore decimal(10,2), @TotalHours decimal(10,2), @TotalFTEs decimal(10,2), @TotalFTPs decimal(10,2), @ActualFTEs decimal(10,2), @COApprovedFTEs decimal(10,2), @EDSVariance decimal(10,2)
DECLARE @JrSEOnshoreHours decimal(10,2), @JrSEOffshoreHours decimal(10,2), @MidSEOnshoreHours decimal(10,2), @MidSEOffshoreHours decimal(10,2), @AdvSEOnshoreHours decimal(10,2), @AdvSEOffshoreHours decimal(10,2), @SenSEOnshoreHours decimal(10,2), @SenSEOffshoreHours decimal(10,2), @ConsArchOnshoreHours decimal(10,2), @ConsArchOffshoreHours decimal(10,2), @ProjLeadOnshoreHours decimal(10,2), @ProjLeadOffshoreHours decimal(10,2), @ProjMgrOnshoreHours decimal(10,2), @ProjMgrOffshoreHours decimal(10,2), @ProgMgrOnshoreHours decimal(10,2), @ProgMgrOffshoreHours decimal(10,2), @JrProjMgrOffshoreHours decimal(10,2), @JrProgMgrOffshoreHours decimal(10,2), @SrProjMgrOffshoreHours decimal(10,2), @SrProgMgrOffshoreHours decimal(10,2)
DECLARE @FTPStaffAugOnshore decimal(10,2), @FTPStaffAugOffshore decimal(10,2), @FTPStaffAugOnshoreHours decimal(10,2), @FTPStaffAugOffshoreHours decimal(10,2), @FTPBillingRate decimal(10,2), @year int, @month int, @BillableDays int, @OnshoreFTERate decimal(10,2), @OffshoreFTERate decimal(10,2)

---for testing only
DECLARE @ITSABillingCatSelection varchar(30), @ITSABillingCat varchar(30), @DateFrom datetime,  @DateTo datetime 
set @DateFrom = '2019-05-01'
set @DateTo = '2019-05-31'
set @ITSABillingCatSelection = '-1'

-- Get the FTE Billing hours for FTP records and set the FTE rate.
select @year = datepart(year, @DateFrom) 
select @month = datepart(month, @DateFrom) 
select @BillableDays = BillableDays from CO_PTD_Calendar where Year = @year and Month = @month
if @BillableDays > 0
	begin
	set @FTPBillingRate = 8 * @BillableDays
	end
else
	begin
	set @FTPBillingRate = '143.5'
	end

--Set the FTE rate for onshore and offshore (non FTP).
set @OnshoreFTERate = '149'
set @OffshoreFTERate = '143.5'

-- ProgramGroup_cursor, populates record type 10.
-- ProgramGroup_cursor, populates record type 10.
	DECLARE ProgramGroup_cursor CURSOR FOR 
		select distinct ProgramGroup, Prog_GroupID, UA_VicePresident from #TEMP_IN where ProgramGroup is not null order by ProgramGroup 
	OPEN ProgramGroup_cursor
	FETCH NEXT FROM ProgramGroup_cursor INTO @CurProgramGroup, @CurProg_GroupID, @UPVP
	WHILE @@FETCH_STATUS = 0
	BEGIN
		insert #TEMP_OUT (RecNumber) values (10) -- A blank line
		insert #TEMP_OUT (RecNumber, RecType, RecDesc, RecTypeID, UAVP)
		select 10, 'ProgGroup/Total', @CurProgramGroup, @CurProg_GroupID, @UPVP
		select @MaxProgGroup = max(AutoKey) from #TEMP_OUT

		--------------------------------------------------------------------------------------------
		-- Program_cursor, populates record type 20.
		DECLARE Program_cursor CURSOR FOR 
			select distinct Program, ProgramID from #TEMP_IN where ProgramGroup = @CurProgramGroup and Program is not null order by Program
		OPEN Program_cursor
		FETCH NEXT FROM Program_cursor INTO @CurProgram, @CurProgramID
		WHILE @@FETCH_STATUS = 0
		BEGIN
			insert #TEMP_OUT (RecNumber, RecType, RecDesc, RecTypeID, R10_ProgramGroup)
			select 20, 'Program', @CurProgram, @CurProgramID, @CurProgramGroup
			select @MaxProg = max(AutoKey) from #TEMP_OUT

			--------------------------------------------------------------------------------------------
			-- AFEDesc_cursor, populates record type 30.
			DECLARE AFEDesc_cursor CURSOR FOR 
				select distinct AFEDesc, AFE_DescID, COBusinessLead from #TEMP_IN where ProgramGroup = @CurProgramGroup and Program = @CurProgram and AFEDesc is not null order by AFEDesc
			OPEN AFEDesc_cursor
			FETCH NEXT FROM AFEDesc_cursor INTO @CurAFEDesc, @CurAFE_DescID, @CurCOBusinessLead
			WHILE @@FETCH_STATUS = 0
			BEGIN
				insert #TEMP_OUT (RecNumber, RecType, RecDesc, RecTypeID, R10_ProgramGroup, R20_Program, COBusinessLead) 
				select 30, 'AFEDesc', @CurAFEDesc, @CurAFE_DescID, @CurProgramGroup, @CurProgram, @CurCOBusinessLead
				select @MaxAFEDesc = max(AutoKey) from #TEMP_OUT

				--------------------------------------------------------------------------------------------
				-- ProjDesc_cursor, populates record type 40.
				DECLARE ProjDesc_cursor CURSOR FOR 
					select distinct ProjectID, ProjectTitle from #TEMP_IN where ProgramGroup = @CurProgramGroup and Program = @CurProgram and AFE_DescID = @CurAFE_DescID and ProjectID is not null order by ProjectTitle 
				OPEN ProjDesc_cursor
				FETCH NEXT FROM ProjDesc_cursor INTO @CurProjID, @CurProjectTitle
				WHILE @@FETCH_STATUS = 0
				BEGIN
					insert #TEMP_OUT (RecNumber, RecType, RecDesc, RecTypeID, R10_ProgramGroup, R20_Program, R30_AFEDesc)
					select 40, 'ProjDesc', @CurProjectTitle, @CurProjID, @CurProgramGroup, @CurProgram, @CurAFEDesc
					select @MaxProj = max(AutoKey) from #TEMP_OUT 

					--------------------------------------------------------------------------------------------
					-- Task_cursor, populates record type 50.
					DECLARE Task_cursor CURSOR FOR
						select distinct TaskID, TaskName from #TEMP_IN where ProgramGroup = @CurProgramGroup and Program = @CurProgram and AFE_DescID = @CurAFE_DescID and ProjectID = @CurProjID order by TaskName
					OPEN Task_cursor
					FETCH NEXT FROM Task_cursor INTO @CurTaskID, @CurTaskName
					WHILE @@FETCH_STATUS = 0
					BEGIN
						insert #TEMP_OUT (RecNumber, RecType, RecDesc, RecTypeID, R10_ProgramGroup, R20_Program, R30_AFEDesc, R40_Project)
						select 50, 'TaskDesc', @CurTaskName, @CurTaskID, @CurProgramGroup, @CurProgram, @CurAFEDesc, @CurProjectTitle
						select @MaxTask = max(AutoKey) from #TEMP_OUT

						--------------------------------------------------------------------------------------------
						---Resource_cursor, populates Resources under Tasks, record type 60.
						DECLARE Resource_cursor CURSOR FOR
							select ResourceName, NewBillingType, Onshore, Offshore, Hourly, Hours from #TEMP_IN where ProgramGroup = @CurProgramGroup and Program = @CurProgram and AFE_DescID = @CurAFE_DescID and ProjectID = @CurProjID and TaskID = @CurTaskID and ResourceName is not NULL order by ResourceName
						OPEN Resource_cursor
						FETCH NEXT FROM Resource_cursor INTO @CurResourceName, @Billing_Type, @Onshore, @Offshore, @Hourly, @hours
						WHILE @@FETCH_STATUS = 0
						BEGIN
	   						-- Determine billing type for Resource and then insert record.
							if @Billing_Type like '%Jr SE%' and @Onshore = 1 
								insert #TEMP_OUT (RecNumber, RecType, RecDesc, JrSEOnshoreHours, R10_ProgramGroup, R20_Program, R30_AFEDesc, R40_Project, R50_Task) 
								select 60, 'ResourceName', @CurResourceName, @hours, @CurProgramGroup, @CurProgram, @CurAFEDesc, @CurProjectTitle, @CurTaskName
							if @Billing_Type like '%Jr SE%' and @Offshore = 1 
								insert #TEMP_OUT (RecNumber, RecType, RecDesc, JrSeOffshoreHours, R10_ProgramGroup, R20_Program, R30_AFEDesc, R40_Project, R50_Task) 
								select 60, 'ResourceName', @CurResourceName, @hours, @CurProgramGroup, @CurProgram, @CurAFEDesc, @CurProjectTitle, @CurTaskName
							if @Billing_Type like '%Mid SE%' and @Onshore = 1 
								insert #TEMP_OUT (RecNumber, RecType, RecDesc, MidSEOnshoreHours, R10_ProgramGroup, R20_Program, R30_AFEDesc, R40_Project, R50_Task) 
								select 60, 'ResourceName', @CurResourceName, @hours, @CurProgramGroup, @CurProgram, @CurAFEDesc, @CurProjectTitle, @CurTaskName
							if @Billing_Type like '%Mid SE%' and @Offshore = 1 
								insert #TEMP_OUT (RecNumber, RecType, RecDesc, MidSEOffshoreHours, R10_ProgramGroup, R20_Program, R30_AFEDesc, R40_Project, R50_Task) 
								select 60, 'ResourceName', @CurResourceName, @hours, @CurProgramGroup, @CurProgram, @CurAFEDesc, @CurProjectTitle, @CurTaskName
							if @Billing_Type like '%Adv SE%' and @Onshore = 1 
								insert #TEMP_OUT (RecNumber, RecType, RecDesc, AdvSEOnshoreHours, R10_ProgramGroup, R20_Program, R30_AFEDesc, R40_Project, R50_Task) 
								select 60, 'ResourceName', @CurResourceName, @hours, @CurProgramGroup, @CurProgram, @CurAFEDesc, @CurProjectTitle, @CurTaskName
							if @Billing_Type like '%Adv SE%' and @Offshore = 1 
								insert #TEMP_OUT (RecNumber, RecType, RecDesc, AdvSEOffshoreHours, R10_ProgramGroup, R20_Program, R30_AFEDesc, R40_Project, R50_Task) 
								select 60, 'ResourceName', @CurResourceName, @hours, @CurProgramGroup, @CurProgram, @CurAFEDesc, @CurProjectTitle, @CurTaskName
							if @Billing_Type like '%Sen SE%' and @Onshore = 1 
								insert #TEMP_OUT (RecNumber, RecType, RecDesc, SenSEOnshoreHours, R10_ProgramGroup, R20_Program, R30_AFEDesc, R40_Project, R50_Task) 
								select 60, 'ResourceName', @CurResourceName, @hours, @CurProgramGroup, @CurProgram, @CurAFEDesc, @CurProjectTitle, @CurTaskName
							if @Billing_Type like '%Sen SE%' and @Offshore = 1 
								insert #TEMP_OUT (RecNumber, RecType, RecDesc, SenSEOffshoreHours, R10_ProgramGroup, R20_Program, R30_AFEDesc, R40_Project, R50_Task) 
								select 60, 'ResourceName', @CurResourceName, @hours, @CurProgramGroup, @CurProgram, @CurAFEDesc, @CurProjectTitle, @CurTaskName
							if @Billing_Type like '%Cons%' and @Onshore = 1 
								insert #TEMP_OUT (RecNumber, RecType, RecDesc, ConsArchOnshoreHours, R10_ProgramGroup, R20_Program, R30_AFEDesc, R40_Project, R50_Task) 
								select 60, 'ResourceName', @CurResourceName, @hours, @CurProgramGroup, @CurProgram, @CurAFEDesc, @CurProjectTitle, @CurTaskName
							if @Billing_Type like '%Cons%' and @Offshore = 1 
								insert #TEMP_OUT (RecNumber, RecType, RecDesc, ConsArchOffshoreHours, R10_ProgramGroup, R20_Program, R30_AFEDesc, R40_Project, R50_Task) 
								select 60, 'ResourceName', @CurResourceName, @hours, @CurProgramGroup, @CurProgram, @CurAFEDesc, @CurProjectTitle, @CurTaskName
							if @Billing_Type like '%Project Lead%' and @Onshore = 1 
								insert #TEMP_OUT (RecNumber, RecType, RecDesc, ProjLeadOnshoreHours, R10_ProgramGroup, R20_Program, R30_AFEDesc, R40_Project, R50_Task) 
								select 60, 'ResourceName', @CurResourceName, @hours, @CurProgramGroup, @CurProgram, @CurAFEDesc, @CurProjectTitle, @CurTaskName
							if @Billing_Type like '%Project Lead%' and @Offshore = 1 
								insert #TEMP_OUT (RecNumber, RecType, RecDesc, ProjLeadOffshoreHours, R10_ProgramGroup, R20_Program, R30_AFEDesc, R40_Project, R50_Task) 
								select 60, 'ResourceName', @CurResourceName, @hours, @CurProgramGroup, @CurProgram, @CurAFEDesc, @CurProjectTitle, @CurTaskName
							
							if @Billing_Type in ('Project Mgr','Common Project Mgr','Premium Project Mgr','Niche Project Mgr','Off SHR Project Mgr','Legacy Project Mgr','Program Project Mgr') and @Onshore = 1 
								insert #TEMP_OUT (RecNumber, RecType, RecDesc, ProjMgrOnshoreHours, R10_ProgramGroup, R20_Program, R30_AFEDesc, R40_Project, R50_Task) 
								select 60, 'ResourceName', @CurResourceName, @hours, @CurProgramGroup, @CurProgram, @CurAFEDesc, @CurProjectTitle, @CurTaskName
							if @Billing_Type in ('Project Mgr','Common Project Mgr','Premium Project Mgr','Niche Project Mgr','Off SHR Project Mgr','Legacy Project Mgr','Program Project Mgr') and @Offshore = 1 
								insert #TEMP_OUT (RecNumber, RecType, RecDesc, ProjMgrOffshoreHours, R10_ProgramGroup, R20_Program, R30_AFEDesc, R40_Project, R50_Task) 
								select 60, 'ResourceName', @CurResourceName, @hours, @CurProgramGroup, @CurProgram, @CurAFEDesc, @CurProjectTitle, @CurTaskName
							
							if @Billing_Type in ('Program Mgr','Common Program Mgr','Premium Program Mgr','Niche Program Mgr','Off SHR Program Mgr','Legacy Program Mgr','Program Mgr') and @Onshore = 1 
								insert #TEMP_OUT (RecNumber, RecType, RecDesc, ProgMgrOnshoreHours, R10_ProgramGroup, R20_Program, R30_AFEDesc, R40_Project, R50_Task) 
								select 60, 'ResourceName', @CurResourceName, @hours, @CurProgramGroup, @CurProgram, @CurAFEDesc, @CurProjectTitle, @CurTaskName
							if @Billing_Type in ('Program Mgr','Common Program Mgr','Premium Program Mgr','Niche Program Mgr','Off SHR Program Mgr','Legacy Program Mgr','Program Mgr') and @Offshore = 1 
								insert #TEMP_OUT (RecNumber, RecType, RecDesc, ProgMgrOffshoreHours, R10_ProgramGroup, R20_Program, R30_AFEDesc, R40_Project, R50_Task) 
								select 60, 'ResourceName', @CurResourceName, @hours, @CurProgramGroup, @CurProgram, @CurAFEDesc, @CurProjectTitle, @CurTaskName                                          
							
							if @Billing_Type = 'Common Jr Project Mgr' and @Offshore = 1 
								insert #TEMP_OUT (RecNumber, RecType, RecDesc, JrProjMgrOffshoreHours, R10_ProgramGroup, R20_Program, R30_AFEDesc, R40_Project, R50_Task) 
								select 60, 'ResourceName', @CurResourceName, @hours, @CurProgramGroup, @CurProgram, @CurAFEDesc, @CurProjectTitle, @CurTaskName                                       
							if @Billing_Type = 'Common Jr Program Mgr' and @Offshore = 1 
								insert #TEMP_OUT (RecNumber, RecType, RecDesc, JrProgMgrOffshoreHours, R10_ProgramGroup, R20_Program, R30_AFEDesc, R40_Project, R50_Task) 
								select 60, 'ResourceName', @CurResourceName, @hours, @CurProgramGroup, @CurProgram, @CurAFEDesc, @CurProjectTitle, @CurTaskName

							if @Billing_Type = 'Common Sr Project Mgr' and @Offshore = 1 
								insert #TEMP_OUT (RecNumber, RecType, RecDesc, SrProjMgrOffshoreHours, R10_ProgramGroup, R20_Program, R30_AFEDesc, R40_Project, R50_Task) 
								select 60, 'ResourceName', @CurResourceName, @hours, @CurProgramGroup, @CurProgram, @CurAFEDesc, @CurProjectTitle, @CurTaskName
							if @Billing_Type = 'Common Sr Program Mgr' and @Offshore = 1 
								insert #TEMP_OUT (RecNumber, RecType, RecDesc, SrProgMgrOffshoreHours, R10_ProgramGroup, R20_Program, R30_AFEDesc, R40_Project, R50_Task) 
								select 60, 'ResourceName', @CurResourceName, @hours, @CurProgramGroup, @CurProgram, @CurAFEDesc, @CurProjectTitle, @CurTaskName

							if ( @ITSABillingCatSelection = '-1' )
							begin
								if @Billing_Type = 'FTP Staff Aug' and @Onshore = 1 
									insert #TEMP_OUT (RecNumber, RecType, RecDesc, FTPStaffAugOnshoreHours, R10_ProgramGroup, R20_Program, R30_AFEDesc, R40_Project, R50_Task) 
									select 60, 'ResourceName', @CurResourceName, @hours, @CurProgramGroup, @CurProgram, @CurAFEDesc, @CurProjectTitle, @CurTaskName
								if @Billing_Type = 'FTP Staff Aug' and @Offshore = 1 
									insert #TEMP_OUT (RecNumber, RecType, RecDesc, FTPStaffAugOffshoreHours, R10_ProgramGroup, R20_Program, R30_AFEDesc, R40_Project, R50_Task) 
									select 60, 'ResourceName', @CurResourceName, @hours, @CurProgramGroup, @CurProgram, @CurAFEDesc, @CurProjectTitle, @CurTaskName
							end
						FETCH NEXT FROM Resource_cursor INTO @CurResourceName, @Billing_Type, @Onshore, @Offshore, @Hourly, @hours
                        END    
                        CLOSE Resource_cursor
                        DEALLOCATE Resource_cursor

						--------------------------------------------------------------------------------------------
						-- SUMMARIZE Total Hours for each task (vertical), record type 60.
						if ( @ITSABillingCatSelection = '-1' )
							begin
							select @JrSEOnshore = sum(isnull(JrSEOnshoreHours,0)), @JrSEOffshore = sum(isnull(JrSeOffshoreHours,0)), @MidSEOnshore = sum(isnull(MidSEOnshoreHours,0)), @MidSEOffshore = sum(isnull(MidSEOffshoreHours,0)), @AdvSEOnshore = sum(isnull(AdvSEOnshoreHours,0)), @AdvSEOffshore = sum(isnull(AdvSEOffshoreHours,0)), @SenSEOnshore = sum(isnull(SenSEOnshoreHours,0)), @SenSEOffshore= sum(isnull(SenSEOffshoreHours,0)), @ConsArchOnshore = sum(isnull(ConsArchOnshoreHours,0)), @ConsArchOffshore= sum(isnull(ConsArchOffshoreHours,0)), @ProjLeadOnshore = sum(isnull(ProjLeadOnshoreHours,0)), @ProjLeadOffshore= sum(isnull(ProjLeadOffshoreHours,0)), @ProjMgrOnshore = sum(isnull(ProjMgrOnshoreHours,0)), @ProjMgrOffshore= sum(isnull(ProjMgrOffshoreHours,0)), @ProgMgrOnshore = sum(isnull(ProgMgrOnshoreHours,0)), @ProgMgrOffshore = sum(isnull(ProgMgrOffshoreHours,0)), @JrProjMgrOffshore = sum(isnull(JrProjMgrOffshoreHours,0)), @JrProgMgrOffshore = sum(isnull(JrProgMgrOffshoreHours,0)), @SrProjMgrOffshore = sum(isnull(SrProjMgrOffshoreHours,0)), @SrProgMgrOffshore = sum(isnull(SrProgMgrOffshoreHours,0)),	@FTPStaffAugOnshore = sum(isnull(FTPStaffAugOnshoreHours,0)), @FTPStaffAugOffshore= sum(isnull(FTPStaffAugOffshoreHours,0)), @TotalHours = sum(isnull(TotalHours,0)) from #TEMP_OUT 
								where AutoKey > @MaxTask and RecNumber = 60
							update #TEMP_OUT set JrSEOnshoreHours = @JrSEOnshore, JrSeOffshoreHours = @JrSEOffshore, MidSEOnshoreHours = @MidSEOnshore, MidSEOffshoreHours = @MidSEOffshore, AdvSEOnshoreHours = @AdvSEOnshore, AdvSEOffshoreHours = @AdvSEOffshore, SenSEOnshoreHours = @SenSEOnshore, SenSEOffshoreHours = @SenSEOffshore, ConsArchOnshoreHours = @ConsArchOnshore, ConsArchOffshoreHours = @ConsArchOffshore, ProjLeadOnshoreHours = @ProjLeadOnshore, ProjLeadOffshoreHours = @ProjLeadOffshore, ProjMgrOnshoreHours = @ProjMgrOnshore, ProjMgrOffshoreHours = @ProjMgrOffshore, ProgMgrOnshoreHours = @ProgMgrOnshore, ProgMgrOffshoreHours = @ProgMgrOffshore, JrProjMgrOffshoreHours = @JrProjMgrOffshore, JrProgMgrOffshoreHours = @JrProgMgrOffshore, SrProjMgrOffshoreHours = @SrProjMgrOffshore, SrProgMgrOffshoreHours = @SrProgMgrOffshore, FTPStaffAugOnshoreHours = @FTPStaffAugOnshore, FTPStaffAugOffshoreHours = @FTPStaffAugOffshore, TotalHours = @TotalHours 
								where AutoKey = @MaxTask
							end
						else
							begin
							select @JrSEOnshore = sum(isnull(JrSEOnshoreHours,0)), @JrSEOffshore = sum(isnull(JrSeOffshoreHours,0)), @MidSEOnshore = sum(isnull(MidSEOnshoreHours,0)), @MidSEOffshore = sum(isnull(MidSEOffshoreHours,0)), @AdvSEOnshore = sum(isnull(AdvSEOnshoreHours,0)), @AdvSEOffshore = sum(isnull(AdvSEOffshoreHours,0)), @SenSEOnshore = sum(isnull(SenSEOnshoreHours,0)), @SenSEOffshore= sum(isnull(SenSEOffshoreHours,0)), @ConsArchOnshore = sum(isnull(ConsArchOnshoreHours,0)), @ConsArchOffshore= sum(isnull(ConsArchOffshoreHours,0)), @ProjLeadOnshore = sum(isnull(ProjLeadOnshoreHours,0)), @ProjLeadOffshore= sum(isnull(ProjLeadOffshoreHours,0)), @ProjMgrOnshore = sum(isnull(ProjMgrOnshoreHours,0)), @ProjMgrOffshore= sum(isnull(ProjMgrOffshoreHours,0)), @ProgMgrOnshore = sum(isnull(ProgMgrOnshoreHours,0)), @ProgMgrOffshore = sum(isnull(ProgMgrOffshoreHours,0)), @JrProjMgrOffshore = sum(isnull(JrProjMgrOffshoreHours,0)), @JrProgMgrOffshore = sum(isnull(JrProgMgrOffshoreHours,0)),@SrProjMgrOffshore = sum(isnull(SrProjMgrOffshoreHours,0)), @SrProgMgrOffshore = sum(isnull(SrProgMgrOffshoreHours,0)),	@TotalHours = sum(isnull(TotalHours,0)) 
								from #TEMP_OUT where AutoKey > @MaxTask and RecNumber = 60						
							update #TEMP_OUT set JrSEOnshoreHours = @JrSEOnshore, JrSeOffshoreHours = @JrSEOffshore, MidSEOnshoreHours = @MidSEOnshore, MidSEOffshoreHours = @MidSEOffshore, AdvSEOnshoreHours = @AdvSEOnshore, AdvSEOffshoreHours = @AdvSEOffshore, SenSEOnshoreHours = @SenSEOnshore, SenSEOffshoreHours = @SenSEOffshore, ConsArchOnshoreHours = @ConsArchOnshore, ConsArchOffshoreHours = @ConsArchOffshore, ProjLeadOnshoreHours = @ProjLeadOnshore, ProjLeadOffshoreHours = @ProjLeadOffshore, ProjMgrOnshoreHours = @ProjMgrOnshore, ProjMgrOffshoreHours = @ProjMgrOffshore, ProgMgrOnshoreHours = @ProgMgrOnshore, ProgMgrOffshoreHours = @ProgMgrOffshore, JrProjMgrOffshoreHours = @JrProjMgrOffshore, JrProgMgrOffshoreHours = @JrProgMgrOffshore, SrProjMgrOffshoreHours = @SrProjMgrOffshore, SrProgMgrOffshoreHours = @SrProgMgrOffshore, TotalHours = @TotalHours 
								where AutoKey = @MaxTask
							end
					FETCH NEXT FROM Task_cursor INTO @CurTaskID, @CurTaskName
					END    
					CLOSE Task_cursor
					DEALLOCATE Task_cursor

					-----------------------------------------------------------------------------------------------------------------------
               		-- SUMMARIZE Total Hours at Project Level on 10 fields (vertical), record type 50.
   					if ( @ITSABillingCatSelection = '-1' )
						begin
						select @JrSEOnshore = sum(isnull(JrSEOnshoreHours,0)), @JrSEOffshore = sum(isnull(JrSeOffshoreHours,0)), @MidSEOnshore = sum(isnull(MidSEOnshoreHours,0)), @MidSEOffshore = sum(isnull(MidSEOffshoreHours,0)), @AdvSEOnshore = sum(isnull(AdvSEOnshoreHours,0)), @AdvSEOffshore = sum(isnull(AdvSEOffshoreHours,0)), @SenSEOnshore = sum(isnull(SenSEOnshoreHours,0)), @SenSEOffshore= sum(isnull(SenSEOffshoreHours,0)), @ConsArchOnshore = sum(isnull(ConsArchOnshoreHours,0)), @ConsArchOffshore= sum(isnull(ConsArchOffshoreHours,0)), @ProjLeadOnshore = sum(isnull(ProjLeadOnshoreHours,0)), @ProjLeadOffshore= sum(isnull(ProjLeadOffshoreHours,0)), @ProjMgrOnshore = sum(isnull(ProjMgrOnshoreHours,0)), @ProjMgrOffshore= sum(isnull(ProjMgrOffshoreHours,0)), @ProgMgrOnshore = sum(isnull(ProgMgrOnshoreHours,0)), @ProgMgrOffshore = sum(isnull(ProgMgrOffshoreHours,0)), @JrProjMgrOffshore = sum(isnull(JrProjMgrOffshoreHours,0)), @JrProgMgrOffshore = sum(isnull(JrProgMgrOffshoreHours,0)), @SrProjMgrOffshore = sum(isnull(SrProjMgrOffshoreHours,0)), @SrProgMgrOffshore = sum(isnull(SrProgMgrOffshoreHours,0)), @FTPStaffAugOnshore = sum(isnull(FTPStaffAugOnshoreHours,0)), @FTPStaffAugOffshore= sum(isnull(FTPStaffAugOffshoreHours,0)), @TotalHours = sum(isnull(TotalHours,0)) from #TEMP_OUT 
							where AutoKey > @MaxProj and RecNumber = 50 
						update #TEMP_OUT set JrSEOnshoreHours = @JrSEOnshore, JrSeOffshoreHours = @JrSEOffshore, MidSEOnshoreHours = @MidSEOnshore, MidSEOffshoreHours = @MidSEOffshore, AdvSEOnshoreHours = @AdvSEOnshore, AdvSEOffshoreHours = @AdvSEOffshore, SenSEOnshoreHours = @SenSEOnshore, SenSEOffshoreHours = @SenSEOffshore, ConsArchOnshoreHours = @ConsArchOnshore, ConsArchOffshoreHours = @ConsArchOffshore, ProjLeadOnshoreHours = @ProjLeadOnshore, ProjLeadOffshoreHours = @ProjLeadOffshore, ProjMgrOnshoreHours = @ProjMgrOnshore, ProjMgrOffshoreHours = @ProjMgrOffshore, ProgMgrOnshoreHours = @ProgMgrOnshore, ProgMgrOffshoreHours = @ProgMgrOffshore, JrProjMgrOffshoreHours = @JrProjMgrOffshore, JrProgMgrOffshoreHours = @JrProgMgrOffshore, SrProjMgrOffshoreHours = @SrProjMgrOffshore, SrProgMgrOffshoreHours = @SrProgMgrOffshore, FTPStaffAugOnshoreHours = @FTPStaffAugOnshore, FTPStaffAugOffshoreHours = @FTPStaffAugOffshore, TotalHours = @TotalHours 
							where AutoKey = @MaxProj                
						end
					else
						begin
						select @JrSEOnshore = sum(isnull(JrSEOnshoreHours,0)), @JrSEOffshore = sum(isnull(JrSeOffshoreHours,0)), @MidSEOnshore = sum(isnull(MidSEOnshoreHours,0)), @MidSEOffshore = sum(isnull(MidSEOffshoreHours,0)), @AdvSEOnshore = sum(isnull(AdvSEOnshoreHours,0)), @AdvSEOffshore = sum(isnull(AdvSEOffshoreHours,0)), @SenSEOnshore = sum(isnull(SenSEOnshoreHours,0)), @SenSEOffshore= sum(isnull(SenSEOffshoreHours,0)), @ConsArchOnshore = sum(isnull(ConsArchOnshoreHours,0)), @ConsArchOffshore= sum(isnull(ConsArchOffshoreHours,0)), @ProjLeadOnshore = sum(isnull(ProjLeadOnshoreHours,0)), @ProjLeadOffshore= sum(isnull(ProjLeadOffshoreHours,0)), @ProjMgrOnshore = sum(isnull(ProjMgrOnshoreHours,0)), @ProjMgrOffshore= sum(isnull(ProjMgrOffshoreHours,0)), @ProgMgrOnshore = sum(isnull(ProgMgrOnshoreHours,0)), @ProgMgrOffshore = sum(isnull(ProgMgrOffshoreHours,0)), @JrProjMgrOffshore = sum(isnull(JrProjMgrOffshoreHours,0)), @JrProgMgrOffshore = sum(isnull(JrProgMgrOffshoreHours,0)), @SrProjMgrOffshore = sum(isnull(SrProjMgrOffshoreHours,0)), @SrProgMgrOffshore = sum(isnull(SrProgMgrOffshoreHours,0)), @TotalHours = sum(isnull(TotalHours,0)) from #TEMP_OUT  
							where AutoKey > @MaxProj and RecNumber = 50 
						update #TEMP_OUT set JrSEOnshoreHours = @JrSEOnshore, JrSeOffshoreHours = @JrSEOffshore, MidSEOnshoreHours = @MidSEOnshore, MidSEOffshoreHours = @MidSEOffshore, AdvSEOnshoreHours = @AdvSEOnshore, AdvSEOffshoreHours = @AdvSEOffshore, SenSEOnshoreHours = @SenSEOnshore, SenSEOffshoreHours = @SenSEOffshore, ConsArchOnshoreHours = @ConsArchOnshore, ConsArchOffshoreHours = @ConsArchOffshore, ProjLeadOnshoreHours = @ProjLeadOnshore, ProjLeadOffshoreHours = @ProjLeadOffshore, ProjMgrOnshoreHours = @ProjMgrOnshore, ProjMgrOffshoreHours = @ProjMgrOffshore, ProgMgrOnshoreHours = @ProgMgrOnshore, ProgMgrOffshoreHours = @ProgMgrOffshore, JrProjMgrOffshoreHours = @JrProjMgrOffshore, JrProgMgrOffshoreHours = @JrProgMgrOffshore, SrProjMgrOffshoreHours = @SrProjMgrOffshore, SrProgMgrOffshoreHours = @SrProgMgrOffshore, TotalHours = @TotalHours 
							where AutoKey = @MaxProj                
						end
				FETCH NEXT FROM ProjDesc_cursor INTO @CurProjID, @CurProjectTitle
				END    
				CLOSE ProjDesc_cursor
				DEALLOCATE ProjDesc_cursor

				-----------------------------------------------------------------------------------------------------------------------
				-- Get the ITSA Billing Category.
				select @ITSABillingCat = ITSABillingCat from #TEMP_IN where Prog_GroupID = @CurProg_GroupID and ProgramID = @CurProgramID and AFE_DescID = @CurAFE_DescID 

				-- GET funding category and location combo.
				Declare @@out_location varchar (100), @@out_fundingcat varchar (100), @@out_afenumber varchar (20), @@out_programmgr varchar (50), @@Total_FTE float             
				set @@out_location  = NULL
				set @@out_fundingcat = NULL
				set @@out_afenumber = NULL
				set @@out_programmgr = NULL
				set @@Total_FTE = NULL
				exec GET_Location_Combo @CurAFE_DescID, @DateFrom, @DateTo, @@out_location OUTPUT, @@out_fundingcat OUTPUT, @@out_afenumber OUTPUT, @@out_programmgr OUTPUT, @@Total_FTE OUTPUT
                
				if ( @ITSABillingCatSelection = '-1' )
					begin
					select @JrSEOnshoreHours = sum(isnull(JrSEOnshoreHours,0)), @JrSEOffshoreHours = sum(isnull(JrSEOffshoreHours,0)), @MidSEOnshoreHours = sum(isnull(MidSEOnshoreHours,0)), @MidSEOffshoreHours = sum(isnull(MidSEOffshoreHours,0)), @AdvSEOnshoreHours = sum(isnull(AdvSEOnshoreHours,0)), @AdvSEOffshoreHours = sum(isnull(AdvSEOffshoreHours,0)), @SenSEOnshoreHours = sum(isnull(SenSEOnshoreHours,0)), @SenSEOffshoreHours = sum(isnull(SenSEOffshoreHours,0)), @ConsArchOnshoreHours = sum(isnull(ConsArchOnshoreHours,0)), @ConsArchOffshoreHours = sum(isnull(ConsArchOffshoreHours,0)), @ProjLeadOnshoreHours = sum(isnull(ProjLeadOnshoreHours,0)), @ProjLeadOffshoreHours = sum(isnull(ProjLeadOffshoreHours,0)), @ProjMgrOnshoreHours = sum(isnull(ProjMgrOnshoreHours,0)), @ProjMgrOffshoreHours = sum(isnull(ProjMgrOffshoreHours,0)), @ProgMgrOnshoreHours = sum(isnull(ProgMgrOnshoreHours,0)), @ProgMgrOffshoreHours = sum(isnull(ProgMgrOffshoreHours,0)), @JrProjMgrOffshoreHours = sum(isnull(JrProjMgrOffshoreHours,0)), @JrProgMgrOffshoreHours = sum(isnull(JrProgMgrOffshoreHours,0)), @SrProjMgrOffshoreHours = sum(isnull(SrProjMgrOffshoreHours,0)), @SrProgMgrOffshoreHours = sum(isnull(SrProgMgrOffshoreHours,0)), @FTPStaffAugOnshoreHours = sum(isnull(FTPStaffAugOnshoreHours,0)), @FTPStaffAugOffshoreHours = sum(isnull(FTPStaffAugOffshoreHours,0)) from #TEMP_OUT 
						where AutoKey > @MaxAFEDesc and RecNumber = 40
					select @TotalHours = isnull(@JrSEOnshoreHours,0) + isnull(@JrSEOffshoreHours,0) + isnull(@MidSEOnshoreHours,0) + isnull(@MidSEOffshoreHours,0) + isnull(@AdvSEOnshoreHours,0) + isnull(@AdvSEOffshoreHours,0) + isnull(@SenSEOnshoreHours,0) + isnull(@SenSEOffshoreHours,0) + isnull(@ConsArchOnshoreHours,0) + isnull(@ConsArchOffshoreHours,0) + isnull(@ProjLeadOnshoreHours,0) + isnull(@ProjLeadOffshoreHours,0) + isnull(@ProjMgrOnshoreHours,0) + isnull(@ProjMgrOffshoreHours,0) + isnull(@ProgMgrOnshoreHours,0) + isnull(@ProgMgrOffshoreHours,0) + isnull(@JrProjMgrOffshoreHours,0) + isnull (@JrProgMgrOffshoreHours,0) + isnull(@SrProjMgrOffshoreHours,0) + isnull (@SrProgMgrOffshoreHours,0) + isnull(@FTPStaffAugOnshoreHours,0) + isnull (@FTPStaffAugOffshoreHours,0)
					update #TEMP_OUT set ITSABillingCat = @ITSABillingCat, fundingcat = @@out_fundingcat, AFENumber = @@out_afenumber, ProgramMgr = @@out_programmgr, location = @@out_location, COApprovedFTEs = isnull(@@Total_FTE,0), TotalHours = isnull(@TotalHours,0), JrSEOnshoreHours = isnull(@JrSEOnshoreHours,0), JrSEOffshoreHours = isnull(@JrSEOffshoreHours,0), MidSEOnshoreHours = isnull(@MidSEOnshoreHours,0), MidSEOffshoreHours = isnull(@MidSEOffshoreHours,0), AdvSEOnshoreHours = isnull(@AdvSEOnshoreHours,0), AdvSEOffshoreHours = isnull(@AdvSEOffshoreHours,0),	SenSEOnshoreHours = isnull(@SenSEOnshoreHours,0), SenSEOffshoreHours = isnull(@SenSEOffshoreHours,0), ConsArchOnshoreHours = isnull(@ConsArchOnshoreHours,0), ConsArchOffshoreHours = isnull(@ConsArchOffshoreHours,0), ProjLeadOnshoreHours = isnull(@ProjLeadOnshoreHours,0), ProjLeadOffshoreHours = isnull(@ProjLeadOffshoreHours,0), ProjMgrOnshoreHours = isnull(@ProjMgrOnshoreHours,0), ProjMgrOffshoreHours = isnull(@ProjMgrOffshoreHours,0),	ProgMgrOnshoreHours = isnull(@ProgMgrOnshoreHours,0), ProgMgrOffshoreHours = isnull(@ProgMgrOffshoreHours,0), JrProjMgrOffshoreHours = isnull(@JrProjMgrOffshoreHours,0), JrProgMgrOffshoreHours = isnull(@JrProgMgrOffshoreHours,0), SrProjMgrOffshoreHours = isnull(@SrProjMgrOffshoreHours,0), SrProgMgrOffshoreHours = isnull(@SrProgMgrOffshoreHours,0), FTPStaffAugOnshoreHours = isnull(@FTPStaffAugOnshoreHours,0), FTPStaffAugOffshoreHours = isnull(@FTPStaffAugOffshoreHours,0) 
						where AutoKey = @MaxAFEDesc
					update #TEMP_OUT set ActualFTEs = ( (JrSEOnshoreHours + MidSEOnshoreHours + AdvSEOnshoreHours + SenSEOnshoreHours + ConsArchOnshoreHours + ProjLeadOnshoreHours + ProjMgrOnshoreHours + ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (JrSEOffshoreHours + MidSEOffshoreHours + AdvSEOffshoreHours + SenSEOffshoreHours + ConsArchOffshoreHours + ProjLeadOffshoreHours + ProjMgrOffshoreHours + ProgMgrOffshoreHours + JrProjMgrOffshoreHours + JrProgMgrOffshoreHours + SrProjMgrOffshoreHours + SrProgMgrOffshoreHours) / @OffshoreFTERate) + ( (FTPStaffAugOnshoreHours + FTPStaffAugOffshoreHours) / @FTPBillingRate ) 
						where AutoKey = @MaxAFEDesc	
					end
				else
					begin
					select @JrSEOnshoreHours = sum(isnull(JrSEOnshoreHours,0)), @JrSEOffshoreHours = sum(isnull(JrSEOffshoreHours,0)), @MidSEOnshoreHours = sum(isnull(MidSEOnshoreHours,0)), @MidSEOffshoreHours = sum(isnull(MidSEOffshoreHours,0)), @AdvSEOnshoreHours = sum(isnull(AdvSEOnshoreHours,0)), @AdvSEOffshoreHours = sum(isnull(AdvSEOffshoreHours,0)), @SenSEOnshoreHours = sum(isnull(SenSEOnshoreHours,0)), @SenSEOffshoreHours = sum(isnull(SenSEOffshoreHours,0)), @ConsArchOnshoreHours = sum(isnull(ConsArchOnshoreHours,0)), @ConsArchOffshoreHours = sum(isnull(ConsArchOffshoreHours,0)), @ProjLeadOnshoreHours = sum(isnull(ProjLeadOnshoreHours,0)), @ProjLeadOffshoreHours = sum(isnull(ProjLeadOffshoreHours,0)), @ProjMgrOnshoreHours = sum(isnull(ProjMgrOnshoreHours,0)), @ProjMgrOffshoreHours = sum(isnull(ProjMgrOffshoreHours,0)), @ProgMgrOnshoreHours = sum(isnull(ProgMgrOnshoreHours,0)), @ProgMgrOffshoreHours = sum(isnull(ProgMgrOffshoreHours,0)), @JrProjMgrOffshoreHours = sum(isnull(JrProjMgrOffshoreHours,0)), @JrProgMgrOffshoreHours = sum(isnull(JrProgMgrOffshoreHours,0)), @SrProjMgrOffshoreHours = sum(isnull(SrProjMgrOffshoreHours,0)), @SrProgMgrOffshoreHours = sum(isnull(SrProgMgrOffshoreHours,0)) from #TEMP_OUT 
						where AutoKey > @MaxAFEDesc and RecNumber = 40
					select @TotalHours = isnull(@JrSEOnshoreHours,0) + isnull(@JrSEOffshoreHours,0) + isnull(@MidSEOnshoreHours,0) + isnull(@MidSEOffshoreHours,0) + isnull(@AdvSEOnshoreHours,0) + isnull(@AdvSEOffshoreHours,0) + isnull(@SenSEOnshoreHours,0) + isnull(@SenSEOffshoreHours,0) + isnull(@ConsArchOnshoreHours,0) + isnull(@ConsArchOffshoreHours,0) + isnull(@ProjLeadOnshoreHours,0) + isnull(@ProjLeadOffshoreHours,0) + isnull(@ProjMgrOnshoreHours,0) + isnull(@ProjMgrOffshoreHours,0) + isnull(@ProgMgrOnshoreHours,0) + isnull(@ProgMgrOffshoreHours,0) + isnull(@JrProjMgrOffshoreHours,0) + isnull (@JrProgMgrOffshoreHours,0) + isnull(@SrProjMgrOffshoreHours,0) + isnull (@SrProgMgrOffshoreHours,0) 
					update #TEMP_OUT set ITSABillingCat = @ITSABillingCat, fundingcat = @@out_fundingcat, AFENumber = @@out_afenumber, ProgramMgr = @@out_programmgr, location = @@out_location, COApprovedFTEs = isnull(@@Total_FTE,0), TotalHours = isnull(@TotalHours,0), JrSEOnshoreHours = isnull(@JrSEOnshoreHours,0), JrSEOffshoreHours = isnull(@JrSEOffshoreHours,0), MidSEOnshoreHours = isnull(@MidSEOnshoreHours,0), MidSEOffshoreHours = isnull(@MidSEOffshoreHours,0), AdvSEOnshoreHours = isnull(@AdvSEOnshoreHours,0), AdvSEOffshoreHours = isnull(@AdvSEOffshoreHours,0),	SenSEOnshoreHours = isnull(@SenSEOnshoreHours,0), SenSEOffshoreHours = isnull(@SenSEOffshoreHours,0), ConsArchOnshoreHours = isnull(@ConsArchOnshoreHours,0), ConsArchOffshoreHours = isnull(@ConsArchOffshoreHours,0), ProjLeadOnshoreHours = isnull(@ProjLeadOnshoreHours,0), ProjLeadOffshoreHours = isnull(@ProjLeadOffshoreHours,0), ProjMgrOnshoreHours = isnull(@ProjMgrOnshoreHours,0), ProjMgrOffshoreHours = isnull(@ProjMgrOffshoreHours,0),	ProgMgrOnshoreHours = isnull(@ProgMgrOnshoreHours,0), ProgMgrOffshoreHours = isnull(@ProgMgrOffshoreHours,0), JrProjMgrOffshoreHours = isnull(@JrProjMgrOffshoreHours,0), JrProgMgrOffshoreHours = isnull(@JrProgMgrOffshoreHours,0), SrProjMgrOffshoreHours = isnull(@SrProjMgrOffshoreHours,0), SrProgMgrOffshoreHours = isnull(@SrProgMgrOffshoreHours,0)
						where AutoKey = @MaxAFEDesc
					update #TEMP_OUT set ActualFTEs = ( (JrSEOnshoreHours + MidSEOnshoreHours + AdvSEOnshoreHours + SenSEOnshoreHours + ConsArchOnshoreHours + ProjLeadOnshoreHours + ProjMgrOnshoreHours + ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (JrSEOffshoreHours + MidSEOffshoreHours + AdvSEOffshoreHours + SenSEOffshoreHours + ConsArchOffshoreHours + ProjLeadOffshoreHours + ProjMgrOffshoreHours + ProgMgrOffshoreHours + JrProjMgrOffshoreHours + JrProgMgrOffshoreHours + SrProjMgrOffshoreHours + SrProgMgrOffshoreHours) / @OffshoreFTERate) 
						where AutoKey = @MaxAFEDesc	
					end

				-- UPDATE Summary Fields --
				update #TEMP_OUT set EDSVariance = ActualFTEs - COApprovedFTEs where AutoKey = @MaxAFEDesc
    
			FETCH NEXT FROM AFEDesc_cursor INTO @CurAFEDesc, @CurAFE_DescID, @CurCOBusinessLead
			END    
			CLOSE AFEDesc_cursor
			DEALLOCATE AFEDesc_cursor

		-----------------------------------------------------------------------------------------------------------------------
		FETCH NEXT FROM Program_cursor INTO @CurProgram, @CurProgramID
		END
		CLOSE Program_cursor
		DEALLOCATE Program_cursor

		-----------------------------------------------------------------------------------------------------------------------
		-- Populate TotalHours Column for record type 30 (horizontal add up).
		if ( @ITSABillingCatSelection = '-1' )
			begin
			update #TEMP_OUT set TotalHours = isnull(JrSEOnshoreHours,0) + isnull(JrSEOffshoreHours,0) + isnull(MidSEOnshoreHours,0) + isnull(MidSEOffshoreHours,0) + isnull(AdvSEOnshoreHours,0) + isnull(AdvSEOffshoreHours,0) + isnull(SenSEOnshoreHours,0) + isnull(SenSEOffshoreHours,0) + isnull(ConsArchOnshoreHours,0) + isnull(ConsArchOffshoreHours,0) + isnull(ProjLeadOnshoreHours,0) + isnull(ProjLeadOffshoreHours,0) + isnull(ProjMgrOnshoreHours,0) + isnull(ProjMgrOffshoreHours,0) + isnull(ProgMgrOnshoreHours,0) + isnull(ProgMgrOffshoreHours,0) + isnull(JrProjMgrOffshoreHours,0) + isnull(JrProgMgrOffshoreHours,0) + isnull(SrProjMgrOffshoreHours,0) + isnull(SrProgMgrOffshoreHours,0) + isnull(FTPStaffAugOnshoreHours,0) + isnull(FTPStaffAugOffshoreHours,0) 
				where AutoKey > @MaxProgGroup and RecNumber = 30
			update #TEMP_OUT set ActualFTEs = ( (JrSEOnshoreHours + MidSEOnshoreHours + AdvSEOnshoreHours + SenSEOnshoreHours + ConsArchOnshoreHours + ProjLeadOnshoreHours + ProjMgrOnshoreHours + ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (JrSEOffshoreHours + MidSEOffshoreHours + AdvSEOffshoreHours + SenSEOffshoreHours + ConsArchOffshoreHours + ProjLeadOffshoreHours + ProjMgrOffshoreHours + ProgMgrOffshoreHours + JrProjMgrOffshoreHours + JrProgMgrOffshoreHours + SrProjMgrOffshoreHours + SrProgMgrOffshoreHours) / @OffshoreFTERate) + ( (FTPStaffAugOnshoreHours + FTPStaffAugOffshoreHours) / @FTPBillingRate ) 
				where AutoKey > @MaxProgGroup and RecNumber = 30
			end
		else
  			begin
		    update #TEMP_OUT set TotalHours = isnull(JrSEOnshoreHours,0) + isnull(JrSEOffshoreHours,0) + isnull(MidSEOnshoreHours,0) + isnull(MidSEOffshoreHours,0) + isnull(AdvSEOnshoreHours,0) + isnull(AdvSEOffshoreHours,0) + isnull(SenSEOnshoreHours,0) + isnull(SenSEOffshoreHours,0) + isnull(ConsArchOnshoreHours,0) + isnull(ConsArchOffshoreHours,0) + isnull(ProjLeadOnshoreHours,0) + isnull(ProjLeadOffshoreHours,0) + isnull(ProjMgrOnshoreHours,0) + isnull(ProjMgrOffshoreHours,0) + isnull(ProgMgrOnshoreHours,0) + isnull(ProgMgrOffshoreHours,0) + isnull(JrProjMgrOffshoreHours,0) + isnull(JrProgMgrOffshoreHours,0) + isnull(SrProjMgrOffshoreHours,0) + isnull(SrProgMgrOffshoreHours,0) 
				where AutoKey > @MaxProgGroup and RecNumber = 30
			update #TEMP_OUT set ActualFTEs = ( (JrSEOnshoreHours + MidSEOnshoreHours + AdvSEOnshoreHours + SenSEOnshoreHours + ConsArchOnshoreHours + ProjLeadOnshoreHours + ProjMgrOnshoreHours + ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (JrSEOffshoreHours + MidSEOffshoreHours + AdvSEOffshoreHours + SenSEOffshoreHours + ConsArchOffshoreHours + ProjLeadOffshoreHours + ProjMgrOffshoreHours + ProgMgrOffshoreHours + JrProjMgrOffshoreHours + JrProgMgrOffshoreHours + SrProjMgrOffshoreHours + SrProgMgrOffshoreHours) / @OffshoreFTERate) 
				where AutoKey > @MaxProgGroup and RecNumber = 30
			end   
     
		-- Populate EDSVariance column for record type 30. 
		update #TEMP_OUT set EDSVariance = ActualFTEs - COApprovedFTEs where AutoKey > @MaxProgGroup and RecNumber = 30

		-- Populate TotalHours Column for record type 40 (horizontal add up).
		if ( @ITSABillingCatSelection = '-1' )
			begin
			update #TEMP_OUT set TotalHours = isnull(JrSEOnshoreHours,0) + isnull(JrSEOffshoreHours,0) + isnull(MidSEOnshoreHours,0) + isnull(MidSEOffshoreHours,0) + isnull(AdvSEOnshoreHours,0) + isnull(AdvSEOffshoreHours,0) + isnull(SenSEOnshoreHours,0) + isnull(SenSEOffshoreHours,0) + isnull(ConsArchOnshoreHours,0) + isnull(ConsArchOffshoreHours,0) + isnull(ProjLeadOnshoreHours,0) + isnull(ProjLeadOffshoreHours,0) + isnull(ProjMgrOnshoreHours,0) + isnull(ProjMgrOffshoreHours,0) + isnull(ProgMgrOnshoreHours,0) + isnull(ProgMgrOffshoreHours,0) + isnull(JrProjMgrOffshoreHours,0) + isnull(JrProgMgrOffshoreHours,0) + isnull(SrProjMgrOffshoreHours,0) + isnull(SrProgMgrOffshoreHours,0) + isnull(FTPStaffAugOnshoreHours,0) + isnull(FTPStaffAugOffshoreHours,0) 
				where AutoKey > @MaxProgGroup and RecNumber = 40
			update #TEMP_OUT set ActualFTEs = ( (JrSEOnshoreHours + MidSEOnshoreHours + AdvSEOnshoreHours + SenSEOnshoreHours + ConsArchOnshoreHours + ProjLeadOnshoreHours + ProjMgrOnshoreHours + ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (JrSEOffshoreHours + MidSEOffshoreHours + AdvSEOffshoreHours + SenSEOffshoreHours + ConsArchOffshoreHours + ProjLeadOffshoreHours + ProjMgrOffshoreHours + ProgMgrOffshoreHours + JrProjMgrOffshoreHours + JrProgMgrOffshoreHours + SrProjMgrOffshoreHours + SrProgMgrOffshoreHours) / @OffshoreFTERate) + ( (FTPStaffAugOnshoreHours + FTPStaffAugOffshoreHours) / @FTPBillingRate ) 
				where AutoKey > @MaxProgGroup and RecNumber = 40
			end
		else
			begin
			update #TEMP_OUT set TotalHours = isnull(JrSEOnshoreHours,0) + isnull(JrSEOffshoreHours,0) + isnull(MidSEOnshoreHours,0) + isnull(MidSEOffshoreHours,0) + isnull(AdvSEOnshoreHours,0) + isnull(AdvSEOffshoreHours,0) + isnull(SenSEOnshoreHours,0) + isnull(SenSEOffshoreHours,0) + isnull(ConsArchOnshoreHours,0) + isnull(ConsArchOffshoreHours,0) + isnull(ProjLeadOnshoreHours,0) + isnull(ProjLeadOffshoreHours,0) + isnull(ProjMgrOnshoreHours,0) + isnull(ProjMgrOffshoreHours,0) + isnull(ProgMgrOnshoreHours,0) + isnull(ProgMgrOffshoreHours,0) + isnull(JrProjMgrOffshoreHours,0) + isnull(JrProgMgrOffshoreHours,0) + isnull(SrProjMgrOffshoreHours,0) + isnull(SrProgMgrOffshoreHours,0) 
				where AutoKey > @MaxProgGroup and RecNumber = 40
			update #TEMP_OUT set ActualFTEs = ( (JrSEOnshoreHours + MidSEOnshoreHours + AdvSEOnshoreHours + SenSEOnshoreHours + ConsArchOnshoreHours + ProjLeadOnshoreHours + ProjMgrOnshoreHours + ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (JrSEOffshoreHours + MidSEOffshoreHours + AdvSEOffshoreHours + SenSEOffshoreHours + ConsArchOffshoreHours + ProjLeadOffshoreHours + ProjMgrOffshoreHours + ProgMgrOffshoreHours + JrProjMgrOffshoreHours + JrProgMgrOffshoreHours + SrProjMgrOffshoreHours + SrProgMgrOffshoreHours) / @OffshoreFTERate) 
				where AutoKey > @MaxProgGroup and RecNumber = 40
			end

		-- Populate TotalHours Column for record type 50 (horizontal add up).
		if ( @ITSABillingCatSelection = '-1' )
			begin
			update #TEMP_OUT set TotalHours = isnull(JrSEOnshoreHours,0) + isnull(JrSEOffshoreHours,0) + isnull(MidSEOnshoreHours,0) + isnull(MidSEOffshoreHours,0) + isnull(AdvSEOnshoreHours,0) + isnull(AdvSEOffshoreHours,0) + isnull(SenSEOnshoreHours,0) + isnull(SenSEOffshoreHours,0) + isnull(ConsArchOnshoreHours,0) + isnull(ConsArchOffshoreHours,0) + isnull(ProjLeadOnshoreHours,0) + isnull(ProjLeadOffshoreHours,0) + isnull(ProjMgrOnshoreHours,0) + isnull(ProjMgrOffshoreHours,0) + isnull(ProgMgrOnshoreHours,0) + isnull(ProgMgrOffshoreHours,0) + isnull(JrProjMgrOffshoreHours,0) + isnull(JrProgMgrOffshoreHours,0) + isnull(SrProjMgrOffshoreHours,0) + isnull(SrProgMgrOffshoreHours,0) + isnull(FTPStaffAugOnshoreHours,0) + isnull(FTPStaffAugOffshoreHours,0) 
				where AutoKey > @MaxProgGroup and RecNumber = 50
			update #TEMP_OUT set ActualFTEs = ( (JrSEOnshoreHours + MidSEOnshoreHours + AdvSEOnshoreHours + SenSEOnshoreHours + ConsArchOnshoreHours + ProjLeadOnshoreHours + ProjMgrOnshoreHours + ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (JrSEOffshoreHours + MidSEOffshoreHours + AdvSEOffshoreHours + SenSEOffshoreHours + ConsArchOffshoreHours + ProjLeadOffshoreHours + ProjMgrOffshoreHours + ProgMgrOffshoreHours + SrProjMgrOffshoreHours + SrProgMgrOffshoreHours) / @OffshoreFTERate) + ( (FTPStaffAugOnshoreHours + FTPStaffAugOffshoreHours) / @FTPBillingRate ) 
				where AutoKey > @MaxProgGroup and RecNumber = 50
			end
		else
			begin
			update #TEMP_OUT set TotalHours = isnull(JrSEOnshoreHours,0) + isnull(JrSEOffshoreHours,0) + isnull(MidSEOnshoreHours,0) + isnull(MidSEOffshoreHours,0) + isnull(AdvSEOnshoreHours,0) + isnull(AdvSEOffshoreHours,0) + isnull(SenSEOnshoreHours,0) + isnull(SenSEOffshoreHours,0) + isnull(ConsArchOnshoreHours,0) + isnull(ConsArchOffshoreHours,0) + isnull(ProjLeadOnshoreHours,0) + isnull(ProjLeadOffshoreHours,0) + isnull(ProjMgrOnshoreHours,0) + isnull(ProjMgrOffshoreHours,0) + isnull(ProgMgrOnshoreHours,0) + isnull(ProgMgrOffshoreHours,0) + isnull(JrProjMgrOffshoreHours,0) + isnull(JrProgMgrOffshoreHours,0) + isnull(SrProjMgrOffshoreHours,0) + isnull(SrProgMgrOffshoreHours,0) 
				where AutoKey > @MaxProgGroup and RecNumber = 50
			update #TEMP_OUT set ActualFTEs = ( (JrSEOnshoreHours + MidSEOnshoreHours + AdvSEOnshoreHours + SenSEOnshoreHours + ConsArchOnshoreHours + ProjLeadOnshoreHours + ProjMgrOnshoreHours + ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (JrSEOffshoreHours + MidSEOffshoreHours + AdvSEOffshoreHours + SenSEOffshoreHours + ConsArchOffshoreHours + ProjLeadOffshoreHours + ProjMgrOffshoreHours + ProgMgrOffshoreHours + JrProjMgrOffshoreHours + JrProgMgrOffshoreHours + SrProjMgrOffshoreHours + SrProgMgrOffshoreHours) / @OffshoreFTERate) 
				where AutoKey > @MaxProgGroup and RecNumber = 50
			end

		-- Populate TotalHours Column for record type 60 (horizontal add up).
		if ( @ITSABillingCatSelection = '-1' )
			begin
			update #TEMP_OUT set TotalHours = isnull(JrSEOnshoreHours,0) + isnull(JrSEOffshoreHours,0) + isnull(MidSEOnshoreHours,0) + isnull(MidSEOffshoreHours,0) + isnull(AdvSEOnshoreHours,0) + isnull(AdvSEOffshoreHours,0) + isnull(SenSEOnshoreHours,0) + isnull(SenSEOffshoreHours,0) + isnull(ConsArchOnshoreHours,0) + isnull(ConsArchOffshoreHours,0) + isnull(ProjLeadOnshoreHours,0) + isnull(ProjLeadOffshoreHours,0) + isnull(ProjMgrOnshoreHours,0) + isnull(ProjMgrOffshoreHours,0) + isnull(ProgMgrOnshoreHours,0) + isnull(ProgMgrOffshoreHours,0) + isnull(JrProjMgrOffshoreHours,0) + isnull(JrProgMgrOffshoreHours,0) + isnull(SrProjMgrOffshoreHours,0) + isnull(SrProgMgrOffshoreHours,0) + isnull(FTPStaffAugOnshoreHours,0) + isnull(FTPStaffAugOffshoreHours,0) 
				where AutoKey > @MaxProgGroup and RecNumber = 60
			update #TEMP_OUT set ActualFTEs = ( (JrSEOnshoreHours + MidSEOnshoreHours + AdvSEOnshoreHours + SenSEOnshoreHours + ConsArchOnshoreHours + ProjLeadOnshoreHours + ProjMgrOnshoreHours + ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (JrSEOffshoreHours + MidSEOffshoreHours + AdvSEOffshoreHours + SenSEOffshoreHours + ConsArchOffshoreHours + ProjLeadOffshoreHours + ProjMgrOffshoreHours + ProgMgrOffshoreHours + JrProjMgrOffshoreHours + JrProgMgrOffshoreHours + SrProjMgrOffshoreHours + SrProgMgrOffshoreHours) / @OffshoreFTERate) + ( (FTPStaffAugOnshoreHours + FTPStaffAugOffshoreHours) / @FTPBillingRate ) 
				where AutoKey > @MaxProgGroup and RecNumber = 60
			end
		else
			begin
			update #TEMP_OUT set TotalHours = isnull(JrSEOnshoreHours,0) + isnull(JrSEOffshoreHours,0) + isnull(MidSEOnshoreHours,0) + isnull(MidSEOffshoreHours,0) + isnull(AdvSEOnshoreHours,0) + isnull(AdvSEOffshoreHours,0) + isnull(SenSEOnshoreHours,0) + isnull(SenSEOffshoreHours,0) + isnull(ConsArchOnshoreHours,0) + isnull(ConsArchOffshoreHours,0) + isnull(ProjLeadOnshoreHours,0) + isnull(ProjLeadOffshoreHours,0) + isnull(ProjMgrOnshoreHours,0) + isnull(ProjMgrOffshoreHours,0) + isnull(ProgMgrOnshoreHours,0) + isnull(ProgMgrOffshoreHours,0) + isnull(JrProjMgrOffshoreHours,0) + isnull(JrProgMgrOffshoreHours,0) + isnull(SrProjMgrOffshoreHours,0) + isnull(SrProgMgrOffshoreHours,0) 
				where AutoKey > @MaxProgGroup and RecNumber = 60
			update #TEMP_OUT set ActualFTEs = ( (JrSEOnshoreHours + MidSEOnshoreHours + AdvSEOnshoreHours + SenSEOnshoreHours + ConsArchOnshoreHours + ProjLeadOnshoreHours + ProjMgrOnshoreHours + ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (JrSEOffshoreHours + MidSEOffshoreHours + AdvSEOffshoreHours + SenSEOffshoreHours + ConsArchOffshoreHours + ProjLeadOffshoreHours + ProjMgrOffshoreHours + ProgMgrOffshoreHours + JrProjMgrOffshoreHours + JrProgMgrOffshoreHours + SrProjMgrOffshoreHours + SrProgMgrOffshoreHours) / @OffshoreFTERate) 
				where AutoKey > @MaxProgGroup and RecNumber = 60
			end

	-- Update total information for 10 fields (vertical add up).
	if ( @ITSABillingCatSelection = '-1' )
		begin
		select @JrSEOnshore = sum(isnull(JrSEOnshoreHours,0)), @JrSEOffshore = sum(isnull(JrSeOffshoreHours,0)), @MidSEOnshore = sum(isnull(MidSEOnshoreHours,0)), @MidSEOffshore = sum(isnull(MidSEOffshoreHours,0)), @AdvSEOnshore = sum(isnull(AdvSEOnshoreHours,0)), @AdvSEOffshore = sum(isnull(AdvSEOffshoreHours,0)), @SenSEOnshore = sum(isnull(SenSEOnshoreHours,0)), @SenSEOffshore= sum(isnull(SenSEOffshoreHours,0)), @ConsArchOnshore = sum(isnull(ConsArchOnshoreHours,0)), @ConsArchOffshore= sum(isnull(ConsArchOffshoreHours,0)), @ProjLeadOnshore = sum(isnull(ProjLeadOnshoreHours,0)), @ProjLeadOffshore= sum(isnull(ProjLeadOffshoreHours,0)), @ProjMgrOnshore = sum(isnull(ProjMgrOnshoreHours,0)), @ProjMgrOffshore= sum(isnull(ProjMgrOffshoreHours,0)), @ProgMgrOnshore = sum(isnull(ProgMgrOnshoreHours,0)), @ProgMgrOffshore = sum(isnull(ProgMgrOffshoreHours,0)), @JrProjMgrOffshore = sum(isnull(JrProjMgrOffshoreHours,0)), @JrProgMgrOffshore = sum(isnull(JrProgMgrOffshoreHours,0)), @SrProjMgrOffshore = sum(isnull(SrProjMgrOffshoreHours,0)), @SrProgMgrOffshore = sum(isnull(SrProgMgrOffshoreHours,0)), @FTPStaffAugOnshore = sum(isnull(FTPStaffAugOnshoreHours,0)), @FTPStaffAugOffshore= sum(isnull(FTPStaffAugOffshoreHours,0)), @TotalHours = sum(isnull(TotalHours,0)) from #TEMP_OUT 
			where AutoKey > @MaxProgGroup and RecNumber = 40
		end
	else
		begin
		select @JrSEOnshore = sum(isnull(JrSEOnshoreHours,0)), @JrSEOffshore = sum(isnull(JrSeOffshoreHours,0)), @MidSEOnshore = sum(isnull(MidSEOnshoreHours,0)), @MidSEOffshore = sum(isnull(MidSEOffshoreHours,0)), @AdvSEOnshore = sum(isnull(AdvSEOnshoreHours,0)), @AdvSEOffshore = sum(isnull(AdvSEOffshoreHours,0)), @SenSEOnshore = sum(isnull(SenSEOnshoreHours,0)), @SenSEOffshore= sum(isnull(SenSEOffshoreHours,0)), @ConsArchOnshore = sum(isnull(ConsArchOnshoreHours,0)), @ConsArchOffshore= sum(isnull(ConsArchOffshoreHours,0)), @ProjLeadOnshore = sum(isnull(ProjLeadOnshoreHours,0)), @ProjLeadOffshore= sum(isnull(ProjLeadOffshoreHours,0)), @ProjMgrOnshore = sum(isnull(ProjMgrOnshoreHours,0)), @ProjMgrOffshore= sum(isnull(ProjMgrOffshoreHours,0)), @ProgMgrOnshore = sum(isnull(ProgMgrOnshoreHours,0)), @ProgMgrOffshore = sum(isnull(ProgMgrOffshoreHours,0)), @JrProjMgrOffshore = sum(isnull(JrProjMgrOffshoreHours,0)), @JrProgMgrOffshore = sum(isnull(JrProgMgrOffshoreHours,0)), @SrProgMgrOffshore = sum(isnull(SrProgMgrOffshoreHours,0)), @TotalHours = sum(isnull(TotalHours,0)) from #TEMP_OUT 
			where AutoKey > @MaxProgGroup and RecNumber = 40
		end
	select @COApprovedFTEs = sum(isnull(COApprovedFTEs,0)) from #TEMP_OUT where AutoKey > @MaxProgGroup and RecNumber = 30
	if ( @ITSABillingCatSelection = '-1' )
		begin
		update #TEMP_OUT set JrSEOnshoreHours = @JrSEOnshore, JrSeOffshoreHours = @JrSEOffshore, MidSEOnshoreHours = @MidSEOnshore, MidSEOffshoreHours = @MidSEOffshore, AdvSEOnshoreHours = @AdvSEOnshore, AdvSEOffshoreHours = @AdvSEOffshore, SenSEOnshoreHours = @SenSEOnshore, SenSEOffshoreHours = @SenSEOffshore, ConsArchOnshoreHours = @ConsArchOnshore, ConsArchOffshoreHours = @ConsArchOffshore, ProjLeadOnshoreHours = @ProjLeadOnshore, ProjLeadOffshoreHours = @ProjLeadOffshore, ProjMgrOnshoreHours = @ProjMgrOnshore, ProjMgrOffshoreHours = @ProjMgrOffshore, ProgMgrOnshoreHours = @ProgMgrOnshore, ProgMgrOffshoreHours = @ProgMgrOffshore, JrProjMgrOffshoreHours = @JrProjMgrOffshore, JrProgMgrOffshoreHours = @JrProgMgrOffshore, SrProjMgrOffshoreHours = @SrProjMgrOffshore, SrProgMgrOffshoreHours = @SrProgMgrOffshore, 
			FTPStaffAugOnshoreHours = @FTPStaffAugOnshore, FTPStaffAugOffshoreHours = @FTPStaffAugOffshore, TotalHours = @TotalHours, COApprovedFTEs = @COApprovedFTEs 
			where AutoKey = @MaxProgGroup
		update #TEMP_OUT set TotalFTEs = ( (JrSEOnshoreHours + MidSEOnshoreHours + AdvSEOnshoreHours + SenSEOnshoreHours + ConsArchOnshoreHours + ProjLeadOnshoreHours + ProjMgrOnshoreHours + ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (JrSEOffshoreHours + MidSEOffshoreHours + AdvSEOffshoreHours + SenSEOffshoreHours + ConsArchOffshoreHours + ProjLeadOffshoreHours + ProjMgrOffshoreHours + ProgMgrOffshoreHours + JrProjMgrOffshoreHours + JrProgMgrOffshoreHours) / @OffshoreFTERate), TotalFTPs = ( (FTPStaffAugOnshoreHours + FTPStaffAugOffshoreHours) / @FTPBillingRate ), ActualFTEs = ( (JrSEOnshoreHours + MidSEOnshoreHours + AdvSEOnshoreHours + SenSEOnshoreHours + ConsArchOnshoreHours + ProjLeadOnshoreHours + ProjMgrOnshoreHours + ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (JrSEOffshoreHours + MidSEOffshoreHours + AdvSEOffshoreHours + SenSEOffshoreHours + ConsArchOffshoreHours + ProjLeadOffshoreHours + ProjMgrOffshoreHours + ProgMgrOffshoreHours + JrProjMgrOffshoreHours + JrProgMgrOffshoreHours + SrProjMgrOffshoreHours + SrProgMgrOffshoreHours) / @OffshoreFTERate) + ( (FTPStaffAugOnshoreHours + FTPStaffAugOffshoreHours) / @FTPBillingRate ) 
			where AutoKey = @MaxProgGroup
		end
	else
		begin
		update #TEMP_OUT set JrSEOnshoreHours = @JrSEOnshore, JrSeOffshoreHours = @JrSEOffshore, MidSEOnshoreHours = @MidSEOnshore, MidSEOffshoreHours = @MidSEOffshore, AdvSEOnshoreHours = @AdvSEOnshore, AdvSEOffshoreHours = @AdvSEOffshore, SenSEOnshoreHours = @SenSEOnshore, SenSEOffshoreHours = @SenSEOffshore, ConsArchOnshoreHours = @ConsArchOnshore, ConsArchOffshoreHours = @ConsArchOffshore, ProjLeadOnshoreHours = @ProjLeadOnshore, ProjLeadOffshoreHours = @ProjLeadOffshore, ProjMgrOnshoreHours = @ProjMgrOnshore, ProjMgrOffshoreHours = @ProjMgrOffshore, ProgMgrOnshoreHours = @ProgMgrOnshore, ProgMgrOffshoreHours = @ProgMgrOffshore, JrProjMgrOffshoreHours = @JrProjMgrOffshore, JrProgMgrOffshoreHours = @JrProgMgrOffshore, SrProjMgrOffshoreHours = @SrProjMgrOffshore, SrProgMgrOffshoreHours = @SrProgMgrOffshore, TotalHours = @TotalHours, COApprovedFTEs = @COApprovedFTEs 
			where AutoKey = @MaxProgGroup
		update #TEMP_OUT set TotalFTEs = ( (JrSEOnshoreHours + MidSEOnshoreHours + AdvSEOnshoreHours + SenSEOnshoreHours + ConsArchOnshoreHours + ProjLeadOnshoreHours + ProjMgrOnshoreHours + ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (JrSEOffshoreHours + MidSEOffshoreHours + AdvSEOffshoreHours + SenSEOffshoreHours + ConsArchOffshoreHours + ProjLeadOffshoreHours + ProjMgrOffshoreHours + ProgMgrOffshoreHours) / @OffshoreFTERate), ActualFTEs = ( (JrSEOnshoreHours + MidSEOnshoreHours + AdvSEOnshoreHours + SenSEOnshoreHours + ConsArchOnshoreHours + ProjLeadOnshoreHours + ProjMgrOnshoreHours + ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (JrSEOffshoreHours + MidSEOffshoreHours + AdvSEOffshoreHours + SenSEOffshoreHours + ConsArchOffshoreHours + ProjLeadOffshoreHours + ProjMgrOffshoreHours + ProgMgrOffshoreHours + JrProjMgrOffshoreHours + JrProgMgrOffshoreHours + SrProjMgrOffshoreHours + SrProgMgrOffshoreHours) / @OffshoreFTERate) 
			where AutoKey = @MaxProgGroup
		end
	update #TEMP_OUT set EDSVariance = ActualFTEs - COApprovedFTEs where AutoKey = @MaxProgGroup

FETCH NEXT FROM ProgramGroup_cursor INTO @CurProgramGroup, @CurProg_GroupID, @UPVP
END
CLOSE ProgramGroup_cursor
DEALLOCATE ProgramGroup_cursor

-----------------------------------------------------------------------------------------------------------------------
-- Set all the NULL values to 0 for 60 records
update #TEMP_OUT set JrSEOnshoreHours = 0 where RecNumber = 60 and JrSEOnshoreHours is null 
update #TEMP_OUT set JrSeOffshoreHours = 0 where RecNumber = 60 and JrSeOffshoreHours is null 
update #TEMP_OUT set MidSEOnshoreHours = 0 where RecNumber = 60 and MidSEOnshoreHours is null 
update #TEMP_OUT set MidSEOffshoreHours = 0 where RecNumber = 60 and MidSEOffshoreHours is null 
update #TEMP_OUT set AdvSEOnshoreHours = 0 where RecNumber = 60 and AdvSEOnshoreHours is null 
update #TEMP_OUT set AdvSEOffshoreHours = 0 where RecNumber = 60 and AdvSEOffshoreHours is null 
update #TEMP_OUT set SenSEOnshoreHours = 0 where RecNumber = 60 and SenSEOnshoreHours is null 
update #TEMP_OUT set SenSEOffshoreHours = 0 where RecNumber = 60 and SenSEOffshoreHours is null 
update #TEMP_OUT set ConsArchOnshoreHours = 0 where RecNumber = 60 and ConsArchOnshoreHours is null 
update #TEMP_OUT set ConsArchOffshoreHours = 0 where RecNumber = 60 and ConsArchOffshoreHours is null 
update #TEMP_OUT set ProjLeadOnshoreHours = 0 where RecNumber = 60 and ProjLeadOnshoreHours is null 
update #TEMP_OUT set ProjLeadOffshoreHours = 0 where RecNumber = 60 and ProjLeadOffshoreHours is null 
update #TEMP_OUT set ProjMgrOnshoreHours = 0 where RecNumber = 60 and ProjMgrOnshoreHours is null 
update #TEMP_OUT set ProjMgrOffshoreHours = 0 where RecNumber = 60 and ProjMgrOffshoreHours is null 
update #TEMP_OUT set ProgMgrOnshoreHours = 0 where RecNumber = 60 and ProgMgrOnshoreHours is null 
update #TEMP_OUT set ProgMgrOffshoreHours = 0 where RecNumber = 60 and ProgMgrOffshoreHours is null 
update #TEMP_OUT set JrProjMgrOffshoreHours = 0 where RecNumber = 60 and JrProjMgrOffshoreHours is null 
update #TEMP_OUT set JrProgMgrOffshoreHours = 0 where RecNumber = 60 and JrProgMgrOffshoreHours is null 
update #TEMP_OUT set SrProjMgrOffshoreHours = 0 where RecNumber = 60 and SrProjMgrOffshoreHours is null 
update #TEMP_OUT set SrProgMgrOffshoreHours = 0 where RecNumber = 60 and SrProgMgrOffshoreHours is null 
update #TEMP_OUT set FTPStaffAugOnshoreHours = 0 where RecNumber = 60 and FTPStaffAugOnshoreHours is null 
update #TEMP_OUT set FTPStaffAugOffshoreHours = 0 where RecNumber = 60 and FTPStaffAugOffshoreHours is null 

----------------------------------------------------------------------------------------------------------------------
-- Calculate and Populate the RecNumber 0 records (Grand Total Continental)
if ( @ITSABillingCatSelection = '-1' )
	begin
	select @TotalHours = sum(isnull(TotalHours,0)), @COApprovedFTEs = sum(isnull(COApprovedFTEs,0)), @JrSEOnshoreHours = sum(isnull(JrSEOnshoreHours,0)), @JrSEOffshoreHours = sum(isnull(JrSEOffshoreHours,0)), @MidSEOnshoreHours = sum(isnull(MidSEOnshoreHours,0)), @MidSEOffshoreHours = sum(isnull(MidSEOffshoreHours,0)), @AdvSEOnshoreHours = sum(isnull(AdvSEOnshoreHours,0)), @AdvSEOffshoreHours = sum(isnull(AdvSEOffshoreHours,0)), @SenSEOnshoreHours = sum(isnull(SenSEOnshoreHours,0)), @SenSEOffshoreHours = sum(isnull(SenSEOffshoreHours,0)), @ConsArchOnshoreHours = sum(isnull(ConsArchOnshoreHours,0)), @ConsArchOffshoreHours = sum(isnull(ConsArchOffshoreHours,0)), @ProjLeadOnshoreHours = sum(isnull(ProjLeadOnshoreHours,0)), @ProjLeadOffshoreHours = sum(isnull(ProjLeadOffshoreHours,0)), @ProjMgrOnshoreHours = sum(isnull(ProjMgrOnshoreHours,0)), @ProjMgrOffshoreHours = sum(isnull(ProjMgrOffshoreHours,0)), @ProgMgrOnshoreHours = sum(isnull(ProgMgrOnshoreHours,0)), @ProgMgrOffshoreHours = sum(isnull(ProgMgrOffshoreHours,0)), @JrProjMgrOffshoreHours = sum(isnull(JrProjMgrOffshoreHours,0)), @JrProgMgrOffshoreHours = sum(isnull(JrProgMgrOffshoreHours,0)), @SrProjMgrOffshoreHours = sum(isnull(SrProjMgrOffshoreHours,0)), @SrProgMgrOffshoreHours = sum(isnull(SrProgMgrOffshoreHours,0)), @FTPStaffAugOnshoreHours = sum(isnull(FTPStaffAugOnshoreHours,0)), @FTPStaffAugOffshoreHours = sum(isnull(FTPStaffAugOffshoreHours,0)) from #TEMP_OUT 
		where RecNumber = 10
	update #TEMP_OUT set TotalHours = @TotalHours, COApprovedFTEs = @COApprovedFTEs, JrSEOnshoreHours = @JrSEOnshoreHours, JrSEOffshoreHours = @JrSEOffshoreHours, MidSEOnshoreHours = @MidSEOnshoreHours, MidSEOffshoreHours = @MidSEOffshoreHours, AdvSEOnshoreHours = @AdvSEOnshoreHours, AdvSEOffshoreHours = @AdvSEOffshoreHours, SenSEOnshoreHours = @SenSEOnshoreHours, SenSEOffshoreHours = @SenSEOffshoreHours, ConsArchOnshoreHours = @ConsArchOnshoreHours, ConsArchOffshoreHours = @ConsArchOffshoreHours, ProjLeadOnshoreHours = @ProjLeadOnshoreHours, ProjLeadOffshoreHours = @ProjLeadOffshoreHours, ProjMgrOnshoreHours = @ProjMgrOnshoreHours, ProjMgrOffshoreHours = @ProjMgrOffshoreHours, ProgMgrOnshoreHours = @ProgMgrOnshoreHours, ProgMgrOffshoreHours = @ProgMgrOffshoreHours, JrProjMgrOffshoreHours = @JrProjMgrOffshoreHours, JrProgMgrOffshoreHours = @JrProgMgrOffshoreHours, SrProjMgrOffshoreHours = @SrProjMgrOffshoreHours, SrProgMgrOffshoreHours = @SrProgMgrOffshoreHours, FTPStaffAugOnshoreHours = @FTPStaffAugOnshoreHours, FTPStaffAugOffshoreHours = @FTPStaffAugOffshoreHours 
		where RecNumber = 0 and RecType = 'GrandTotal'
	update #TEMP_OUT set TotalFTEs = ( (JrSEOnshoreHours + MidSEOnshoreHours + AdvSEOnshoreHours + SenSEOnshoreHours + ConsArchOnshoreHours + ProjLeadOnshoreHours + ProjMgrOnshoreHours + ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (JrSEOffshoreHours + MidSEOffshoreHours + AdvSEOffshoreHours + SenSEOffshoreHours + ConsArchOffshoreHours + ProjLeadOffshoreHours + ProjMgrOffshoreHours + ProgMgrOffshoreHours + JrProjMgrOffshoreHours + JrProgMgrOffshoreHours) / @OffshoreFTERate), TotalFTPs = ( (FTPStaffAugOnshoreHours + FTPStaffAugOffshoreHours) / @FTPBillingRate ), ActualFTEs = ( (JrSEOnshoreHours + MidSEOnshoreHours + AdvSEOnshoreHours + SenSEOnshoreHours + ConsArchOnshoreHours + ProjLeadOnshoreHours + ProjMgrOnshoreHours + ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (JrSEOffshoreHours + MidSEOffshoreHours + AdvSEOffshoreHours + SenSEOffshoreHours + ConsArchOffshoreHours + ProjLeadOffshoreHours + ProjMgrOffshoreHours + ProgMgrOffshoreHours + JrProjMgrOffshoreHours + JrProgMgrOffshoreHours + SrProjMgrOffshoreHours + SrProgMgrOffshoreHours) / @OffshoreFTERate) + ( (FTPStaffAugOnshoreHours + FTPStaffAugOffshoreHours) / @FTPBillingRate ) 
		where RecNumber = 0 and RecType = 'GrandTotal'
	update #TEMP_OUT set TotalHours = ( (@JrSEOnshoreHours + @MidSEOnshoreHours + @AdvSEOnshoreHours + @SenSEOnshoreHours + @ConsArchOnshoreHours + @ProjLeadOnshoreHours + @ProjMgrOnshoreHours + @ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (@JrSEOffshoreHours + @MidSEOffshoreHours + @AdvSEOffshoreHours + @SenSEOffshoreHours + @ConsArchOffshoreHours + @ProjLeadOffshoreHours + @ProjMgrOffshoreHours + @ProgMgrOffshoreHours + @JrProjMgrOffshoreHours + @JrProgMgrOffshoreHours) / @OffshoreFTERate) + ( (@FTPStaffAugOnshoreHours + @FTPStaffAugOffshoreHours) / @FTPBillingRate ), TotalFTEs = ( (@JrSEOnshoreHours + @MidSEOnshoreHours + @AdvSEOnshoreHours + @SenSEOnshoreHours + @ConsArchOnshoreHours + @ProjLeadOnshoreHours + @ProjMgrOnshoreHours + @ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (@JrSEOffshoreHours + @MidSEOffshoreHours + @AdvSEOffshoreHours + @SenSEOffshoreHours + @ConsArchOffshoreHours + @ProjLeadOffshoreHours + @ProjMgrOffshoreHours + @ProgMgrOffshoreHours + @JrProjMgrOffshoreHours + @JrProgMgrOffshoreHours) / @OffshoreFTERate), TotalFTPs = ( (@FTPStaffAugOnshoreHours + @FTPStaffAugOffshoreHours) / @FTPBillingRate ), ActualFTEs = ( (@JrSEOnshoreHours + @MidSEOnshoreHours + @AdvSEOnshoreHours + @SenSEOnshoreHours + @ConsArchOnshoreHours + @ProjLeadOnshoreHours + @ProjMgrOnshoreHours + @ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (@JrSEOffshoreHours + @MidSEOffshoreHours + @AdvSEOffshoreHours + @SenSEOffshoreHours + @ConsArchOffshoreHours + @ProjLeadOffshoreHours + @ProjMgrOffshoreHours + @ProgMgrOffshoreHours + @JrProjMgrOffshoreHours + @JrProgMgrOffshoreHours) / @OffshoreFTERate) + ( (@FTPStaffAugOnshoreHours + @FTPStaffAugOffshoreHours) / @FTPBillingRate ), COApprovedFTEs = @COApprovedFTEs, JrSEOnshoreHours = @JrSEOnshoreHours/@OnshoreFTERate, JrSEOffshoreHours = @JrSEOffshoreHours/@OffshoreFTERate, MidSEOnshoreHours = @MidSEOnshoreHours/@OnshoreFTERate, MidSEOffshoreHours = @MidSEOffshoreHours/@OffshoreFTERate, AdvSEOnshoreHours = @AdvSEOnshoreHours/@OnshoreFTERate, AdvSEOffshoreHours = @AdvSEOffshoreHours/@OffshoreFTERate, SenSEOnshoreHours = @SenSEOnshoreHours/@OnshoreFTERate, SenSEOffshoreHours = @SenSEOffshoreHours/@OffshoreFTERate, 	ConsArchOnshoreHours = @ConsArchOnshoreHours/@OnshoreFTERate, ConsArchOffshoreHours = @ConsArchOffshoreHours/@OffshoreFTERate, ProjLeadOnshoreHours = @ProjLeadOnshoreHours/@OnshoreFTERate, ProjLeadOffshoreHours = @ProjLeadOffshoreHours/@OffshoreFTERate, ProjMgrOnshoreHours = @ProjMgrOnshoreHours/@OnshoreFTERate, ProjMgrOffshoreHours = @ProjMgrOffshoreHours/@OffshoreFTERate, ProgMgrOnshoreHours = @ProgMgrOnshoreHours/@OnshoreFTERate, ProgMgrOffshoreHours = @ProgMgrOffshoreHours/@OffshoreFTERate, JrProjMgrOffshoreHours = @JrProjMgrOffshoreHours/@OffshoreFTERate, JrProgMgrOffshoreHours = @JrProgMgrOffshoreHours/@OffshoreFTERate, SrProjMgrOffshoreHours = @SrProjMgrOffshoreHours/@OffshoreFTERate, SrProgMgrOffshoreHours = @SrProgMgrOffshoreHours/@OffshoreFTERate, FTPStaffAugOnshoreHours = @FTPStaffAugOnshoreHours/@FTPBillingRate, FTPStaffAugOffshoreHours = @FTPStaffAugOffshoreHours/@FTPBillingRate 
		where RecNumber = 0 and RecType = 'GrandTotalConversion'
	end
else
	begin
	select @TotalHours = sum(isnull(TotalHours,0)), @COApprovedFTEs = sum(isnull(COApprovedFTEs,0)), @JrSEOnshoreHours = sum(isnull(JrSEOnshoreHours,0)), @JrSEOffshoreHours = sum(isnull(JrSEOffshoreHours,0)), @MidSEOnshoreHours = sum(isnull(MidSEOnshoreHours,0)), @MidSEOffshoreHours = sum(isnull(MidSEOffshoreHours,0)), @AdvSEOnshoreHours = sum(isnull(AdvSEOnshoreHours,0)), @AdvSEOffshoreHours = sum(isnull(AdvSEOffshoreHours,0)), @SenSEOnshoreHours = sum(isnull(SenSEOnshoreHours,0)), @SenSEOffshoreHours = sum(isnull(SenSEOffshoreHours,0)), @ConsArchOnshoreHours = sum(isnull(ConsArchOnshoreHours,0)), @ConsArchOffshoreHours = sum(isnull(ConsArchOffshoreHours,0)), @ProjLeadOnshoreHours = sum(isnull(ProjLeadOnshoreHours,0)), @ProjLeadOffshoreHours = sum(isnull(ProjLeadOffshoreHours,0)), @ProjMgrOnshoreHours = sum(isnull(ProjMgrOnshoreHours,0)), @ProjMgrOffshoreHours = sum(isnull(ProjMgrOffshoreHours,0)), @ProgMgrOnshoreHours = sum(isnull(ProgMgrOnshoreHours,0)), @ProgMgrOffshoreHours = sum(isnull(ProgMgrOffshoreHours,0)), @JrProjMgrOffshoreHours = sum(isnull(JrProjMgrOffshoreHours,0)), @JrProgMgrOffshoreHours = sum(isnull(JrProgMgrOffshoreHours,0)), @SrProjMgrOffshoreHours = sum(isnull(SrProjMgrOffshoreHours,0)), @SrProgMgrOffshoreHours = sum(isnull(SrProgMgrOffshoreHours,0)) from #TEMP_OUT 
		where RecNumber = 10
	update #TEMP_OUT set TotalHours = @TotalHours, COApprovedFTEs = @COApprovedFTEs, JrSEOnshoreHours = @JrSEOnshoreHours, JrSEOffshoreHours = @JrSEOffshoreHours, MidSEOnshoreHours = @MidSEOnshoreHours, MidSEOffshoreHours = @MidSEOffshoreHours, AdvSEOnshoreHours = @AdvSEOnshoreHours, AdvSEOffshoreHours = @AdvSEOffshoreHours, SenSEOnshoreHours = @SenSEOnshoreHours, SenSEOffshoreHours = @SenSEOffshoreHours, ConsArchOnshoreHours = @ConsArchOnshoreHours, ConsArchOffshoreHours = @ConsArchOffshoreHours, ProjLeadOnshoreHours = @ProjLeadOnshoreHours, ProjLeadOffshoreHours = @ProjLeadOffshoreHours, ProjMgrOnshoreHours = @ProjMgrOnshoreHours, ProjMgrOffshoreHours = @ProjMgrOffshoreHours, ProgMgrOnshoreHours = @ProgMgrOnshoreHours, ProgMgrOffshoreHours = @ProgMgrOffshoreHours, JrProjMgrOffshoreHours = @JrProjMgrOffshoreHours, JrProgMgrOffshoreHours = @JrProgMgrOffshoreHours, SrProjMgrOffshoreHours = @SrProjMgrOffshoreHours, SrProgMgrOffshoreHours = @SrProgMgrOffshoreHours
		where RecNumber = 0 and RecType = 'GrandTotal'
	update #TEMP_OUT set TotalFTEs = ( (JrSEOnshoreHours + MidSEOnshoreHours + AdvSEOnshoreHours + SenSEOnshoreHours + ConsArchOnshoreHours + ProjLeadOnshoreHours + ProjMgrOnshoreHours + ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (JrSEOffshoreHours + MidSEOffshoreHours + AdvSEOffshoreHours + SenSEOffshoreHours + ConsArchOffshoreHours + ProjLeadOffshoreHours + ProjMgrOffshoreHours + ProgMgrOffshoreHours + JrProjMgrOffshoreHours + JrProgMgrOffshoreHours) / @OffshoreFTERate), ActualFTEs = ( (JrSEOnshoreHours + MidSEOnshoreHours + AdvSEOnshoreHours + SenSEOnshoreHours + ConsArchOnshoreHours + ProjLeadOnshoreHours + ProjMgrOnshoreHours + ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (JrSEOffshoreHours + MidSEOffshoreHours + AdvSEOffshoreHours + SenSEOffshoreHours + ConsArchOffshoreHours + ProjLeadOffshoreHours + ProjMgrOffshoreHours + ProgMgrOffshoreHours + JrProjMgrOffshoreHours + JrProgMgrOffshoreHours + SrProjMgrOffshoreHours + SrProgMgrOffshoreHours) / @OffshoreFTERate) 
		where RecNumber = 0 and RecType = 'GrandTotal'
	update #TEMP_OUT set TotalHours = ( (@JrSEOnshoreHours + @MidSEOnshoreHours + @AdvSEOnshoreHours + @SenSEOnshoreHours + @ConsArchOnshoreHours + @ProjLeadOnshoreHours + @ProjMgrOnshoreHours + @ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (@JrSEOffshoreHours + @MidSEOffshoreHours + @AdvSEOffshoreHours + @SenSEOffshoreHours + @ConsArchOffshoreHours + @ProjLeadOffshoreHours + @ProjMgrOffshoreHours + @ProgMgrOffshoreHours + @JrProjMgrOffshoreHours + @JrProgMgrOffshoreHours) / @OffshoreFTERate), TotalFTEs = ( (@JrSEOnshoreHours + @MidSEOnshoreHours + @AdvSEOnshoreHours + @SenSEOnshoreHours + @ConsArchOnshoreHours + @ProjLeadOnshoreHours + @ProjMgrOnshoreHours + @ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (@JrSEOffshoreHours + @MidSEOffshoreHours + @AdvSEOffshoreHours + @SenSEOffshoreHours + @ConsArchOffshoreHours + @ProjLeadOffshoreHours + @ProjMgrOffshoreHours + @ProgMgrOffshoreHours + @JrProjMgrOffshoreHours + @JrProgMgrOffshoreHours) / @OffshoreFTERate), ActualFTEs = ( (@JrSEOnshoreHours + @MidSEOnshoreHours + @AdvSEOnshoreHours + @SenSEOnshoreHours + @ConsArchOnshoreHours + @ProjLeadOnshoreHours + @ProjMgrOnshoreHours + @ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (@JrSEOffshoreHours + @MidSEOffshoreHours + @AdvSEOffshoreHours + @SenSEOffshoreHours + @ConsArchOffshoreHours + @ProjLeadOffshoreHours + @ProjMgrOffshoreHours + @ProgMgrOffshoreHours + @JrProjMgrOffshoreHours + @JrProgMgrOffshoreHours) / @OffshoreFTERate), COApprovedFTEs = @COApprovedFTEs, JrSEOnshoreHours = @JrSEOnshoreHours/@OnshoreFTERate, JrSEOffshoreHours = @JrSEOffshoreHours/@OffshoreFTERate, MidSEOnshoreHours = @MidSEOnshoreHours/@OnshoreFTERate, MidSEOffshoreHours = @MidSEOffshoreHours/@OffshoreFTERate, AdvSEOnshoreHours = @AdvSEOnshoreHours/@OnshoreFTERate, AdvSEOffshoreHours = @AdvSEOffshoreHours/@OffshoreFTERate, SenSEOnshoreHours = @SenSEOnshoreHours/@OnshoreFTERate, SenSEOffshoreHours = @SenSEOffshoreHours/@OffshoreFTERate, ConsArchOnshoreHours = @ConsArchOnshoreHours/@OnshoreFTERate, ConsArchOffshoreHours = @ConsArchOffshoreHours/@OffshoreFTERate, ProjLeadOnshoreHours = @ProjLeadOnshoreHours/@OnshoreFTERate, ProjLeadOffshoreHours = @ProjLeadOffshoreHours/@OffshoreFTERate, ProjMgrOnshoreHours = @ProjMgrOnshoreHours/@OnshoreFTERate, ProjMgrOffshoreHours = @ProjMgrOffshoreHours/@OffshoreFTERate, ProgMgrOnshoreHours = @ProgMgrOnshoreHours/@OnshoreFTERate, ProgMgrOffshoreHours = @ProgMgrOffshoreHours/@OffshoreFTERate, JrProjMgrOffshoreHours = @JrProjMgrOffshoreHours/@OffshoreFTERate, JrProgMgrOffshoreHours = @JrProgMgrOffshoreHours/@OffshoreFTERate, SrProjMgrOffshoreHours = @SrProjMgrOffshoreHours/@OffshoreFTERate, SrProgMgrOffshoreHours = @SrProgMgrOffshoreHours/@OffshoreFTERate
		where RecNumber = 0 and RecType = 'GrandTotalConversion'
	end
update #TEMP_OUT set EDSVariance = ActualFTEs - COApprovedFTEs where RecNumber = 0 and RecType in ('GrandTotal', 'GrandTotalConversion')

-- Calculate and Populate the 1 records (Total Airline)
if ( @ITSABillingCatSelection = '-1' )
	begin
	select @TotalHours = sum(isnull(TotalHours,0)), @COApprovedFTEs = sum(isnull(COApprovedFTEs,0)), @JrSEOnshoreHours = sum(isnull(JrSEOnshoreHours,0)), @JrSEOffshoreHours = sum(isnull(JrSEOffshoreHours,0)), @MidSEOnshoreHours = sum(isnull(MidSEOnshoreHours,0)), @MidSEOffshoreHours = sum(isnull(MidSEOffshoreHours,0)), @AdvSEOnshoreHours = sum(isnull(AdvSEOnshoreHours,0)), @AdvSEOffshoreHours = sum(isnull(AdvSEOffshoreHours,0)), @SenSEOnshoreHours = sum(isnull(SenSEOnshoreHours,0)), @SenSEOffshoreHours = sum(isnull(SenSEOffshoreHours,0)), @ConsArchOnshoreHours = sum(isnull(ConsArchOnshoreHours,0)), @ConsArchOffshoreHours = sum(isnull(ConsArchOffshoreHours,0)), @ProjLeadOnshoreHours = sum(isnull(ProjLeadOnshoreHours,0)), @ProjLeadOffshoreHours = sum(isnull(ProjLeadOffshoreHours,0)), @ProjMgrOnshoreHours = sum(isnull(ProjMgrOnshoreHours,0)), @ProjMgrOffshoreHours = sum(isnull(ProjMgrOffshoreHours,0)), @ProgMgrOnshoreHours = sum(isnull(ProgMgrOnshoreHours,0)), @ProgMgrOffshoreHours = sum(isnull(ProgMgrOffshoreHours,0)), @JrProjMgrOffshoreHours = sum(isnull(JrProjMgrOffshoreHours,0)), @JrProgMgrOffshoreHours = sum(isnull(JrProgMgrOffshoreHours,0)), @SrProjMgrOffshoreHours = sum(isnull(SrProjMgrOffshoreHours,0)), @SrProgMgrOffshoreHours = sum(isnull(SrProgMgrOffshoreHours,0)), @FTPStaffAugOnshoreHours = sum(isnull(FTPStaffAugOnshoreHours,0)), @FTPStaffAugOffshoreHours = sum(isnull(FTPStaffAugOffshoreHours,0)) from #TEMP_OUT 
		where RecNumber = 30 and ITSABillingCat = 'Airline'
	update #TEMP_OUT set TotalHours = @TotalHours, COApprovedFTEs = @COApprovedFTEs, JrSEOnshoreHours = @JrSEOnshoreHours, JrSEOffshoreHours = @JrSEOffshoreHours, MidSEOnshoreHours = @MidSEOnshoreHours, MidSEOffshoreHours = @MidSEOffshoreHours, AdvSEOnshoreHours = @AdvSEOnshoreHours, AdvSEOffshoreHours = @AdvSEOffshoreHours, SenSEOnshoreHours = @SenSEOnshoreHours, SenSEOffshoreHours = @SenSEOffshoreHours, ConsArchOnshoreHours = @ConsArchOnshoreHours, ConsArchOffshoreHours = @ConsArchOffshoreHours, ProjLeadOnshoreHours = @ProjLeadOnshoreHours, ProjLeadOffshoreHours = @ProjLeadOffshoreHours, ProjMgrOnshoreHours = @ProjMgrOnshoreHours, ProjMgrOffshoreHours = @ProjMgrOffshoreHours, ProgMgrOnshoreHours = @ProgMgrOnshoreHours, ProgMgrOffshoreHours = @ProgMgrOffshoreHours, JrProjMgrOffshoreHours = @JrProjMgrOffshoreHours, JrProgMgrOffshoreHours = @JrProgMgrOffshoreHours, SrProjMgrOffshoreHours = @SrProjMgrOffshoreHours, SrProgMgrOffshoreHours = @SrProgMgrOffshoreHours, FTPStaffAugOnshoreHours = @FTPStaffAugOnshoreHours, FTPStaffAugOffshoreHours = @FTPStaffAugOffshoreHours 
		where RecNumber = 1 and RecType = 'TotalAirline'
	update #TEMP_OUT set TotalFTEs = ( (JrSEOnshoreHours + MidSEOnshoreHours + AdvSEOnshoreHours + SenSEOnshoreHours + ConsArchOnshoreHours + ProjLeadOnshoreHours + ProjMgrOnshoreHours + ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (JrSEOffshoreHours + MidSEOffshoreHours + AdvSEOffshoreHours + SenSEOffshoreHours + ConsArchOffshoreHours + ProjLeadOffshoreHours + ProjMgrOffshoreHours + ProgMgrOffshoreHours + JrProjMgrOffshoreHours + JrProgMgrOffshoreHours) / @OffshoreFTERate), TotalFTPs = ( (FTPStaffAugOnshoreHours + FTPStaffAugOffshoreHours) / @FTPBillingRate ), ActualFTEs = ( (JrSEOnshoreHours + MidSEOnshoreHours + AdvSEOnshoreHours + SenSEOnshoreHours + ConsArchOnshoreHours + ProjLeadOnshoreHours + ProjMgrOnshoreHours + ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (JrSEOffshoreHours + MidSEOffshoreHours + AdvSEOffshoreHours + SenSEOffshoreHours + ConsArchOffshoreHours + ProjLeadOffshoreHours + ProjMgrOffshoreHours + ProgMgrOffshoreHours + JrProjMgrOffshoreHours + JrProgMgrOffshoreHours + SrProjMgrOffshoreHours + SrProgMgrOffshoreHours) / @OffshoreFTERate) + ( (FTPStaffAugOnshoreHours + FTPStaffAugOffshoreHours) / @FTPBillingRate ) 
		where RecNumber = 1 and RecType = 'TotalAirline'
	update #TEMP_OUT set TotalHours = ( (@JrSEOnshoreHours + @MidSEOnshoreHours + @AdvSEOnshoreHours + @SenSEOnshoreHours + @ConsArchOnshoreHours + @ProjLeadOnshoreHours + @ProjMgrOnshoreHours + @ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (@JrSEOffshoreHours + @MidSEOffshoreHours + @AdvSEOffshoreHours + @SenSEOffshoreHours + @ConsArchOffshoreHours + @ProjLeadOffshoreHours + @ProjMgrOffshoreHours + @ProgMgrOffshoreHours + @JrProjMgrOffshoreHours + @JrProgMgrOffshoreHours) / @OffshoreFTERate) + ( (@FTPStaffAugOnshoreHours + @FTPStaffAugOffshoreHours) / @FTPBillingRate ), TotalFTEs = ( (@JrSEOnshoreHours + @MidSEOnshoreHours + @AdvSEOnshoreHours + @SenSEOnshoreHours + @ConsArchOnshoreHours + @ProjLeadOnshoreHours + @ProjMgrOnshoreHours + @ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (@JrSEOffshoreHours + @MidSEOffshoreHours + @AdvSEOffshoreHours + @SenSEOffshoreHours + @ConsArchOffshoreHours + @ProjLeadOffshoreHours + @ProjMgrOffshoreHours + @ProgMgrOffshoreHours + @JrProjMgrOffshoreHours + @JrProgMgrOffshoreHours) / @OffshoreFTERate), TotalFTPs = ( (@FTPStaffAugOnshoreHours + @FTPStaffAugOffshoreHours) / @FTPBillingRate ), ActualFTEs = ( (@JrSEOnshoreHours + @MidSEOnshoreHours + @AdvSEOnshoreHours + @SenSEOnshoreHours + @ConsArchOnshoreHours + @ProjLeadOnshoreHours + @ProjMgrOnshoreHours + @ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (@JrSEOffshoreHours + @MidSEOffshoreHours + @AdvSEOffshoreHours + @SenSEOffshoreHours + @ConsArchOffshoreHours + @ProjLeadOffshoreHours + @ProjMgrOffshoreHours + @ProgMgrOffshoreHours + @JrProjMgrOffshoreHours + @JrProgMgrOffshoreHours) / @OffshoreFTERate) + ( (@FTPStaffAugOnshoreHours + @FTPStaffAugOffshoreHours) / @FTPBillingRate ), COApprovedFTEs = @COApprovedFTEs, JrSEOnshoreHours = @JrSEOnshoreHours/@OnshoreFTERate, JrSEOffshoreHours = @JrSEOffshoreHours/@OffshoreFTERate, MidSEOnshoreHours = @MidSEOnshoreHours/@OnshoreFTERate, MidSEOffshoreHours = @MidSEOffshoreHours/@OffshoreFTERate, AdvSEOnshoreHours = @AdvSEOnshoreHours/@OnshoreFTERate, AdvSEOffshoreHours = @AdvSEOffshoreHours/@OffshoreFTERate, SenSEOnshoreHours = @SenSEOnshoreHours/@OnshoreFTERate, SenSEOffshoreHours = @SenSEOffshoreHours/@OffshoreFTERate, 	ConsArchOnshoreHours = @ConsArchOnshoreHours/@OnshoreFTERate, ConsArchOffshoreHours = @ConsArchOffshoreHours/@OffshoreFTERate, ProjLeadOnshoreHours = @ProjLeadOnshoreHours/@OnshoreFTERate, ProjLeadOffshoreHours = @ProjLeadOffshoreHours/@OffshoreFTERate, ProjMgrOnshoreHours = @ProjMgrOnshoreHours/@OnshoreFTERate, ProjMgrOffshoreHours = @ProjMgrOffshoreHours/@OffshoreFTERate, ProgMgrOnshoreHours = @ProgMgrOnshoreHours/@OnshoreFTERate, ProgMgrOffshoreHours = @ProgMgrOffshoreHours/@OffshoreFTERate, JrProjMgrOffshoreHours = @JrProjMgrOffshoreHours/@OffshoreFTERate, JrProgMgrOffshoreHours = @JrProgMgrOffshoreHours/@OffshoreFTERate, SrProjMgrOffshoreHours = @SrProjMgrOffshoreHours/@OffshoreFTERate, SrProgMgrOffshoreHours = @SrProgMgrOffshoreHours/@OffshoreFTERate, FTPStaffAugOnshoreHours = @FTPStaffAugOnshoreHours/@FTPBillingRate, FTPStaffAugOffshoreHours = @FTPStaffAugOffshoreHours/@FTPBillingRate 
		where RecNumber = 1 and RecType = 'TotalAirlineConversion'
	end
else
	begin
	select @TotalHours = sum(isnull(TotalHours,0)), @COApprovedFTEs = sum(isnull(COApprovedFTEs,0)), @JrSEOnshoreHours = sum(isnull(JrSEOnshoreHours,0)), @JrSEOffshoreHours = sum(isnull(JrSEOffshoreHours,0)), @MidSEOnshoreHours = sum(isnull(MidSEOnshoreHours,0)), @MidSEOffshoreHours = sum(isnull(MidSEOffshoreHours,0)), @AdvSEOnshoreHours = sum(isnull(AdvSEOnshoreHours,0)), @AdvSEOffshoreHours = sum(isnull(AdvSEOffshoreHours,0)), @SenSEOnshoreHours = sum(isnull(SenSEOnshoreHours,0)), @SenSEOffshoreHours = sum(isnull(SenSEOffshoreHours,0)), @ConsArchOnshoreHours = sum(isnull(ConsArchOnshoreHours,0)), @ConsArchOffshoreHours = sum(isnull(ConsArchOffshoreHours,0)), @ProjLeadOnshoreHours = sum(isnull(ProjLeadOnshoreHours,0)), @ProjLeadOffshoreHours = sum(isnull(ProjLeadOffshoreHours,0)), @ProjMgrOnshoreHours = sum(isnull(ProjMgrOnshoreHours,0)), @ProjMgrOffshoreHours = sum(isnull(ProjMgrOffshoreHours,0)), @ProgMgrOnshoreHours = sum(isnull(ProgMgrOnshoreHours,0)), @ProgMgrOffshoreHours = sum(isnull(ProgMgrOffshoreHours,0)), @JrProjMgrOffshoreHours = sum(isnull(JrProjMgrOffshoreHours,0)), @JrProgMgrOffshoreHours = sum(isnull(JrProgMgrOffshoreHours,0)), @SrProjMgrOffshoreHours = sum(isnull(SrProjMgrOffshoreHours,0)), @SrProgMgrOffshoreHours = sum(isnull(SrProgMgrOffshoreHours,0)) from #TEMP_OUT 
		where RecNumber = 30 and ITSABillingCat = 'Airline'
	update #TEMP_OUT set TotalHours = @TotalHours, COApprovedFTEs = @COApprovedFTEs, JrSEOnshoreHours = @JrSEOnshoreHours, JrSEOffshoreHours = @JrSEOffshoreHours, MidSEOnshoreHours = @MidSEOnshoreHours, MidSEOffshoreHours = @MidSEOffshoreHours, AdvSEOnshoreHours = @AdvSEOnshoreHours, AdvSEOffshoreHours = @AdvSEOffshoreHours, SenSEOnshoreHours = @SenSEOnshoreHours, SenSEOffshoreHours = @SenSEOffshoreHours, ConsArchOnshoreHours = @ConsArchOnshoreHours, ConsArchOffshoreHours = @ConsArchOffshoreHours, ProjLeadOnshoreHours = @ProjLeadOnshoreHours, ProjLeadOffshoreHours = @ProjLeadOffshoreHours, ProjMgrOnshoreHours = @ProjMgrOnshoreHours, ProjMgrOffshoreHours = @ProjMgrOffshoreHours, ProgMgrOnshoreHours = @ProgMgrOnshoreHours, ProgMgrOffshoreHours = @ProgMgrOffshoreHours, JrProjMgrOffshoreHours = @JrProjMgrOffshoreHours, JrProgMgrOffshoreHours = @JrProgMgrOffshoreHours, SrProjMgrOffshoreHours = @SrProjMgrOffshoreHours, SrProgMgrOffshoreHours = @SrProgMgrOffshoreHours, FTPStaffAugOnshoreHours = @FTPStaffAugOnshoreHours, FTPStaffAugOffshoreHours = @FTPStaffAugOffshoreHours 
		where RecNumber = 1 and RecType = 'TotalAirline'
	update #TEMP_OUT set TotalFTEs = ( (JrSEOnshoreHours + MidSEOnshoreHours + AdvSEOnshoreHours + SenSEOnshoreHours + ConsArchOnshoreHours + ProjLeadOnshoreHours + ProjMgrOnshoreHours + ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (JrSEOffshoreHours + MidSEOffshoreHours + AdvSEOffshoreHours + SenSEOffshoreHours + ConsArchOffshoreHours + ProjLeadOffshoreHours + ProjMgrOffshoreHours + ProgMgrOffshoreHours + JrProjMgrOffshoreHours + JrProgMgrOffshoreHours) / @OffshoreFTERate), ActualFTEs = ( (JrSEOnshoreHours + MidSEOnshoreHours + AdvSEOnshoreHours + SenSEOnshoreHours + ConsArchOnshoreHours + ProjLeadOnshoreHours + ProjMgrOnshoreHours + ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (JrSEOffshoreHours + MidSEOffshoreHours + AdvSEOffshoreHours + SenSEOffshoreHours + ConsArchOffshoreHours + ProjLeadOffshoreHours + ProjMgrOffshoreHours + ProgMgrOffshoreHours + JrProjMgrOffshoreHours + JrProgMgrOffshoreHours + SrProjMgrOffshoreHours + SrProgMgrOffshoreHours) / @OffshoreFTERate) 
		where RecNumber = 1 and RecType = 'TotalAirline'
	update #TEMP_OUT set TotalHours = ( (@JrSEOnshoreHours + @MidSEOnshoreHours + @AdvSEOnshoreHours + @SenSEOnshoreHours + @ConsArchOnshoreHours + @ProjLeadOnshoreHours + @ProjMgrOnshoreHours + @ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (@JrSEOffshoreHours + @MidSEOffshoreHours + @AdvSEOffshoreHours + @SenSEOffshoreHours + @ConsArchOffshoreHours + @ProjLeadOffshoreHours + @ProjMgrOffshoreHours + @ProgMgrOffshoreHours + @JrProjMgrOffshoreHours + @JrProgMgrOffshoreHours) / @OffshoreFTERate), TotalFTEs = ( (@JrSEOnshoreHours + @MidSEOnshoreHours + @AdvSEOnshoreHours + @SenSEOnshoreHours + @ConsArchOnshoreHours + @ProjLeadOnshoreHours + @ProjMgrOnshoreHours + @ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (@JrSEOffshoreHours + @MidSEOffshoreHours + @AdvSEOffshoreHours + @SenSEOffshoreHours + @ConsArchOffshoreHours + @ProjLeadOffshoreHours + @ProjMgrOffshoreHours + @ProgMgrOffshoreHours + @JrProjMgrOffshoreHours + @JrProgMgrOffshoreHours) / @OffshoreFTERate), ActualFTEs = ( (@JrSEOnshoreHours + @MidSEOnshoreHours + @AdvSEOnshoreHours + @SenSEOnshoreHours + @ConsArchOnshoreHours + @ProjLeadOnshoreHours + @ProjMgrOnshoreHours + @ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (@JrSEOffshoreHours + @MidSEOffshoreHours + @AdvSEOffshoreHours + @SenSEOffshoreHours + @ConsArchOffshoreHours + @ProjLeadOffshoreHours + @ProjMgrOffshoreHours + @ProgMgrOffshoreHours + @JrProjMgrOffshoreHours + @JrProgMgrOffshoreHours) / @OffshoreFTERate), COApprovedFTEs = @COApprovedFTEs, JrSEOnshoreHours = @JrSEOnshoreHours/@OnshoreFTERate, JrSEOffshoreHours = @JrSEOffshoreHours/@OffshoreFTERate, MidSEOnshoreHours = @MidSEOnshoreHours/@OnshoreFTERate, MidSEOffshoreHours = @MidSEOffshoreHours/@OffshoreFTERate, AdvSEOnshoreHours = @AdvSEOnshoreHours/@OnshoreFTERate, AdvSEOffshoreHours = @AdvSEOffshoreHours/@OffshoreFTERate, SenSEOnshoreHours = @SenSEOnshoreHours/@OnshoreFTERate, SenSEOffshoreHours = @SenSEOffshoreHours/@OffshoreFTERate, ConsArchOnshoreHours = @ConsArchOnshoreHours/@OnshoreFTERate, ConsArchOffshoreHours = @ConsArchOffshoreHours/@OffshoreFTERate, ProjLeadOnshoreHours = @ProjLeadOnshoreHours/@OnshoreFTERate, ProjLeadOffshoreHours = @ProjLeadOffshoreHours/@OffshoreFTERate, ProjMgrOnshoreHours = @ProjMgrOnshoreHours/@OnshoreFTERate, ProjMgrOffshoreHours = @ProjMgrOffshoreHours/@OffshoreFTERate, ProgMgrOnshoreHours = @ProgMgrOnshoreHours/@OnshoreFTERate, ProgMgrOffshoreHours = @ProgMgrOffshoreHours/@OffshoreFTERate, JrProjMgrOffshoreHours = @JrProjMgrOffshoreHours/@OffshoreFTERate, JrProgMgrOffshoreHours = @JrProgMgrOffshoreHours/@OffshoreFTERate, SrProjMgrOffshoreHours = @SrProjMgrOffshoreHours/@OffshoreFTERate, SrProgMgrOffshoreHours = @SrProgMgrOffshoreHours/@OffshoreFTERate
		where RecNumber = 1 and RecType = 'TotalAirlineConversion'
	end
update #TEMP_OUT set EDSVariance = ActualFTEs - COApprovedFTEs where RecNumber = 1 and RecType in ('TotalAirline', 'TotalAirlineConversion')

-- Calculate and Populate the 2 records (Total ADM)
if ( @ITSABillingCatSelection = '-1' )
	begin
	select @TotalHours = sum(isnull(TotalHours,0)), @COApprovedFTEs = sum(isnull(COApprovedFTEs,0)), @JrSEOnshoreHours = sum(isnull(JrSEOnshoreHours,0)), @JrSEOffshoreHours = sum(isnull(JrSEOffshoreHours,0)), @MidSEOnshoreHours = sum(isnull(MidSEOnshoreHours,0)), @MidSEOffshoreHours = sum(isnull(MidSEOffshoreHours,0)), @AdvSEOnshoreHours = sum(isnull(AdvSEOnshoreHours,0)), @AdvSEOffshoreHours = sum(isnull(AdvSEOffshoreHours,0)), @SenSEOnshoreHours = sum(isnull(SenSEOnshoreHours,0)), @SenSEOffshoreHours = sum(isnull(SenSEOffshoreHours,0)), @ConsArchOnshoreHours = sum(isnull(ConsArchOnshoreHours,0)), @ConsArchOffshoreHours = sum(isnull(ConsArchOffshoreHours,0)), @ProjLeadOnshoreHours = sum(isnull(ProjLeadOnshoreHours,0)), @ProjLeadOffshoreHours = sum(isnull(ProjLeadOffshoreHours,0)), @ProjMgrOnshoreHours = sum(isnull(ProjMgrOnshoreHours,0)), @ProjMgrOffshoreHours = sum(isnull(ProjMgrOffshoreHours,0)), @ProgMgrOnshoreHours = sum(isnull(ProgMgrOnshoreHours,0)), @ProgMgrOffshoreHours = sum(isnull(ProgMgrOffshoreHours,0)), @JrProjMgrOffshoreHours = sum(isnull(JrProjMgrOffshoreHours,0)), @JrProgMgrOffshoreHours = sum(isnull(JrProgMgrOffshoreHours,0)), @SrProjMgrOffshoreHours = sum(isnull(SrProjMgrOffshoreHours,0)), @SrProgMgrOffshoreHours = sum(isnull(SrProgMgrOffshoreHours,0)), @FTPStaffAugOnshoreHours = sum(isnull(FTPStaffAugOnshoreHours,0)), @FTPStaffAugOffshoreHours = sum(isnull(FTPStaffAugOffshoreHours,0)) from #TEMP_OUT 
		where RecNumber = 30 and ITSABillingCat = 'ADM'
	update #TEMP_OUT set TotalHours = @TotalHours, COApprovedFTEs = @COApprovedFTEs, JrSEOnshoreHours = @JrSEOnshoreHours, JrSEOffshoreHours = @JrSEOffshoreHours, MidSEOnshoreHours = @MidSEOnshoreHours, MidSEOffshoreHours = @MidSEOffshoreHours, AdvSEOnshoreHours = @AdvSEOnshoreHours, AdvSEOffshoreHours = @AdvSEOffshoreHours, SenSEOnshoreHours = @SenSEOnshoreHours, SenSEOffshoreHours = @SenSEOffshoreHours, ConsArchOnshoreHours = @ConsArchOnshoreHours, ConsArchOffshoreHours = @ConsArchOffshoreHours, ProjLeadOnshoreHours = @ProjLeadOnshoreHours, ProjLeadOffshoreHours = @ProjLeadOffshoreHours, ProjMgrOnshoreHours = @ProjMgrOnshoreHours, ProjMgrOffshoreHours = @ProjMgrOffshoreHours, ProgMgrOnshoreHours = @ProgMgrOnshoreHours, ProgMgrOffshoreHours = @ProgMgrOffshoreHours, JrProjMgrOffshoreHours = @JrProjMgrOffshoreHours, JrProgMgrOffshoreHours = @JrProgMgrOffshoreHours, SrProjMgrOffshoreHours = @SrProjMgrOffshoreHours, SrProgMgrOffshoreHours = @SrProgMgrOffshoreHours, FTPStaffAugOnshoreHours = @FTPStaffAugOnshoreHours, FTPStaffAugOffshoreHours = @FTPStaffAugOffshoreHours 
		where RecNumber = 2 and RecType = 'TotalADM'
	update #TEMP_OUT set TotalFTEs = ( (JrSEOnshoreHours + MidSEOnshoreHours + AdvSEOnshoreHours + SenSEOnshoreHours + ConsArchOnshoreHours + ProjLeadOnshoreHours + ProjMgrOnshoreHours + ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (JrSEOffshoreHours + MidSEOffshoreHours + AdvSEOffshoreHours + SenSEOffshoreHours + ConsArchOffshoreHours + ProjLeadOffshoreHours + ProjMgrOffshoreHours + ProgMgrOffshoreHours + JrProjMgrOffshoreHours + JrProgMgrOffshoreHours) / @OffshoreFTERate), TotalFTPs = ( (FTPStaffAugOnshoreHours + FTPStaffAugOffshoreHours) / @FTPBillingRate ), ActualFTEs = ( (JrSEOnshoreHours + MidSEOnshoreHours + AdvSEOnshoreHours + SenSEOnshoreHours + ConsArchOnshoreHours + ProjLeadOnshoreHours + ProjMgrOnshoreHours + ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (JrSEOffshoreHours + MidSEOffshoreHours + AdvSEOffshoreHours + SenSEOffshoreHours + ConsArchOffshoreHours + ProjLeadOffshoreHours + ProjMgrOffshoreHours + ProgMgrOffshoreHours + JrProjMgrOffshoreHours + JrProgMgrOffshoreHours + SrProjMgrOffshoreHours + SrProgMgrOffshoreHours) / @OffshoreFTERate) + ( (FTPStaffAugOnshoreHours + FTPStaffAugOffshoreHours) / @FTPBillingRate ) 
		where RecNumber = 2 and RecType = 'TotalADM'
	update #TEMP_OUT set TotalHours = ( (@JrSEOnshoreHours + @MidSEOnshoreHours + @AdvSEOnshoreHours + @SenSEOnshoreHours + @ConsArchOnshoreHours + @ProjLeadOnshoreHours + @ProjMgrOnshoreHours + @ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (@JrSEOffshoreHours + @MidSEOffshoreHours + @AdvSEOffshoreHours + @SenSEOffshoreHours + @ConsArchOffshoreHours + @ProjLeadOffshoreHours + @ProjMgrOffshoreHours + @ProgMgrOffshoreHours + @JrProjMgrOffshoreHours + @JrProgMgrOffshoreHours) / @OffshoreFTERate) + ( (@FTPStaffAugOnshoreHours + @FTPStaffAugOffshoreHours) / @FTPBillingRate ), TotalFTEs = ( (@JrSEOnshoreHours + @MidSEOnshoreHours + @AdvSEOnshoreHours + @SenSEOnshoreHours + @ConsArchOnshoreHours + @ProjLeadOnshoreHours + @ProjMgrOnshoreHours + @ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (@JrSEOffshoreHours + @MidSEOffshoreHours + @AdvSEOffshoreHours + @SenSEOffshoreHours + @ConsArchOffshoreHours + @ProjLeadOffshoreHours + @ProjMgrOffshoreHours + @ProgMgrOffshoreHours + @JrProjMgrOffshoreHours + @JrProgMgrOffshoreHours) / @OffshoreFTERate), TotalFTPs = ( (@FTPStaffAugOnshoreHours + @FTPStaffAugOffshoreHours) / @FTPBillingRate ), ActualFTEs = ( (@JrSEOnshoreHours + @MidSEOnshoreHours + @AdvSEOnshoreHours + @SenSEOnshoreHours + @ConsArchOnshoreHours + @ProjLeadOnshoreHours + @ProjMgrOnshoreHours + @ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (@JrSEOffshoreHours + @MidSEOffshoreHours + @AdvSEOffshoreHours + @SenSEOffshoreHours + @ConsArchOffshoreHours + @ProjLeadOffshoreHours + @ProjMgrOffshoreHours + @ProgMgrOffshoreHours + @JrProjMgrOffshoreHours + @JrProgMgrOffshoreHours) / @OffshoreFTERate) + ( (@FTPStaffAugOnshoreHours + @FTPStaffAugOffshoreHours) / @FTPBillingRate ), COApprovedFTEs = @COApprovedFTEs, JrSEOnshoreHours = @JrSEOnshoreHours/@OnshoreFTERate, JrSEOffshoreHours = @JrSEOffshoreHours/@OffshoreFTERate, MidSEOnshoreHours = @MidSEOnshoreHours/@OnshoreFTERate, MidSEOffshoreHours = @MidSEOffshoreHours/@OffshoreFTERate, AdvSEOnshoreHours = @AdvSEOnshoreHours/@OnshoreFTERate, AdvSEOffshoreHours = @AdvSEOffshoreHours/@OffshoreFTERate, SenSEOnshoreHours = @SenSEOnshoreHours/@OnshoreFTERate, SenSEOffshoreHours = @SenSEOffshoreHours/@OffshoreFTERate, 	ConsArchOnshoreHours = @ConsArchOnshoreHours/@OnshoreFTERate, ConsArchOffshoreHours = @ConsArchOffshoreHours/@OffshoreFTERate, ProjLeadOnshoreHours = @ProjLeadOnshoreHours/@OnshoreFTERate, ProjLeadOffshoreHours = @ProjLeadOffshoreHours/@OffshoreFTERate, ProjMgrOnshoreHours = @ProjMgrOnshoreHours/@OnshoreFTERate, ProjMgrOffshoreHours = @ProjMgrOffshoreHours/@OffshoreFTERate, ProgMgrOnshoreHours = @ProgMgrOnshoreHours/@OnshoreFTERate, ProgMgrOffshoreHours = @ProgMgrOffshoreHours/@OffshoreFTERate, JrProjMgrOffshoreHours = @JrProjMgrOffshoreHours/@OffshoreFTERate, JrProgMgrOffshoreHours = @JrProgMgrOffshoreHours/@OffshoreFTERate, SrProjMgrOffshoreHours = @SrProjMgrOffshoreHours/@OffshoreFTERate, SrProgMgrOffshoreHours = @SrProgMgrOffshoreHours/@OffshoreFTERate, FTPStaffAugOnshoreHours = @FTPStaffAugOnshoreHours/@FTPBillingRate, FTPStaffAugOffshoreHours = @FTPStaffAugOffshoreHours/@FTPBillingRate 
		where RecNumber = 2 and RecType = 'TotalADMConversion'
	end
else
	begin
	select @TotalHours = sum(isnull(TotalHours,0)), @COApprovedFTEs = sum(isnull(COApprovedFTEs,0)), @JrSEOnshoreHours = sum(isnull(JrSEOnshoreHours,0)), @JrSEOffshoreHours = sum(isnull(JrSEOffshoreHours,0)), @MidSEOnshoreHours = sum(isnull(MidSEOnshoreHours,0)), @MidSEOffshoreHours = sum(isnull(MidSEOffshoreHours,0)), @AdvSEOnshoreHours = sum(isnull(AdvSEOnshoreHours,0)), @AdvSEOffshoreHours = sum(isnull(AdvSEOffshoreHours,0)), @SenSEOnshoreHours = sum(isnull(SenSEOnshoreHours,0)), @SenSEOffshoreHours = sum(isnull(SenSEOffshoreHours,0)), @ConsArchOnshoreHours = sum(isnull(ConsArchOnshoreHours,0)), @ConsArchOffshoreHours = sum(isnull(ConsArchOffshoreHours,0)), @ProjLeadOnshoreHours = sum(isnull(ProjLeadOnshoreHours,0)), @ProjLeadOffshoreHours = sum(isnull(ProjLeadOffshoreHours,0)), @ProjMgrOnshoreHours = sum(isnull(ProjMgrOnshoreHours,0)), @ProjMgrOffshoreHours = sum(isnull(ProjMgrOffshoreHours,0)), @ProgMgrOnshoreHours = sum(isnull(ProgMgrOnshoreHours,0)), @ProgMgrOffshoreHours = sum(isnull(ProgMgrOffshoreHours,0)), @JrProjMgrOffshoreHours = sum(isnull(JrProjMgrOffshoreHours,0)), @JrProgMgrOffshoreHours = sum(isnull(JrProgMgrOffshoreHours,0)), @SrProjMgrOffshoreHours = sum(isnull(SrProjMgrOffshoreHours,0)), @SrProgMgrOffshoreHours = sum(isnull(SrProgMgrOffshoreHours,0)) from #TEMP_OUT 
		where RecNumber = 30 and ITSABillingCat = 'ADM'
	update #TEMP_OUT set TotalHours = @TotalHours, COApprovedFTEs = @COApprovedFTEs, JrSEOnshoreHours = @JrSEOnshoreHours, JrSEOffshoreHours = @JrSEOffshoreHours, MidSEOnshoreHours = @MidSEOnshoreHours, MidSEOffshoreHours = @MidSEOffshoreHours, AdvSEOnshoreHours = @AdvSEOnshoreHours, AdvSEOffshoreHours = @AdvSEOffshoreHours, SenSEOnshoreHours = @SenSEOnshoreHours, SenSEOffshoreHours = @SenSEOffshoreHours, ConsArchOnshoreHours = @ConsArchOnshoreHours, ConsArchOffshoreHours = @ConsArchOffshoreHours, ProjLeadOnshoreHours = @ProjLeadOnshoreHours, ProjLeadOffshoreHours = @ProjLeadOffshoreHours, ProjMgrOnshoreHours = @ProjMgrOnshoreHours, ProjMgrOffshoreHours = @ProjMgrOffshoreHours, ProgMgrOnshoreHours = @ProgMgrOnshoreHours, ProgMgrOffshoreHours = @ProgMgrOffshoreHours, JrProjMgrOffshoreHours = @JrProjMgrOffshoreHours, JrProgMgrOffshoreHours = @JrProgMgrOffshoreHours, SrProjMgrOffshoreHours = @SrProjMgrOffshoreHours, SrProgMgrOffshoreHours = @SrProgMgrOffshoreHours, FTPStaffAugOnshoreHours = @FTPStaffAugOnshoreHours, FTPStaffAugOffshoreHours = @FTPStaffAugOffshoreHours 
		where RecNumber = 2 and RecType = 'TotalADM'
	update #TEMP_OUT set TotalFTEs = ( (JrSEOnshoreHours + MidSEOnshoreHours + AdvSEOnshoreHours + SenSEOnshoreHours + ConsArchOnshoreHours + ProjLeadOnshoreHours + ProjMgrOnshoreHours + ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (JrSEOffshoreHours + MidSEOffshoreHours + AdvSEOffshoreHours + SenSEOffshoreHours + ConsArchOffshoreHours + ProjLeadOffshoreHours + ProjMgrOffshoreHours + ProgMgrOffshoreHours + JrProjMgrOffshoreHours + JrProgMgrOffshoreHours) / @OffshoreFTERate), ActualFTEs = ( (JrSEOnshoreHours + MidSEOnshoreHours + AdvSEOnshoreHours + SenSEOnshoreHours + ConsArchOnshoreHours + ProjLeadOnshoreHours + ProjMgrOnshoreHours + ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (JrSEOffshoreHours + MidSEOffshoreHours + AdvSEOffshoreHours + SenSEOffshoreHours + ConsArchOffshoreHours + ProjLeadOffshoreHours + ProjMgrOffshoreHours + ProgMgrOffshoreHours + JrProjMgrOffshoreHours + JrProgMgrOffshoreHours + SrProjMgrOffshoreHours + SrProgMgrOffshoreHours) / @OffshoreFTERate) 
		where RecNumber = 2 and RecType = 'TotalADM'
	update #TEMP_OUT set TotalHours = ( (@JrSEOnshoreHours + @MidSEOnshoreHours + @AdvSEOnshoreHours + @SenSEOnshoreHours + @ConsArchOnshoreHours + @ProjLeadOnshoreHours + @ProjMgrOnshoreHours + @ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (@JrSEOffshoreHours + @MidSEOffshoreHours + @AdvSEOffshoreHours + @SenSEOffshoreHours + @ConsArchOffshoreHours + @ProjLeadOffshoreHours + @ProjMgrOffshoreHours + @ProgMgrOffshoreHours + @JrProjMgrOffshoreHours + @JrProgMgrOffshoreHours) / @OffshoreFTERate), TotalFTEs = ( (@JrSEOnshoreHours + @MidSEOnshoreHours + @AdvSEOnshoreHours + @SenSEOnshoreHours + @ConsArchOnshoreHours + @ProjLeadOnshoreHours + @ProjMgrOnshoreHours + @ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (@JrSEOffshoreHours + @MidSEOffshoreHours + @AdvSEOffshoreHours + @SenSEOffshoreHours + @ConsArchOffshoreHours + @ProjLeadOffshoreHours + @ProjMgrOffshoreHours + @ProgMgrOffshoreHours + @JrProjMgrOffshoreHours + @JrProgMgrOffshoreHours) / @OffshoreFTERate), ActualFTEs = ( (@JrSEOnshoreHours + @MidSEOnshoreHours + @AdvSEOnshoreHours + @SenSEOnshoreHours + @ConsArchOnshoreHours + @ProjLeadOnshoreHours + @ProjMgrOnshoreHours + @ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (@JrSEOffshoreHours + @MidSEOffshoreHours + @AdvSEOffshoreHours + @SenSEOffshoreHours + @ConsArchOffshoreHours + @ProjLeadOffshoreHours + @ProjMgrOffshoreHours + @ProgMgrOffshoreHours + @JrProjMgrOffshoreHours + @JrProgMgrOffshoreHours) / @OffshoreFTERate), COApprovedFTEs = @COApprovedFTEs, JrSEOnshoreHours = @JrSEOnshoreHours/@OnshoreFTERate, JrSEOffshoreHours = @JrSEOffshoreHours/@OffshoreFTERate, MidSEOnshoreHours = @MidSEOnshoreHours/@OnshoreFTERate, MidSEOffshoreHours = @MidSEOffshoreHours/@OffshoreFTERate, AdvSEOnshoreHours = @AdvSEOnshoreHours/@OnshoreFTERate, AdvSEOffshoreHours = @AdvSEOffshoreHours/@OffshoreFTERate, SenSEOnshoreHours = @SenSEOnshoreHours/@OnshoreFTERate, SenSEOffshoreHours = @SenSEOffshoreHours/@OffshoreFTERate, ConsArchOnshoreHours = @ConsArchOnshoreHours/@OnshoreFTERate, ConsArchOffshoreHours = @ConsArchOffshoreHours/@OffshoreFTERate, ProjLeadOnshoreHours = @ProjLeadOnshoreHours/@OnshoreFTERate, ProjLeadOffshoreHours = @ProjLeadOffshoreHours/@OffshoreFTERate, ProjMgrOnshoreHours = @ProjMgrOnshoreHours/@OnshoreFTERate, ProjMgrOffshoreHours = @ProjMgrOffshoreHours/@OffshoreFTERate, ProgMgrOnshoreHours = @ProgMgrOnshoreHours/@OnshoreFTERate, ProgMgrOffshoreHours = @ProgMgrOffshoreHours/@OffshoreFTERate, JrProjMgrOffshoreHours = @JrProjMgrOffshoreHours/@OffshoreFTERate, JrProgMgrOffshoreHours = @JrProgMgrOffshoreHours/@OffshoreFTERate, SrProjMgrOffshoreHours = @SrProjMgrOffshoreHours/@OffshoreFTERate, SrProgMgrOffshoreHours = @SrProgMgrOffshoreHours/@OffshoreFTERate
		where RecNumber = 2 and RecType = 'TotalADMConversion'
	end
update #TEMP_OUT set EDSVariance = ActualFTEs - COApprovedFTEs where RecNumber = 2 and RecType in ('TotalADM', 'TotalADMConversion')

-- Calculate and Populate the 3 records (Total EMD)
if ( @ITSABillingCatSelection = '-1' )
	begin
	select @TotalHours = sum(isnull(TotalHours,0)), @COApprovedFTEs = sum(isnull(COApprovedFTEs,0)), @JrSEOnshoreHours = sum(isnull(JrSEOnshoreHours,0)), @JrSEOffshoreHours = sum(isnull(JrSEOffshoreHours,0)), @MidSEOnshoreHours = sum(isnull(MidSEOnshoreHours,0)), @MidSEOffshoreHours = sum(isnull(MidSEOffshoreHours,0)), @AdvSEOnshoreHours = sum(isnull(AdvSEOnshoreHours,0)), @AdvSEOffshoreHours = sum(isnull(AdvSEOffshoreHours,0)), @SenSEOnshoreHours = sum(isnull(SenSEOnshoreHours,0)), @SenSEOffshoreHours = sum(isnull(SenSEOffshoreHours,0)), @ConsArchOnshoreHours = sum(isnull(ConsArchOnshoreHours,0)), @ConsArchOffshoreHours = sum(isnull(ConsArchOffshoreHours,0)), @ProjLeadOnshoreHours = sum(isnull(ProjLeadOnshoreHours,0)), @ProjLeadOffshoreHours = sum(isnull(ProjLeadOffshoreHours,0)), @ProjMgrOnshoreHours = sum(isnull(ProjMgrOnshoreHours,0)), @ProjMgrOffshoreHours = sum(isnull(ProjMgrOffshoreHours,0)), @ProgMgrOnshoreHours = sum(isnull(ProgMgrOnshoreHours,0)), @ProgMgrOffshoreHours = sum(isnull(ProgMgrOffshoreHours,0)), @JrProjMgrOffshoreHours = sum(isnull(JrProjMgrOffshoreHours,0)), @JrProgMgrOffshoreHours = sum(isnull(JrProgMgrOffshoreHours,0)), @SrProjMgrOffshoreHours = sum(isnull(SrProjMgrOffshoreHours,0)), @SrProgMgrOffshoreHours = sum(isnull(SrProgMgrOffshoreHours,0)), @FTPStaffAugOnshoreHours = sum(isnull(FTPStaffAugOnshoreHours,0)), @FTPStaffAugOffshoreHours = sum(isnull(FTPStaffAugOffshoreHours,0)) from #TEMP_OUT 
		where RecNumber = 30 and ITSABillingCat = 'EMD'
	update #TEMP_OUT set TotalHours = @TotalHours, COApprovedFTEs = @COApprovedFTEs, JrSEOnshoreHours = @JrSEOnshoreHours, JrSEOffshoreHours = @JrSEOffshoreHours, MidSEOnshoreHours = @MidSEOnshoreHours, MidSEOffshoreHours = @MidSEOffshoreHours, AdvSEOnshoreHours = @AdvSEOnshoreHours, AdvSEOffshoreHours = @AdvSEOffshoreHours, SenSEOnshoreHours = @SenSEOnshoreHours, SenSEOffshoreHours = @SenSEOffshoreHours, ConsArchOnshoreHours = @ConsArchOnshoreHours, ConsArchOffshoreHours = @ConsArchOffshoreHours, ProjLeadOnshoreHours = @ProjLeadOnshoreHours, ProjLeadOffshoreHours = @ProjLeadOffshoreHours, ProjMgrOnshoreHours = @ProjMgrOnshoreHours, ProjMgrOffshoreHours = @ProjMgrOffshoreHours, ProgMgrOnshoreHours = @ProgMgrOnshoreHours, ProgMgrOffshoreHours = @ProgMgrOffshoreHours, JrProjMgrOffshoreHours = @JrProjMgrOffshoreHours, JrProgMgrOffshoreHours = @JrProgMgrOffshoreHours, SrProjMgrOffshoreHours = @SrProjMgrOffshoreHours, SrProgMgrOffshoreHours = @SrProgMgrOffshoreHours, FTPStaffAugOnshoreHours = @FTPStaffAugOnshoreHours, FTPStaffAugOffshoreHours = @FTPStaffAugOffshoreHours 
		where RecNumber = 3 and RecType = 'TotalEMD'
	update #TEMP_OUT set TotalFTEs = ( (JrSEOnshoreHours + MidSEOnshoreHours + AdvSEOnshoreHours + SenSEOnshoreHours + ConsArchOnshoreHours + ProjLeadOnshoreHours + ProjMgrOnshoreHours + ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (JrSEOffshoreHours + MidSEOffshoreHours + AdvSEOffshoreHours + SenSEOffshoreHours + ConsArchOffshoreHours + ProjLeadOffshoreHours + ProjMgrOffshoreHours + ProgMgrOffshoreHours + JrProjMgrOffshoreHours + JrProgMgrOffshoreHours) / @OffshoreFTERate), TotalFTPs = ( (FTPStaffAugOnshoreHours + FTPStaffAugOffshoreHours) / @FTPBillingRate ), ActualFTEs = ( (JrSEOnshoreHours + MidSEOnshoreHours + AdvSEOnshoreHours + SenSEOnshoreHours + ConsArchOnshoreHours + ProjLeadOnshoreHours + ProjMgrOnshoreHours + ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (JrSEOffshoreHours + MidSEOffshoreHours + AdvSEOffshoreHours + SenSEOffshoreHours + ConsArchOffshoreHours + ProjLeadOffshoreHours + ProjMgrOffshoreHours + ProgMgrOffshoreHours + JrProjMgrOffshoreHours + JrProgMgrOffshoreHours + SrProjMgrOffshoreHours + SrProgMgrOffshoreHours) / @OffshoreFTERate) + ( (FTPStaffAugOnshoreHours + FTPStaffAugOffshoreHours) / @FTPBillingRate ) 
		where RecNumber = 3 and RecType = 'TotalEMD'
	update #TEMP_OUT set TotalHours = ( (@JrSEOnshoreHours + @MidSEOnshoreHours + @AdvSEOnshoreHours + @SenSEOnshoreHours + @ConsArchOnshoreHours + @ProjLeadOnshoreHours + @ProjMgrOnshoreHours + @ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (@JrSEOffshoreHours + @MidSEOffshoreHours + @AdvSEOffshoreHours + @SenSEOffshoreHours + @ConsArchOffshoreHours + @ProjLeadOffshoreHours + @ProjMgrOffshoreHours + @ProgMgrOffshoreHours + @JrProjMgrOffshoreHours + @JrProgMgrOffshoreHours) / @OffshoreFTERate) + ( (@FTPStaffAugOnshoreHours + @FTPStaffAugOffshoreHours) / @FTPBillingRate ), TotalFTEs = ( (@JrSEOnshoreHours + @MidSEOnshoreHours + @AdvSEOnshoreHours + @SenSEOnshoreHours + @ConsArchOnshoreHours + @ProjLeadOnshoreHours + @ProjMgrOnshoreHours + @ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (@JrSEOffshoreHours + @MidSEOffshoreHours + @AdvSEOffshoreHours + @SenSEOffshoreHours + @ConsArchOffshoreHours + @ProjLeadOffshoreHours + @ProjMgrOffshoreHours + @ProgMgrOffshoreHours + @JrProjMgrOffshoreHours + @JrProgMgrOffshoreHours) / @OffshoreFTERate), TotalFTPs = ( (@FTPStaffAugOnshoreHours + @FTPStaffAugOffshoreHours) / @FTPBillingRate ), ActualFTEs = ( (@JrSEOnshoreHours + @MidSEOnshoreHours + @AdvSEOnshoreHours + @SenSEOnshoreHours + @ConsArchOnshoreHours + @ProjLeadOnshoreHours + @ProjMgrOnshoreHours + @ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (@JrSEOffshoreHours + @MidSEOffshoreHours + @AdvSEOffshoreHours + @SenSEOffshoreHours + @ConsArchOffshoreHours + @ProjLeadOffshoreHours + @ProjMgrOffshoreHours + @ProgMgrOffshoreHours + @JrProjMgrOffshoreHours + @JrProgMgrOffshoreHours) / @OffshoreFTERate) + ( (@FTPStaffAugOnshoreHours + @FTPStaffAugOffshoreHours) / @FTPBillingRate ), COApprovedFTEs = @COApprovedFTEs, JrSEOnshoreHours = @JrSEOnshoreHours/@OnshoreFTERate, JrSEOffshoreHours = @JrSEOffshoreHours/@OffshoreFTERate, MidSEOnshoreHours = @MidSEOnshoreHours/@OnshoreFTERate, MidSEOffshoreHours = @MidSEOffshoreHours/@OffshoreFTERate, AdvSEOnshoreHours = @AdvSEOnshoreHours/@OnshoreFTERate, AdvSEOffshoreHours = @AdvSEOffshoreHours/@OffshoreFTERate, SenSEOnshoreHours = @SenSEOnshoreHours/@OnshoreFTERate, SenSEOffshoreHours = @SenSEOffshoreHours/@OffshoreFTERate, 	ConsArchOnshoreHours = @ConsArchOnshoreHours/@OnshoreFTERate, ConsArchOffshoreHours = @ConsArchOffshoreHours/@OffshoreFTERate, ProjLeadOnshoreHours = @ProjLeadOnshoreHours/@OnshoreFTERate, ProjLeadOffshoreHours = @ProjLeadOffshoreHours/@OffshoreFTERate, ProjMgrOnshoreHours = @ProjMgrOnshoreHours/@OnshoreFTERate, ProjMgrOffshoreHours = @ProjMgrOffshoreHours/@OffshoreFTERate, ProgMgrOnshoreHours = @ProgMgrOnshoreHours/@OnshoreFTERate, ProgMgrOffshoreHours = @ProgMgrOffshoreHours/@OffshoreFTERate, JrProjMgrOffshoreHours = @JrProjMgrOffshoreHours/@OffshoreFTERate, JrProgMgrOffshoreHours = @JrProgMgrOffshoreHours/@OffshoreFTERate, SrProjMgrOffshoreHours = @SrProjMgrOffshoreHours/@OffshoreFTERate, SrProgMgrOffshoreHours = @SrProgMgrOffshoreHours/@OffshoreFTERate, FTPStaffAugOnshoreHours = @FTPStaffAugOnshoreHours/@FTPBillingRate, FTPStaffAugOffshoreHours = @FTPStaffAugOffshoreHours/@FTPBillingRate 
		where RecNumber = 3 and RecType = 'TotalEMDConversion'	
	end
else
	begin
	select @TotalHours = sum(isnull(TotalHours,0)), @COApprovedFTEs = sum(isnull(COApprovedFTEs,0)), @JrSEOnshoreHours = sum(isnull(JrSEOnshoreHours,0)), @JrSEOffshoreHours = sum(isnull(JrSEOffshoreHours,0)), @MidSEOnshoreHours = sum(isnull(MidSEOnshoreHours,0)), @MidSEOffshoreHours = sum(isnull(MidSEOffshoreHours,0)), @AdvSEOnshoreHours = sum(isnull(AdvSEOnshoreHours,0)), @AdvSEOffshoreHours = sum(isnull(AdvSEOffshoreHours,0)), @SenSEOnshoreHours = sum(isnull(SenSEOnshoreHours,0)), @SenSEOffshoreHours = sum(isnull(SenSEOffshoreHours,0)), @ConsArchOnshoreHours = sum(isnull(ConsArchOnshoreHours,0)), @ConsArchOffshoreHours = sum(isnull(ConsArchOffshoreHours,0)), @ProjLeadOnshoreHours = sum(isnull(ProjLeadOnshoreHours,0)), @ProjLeadOffshoreHours = sum(isnull(ProjLeadOffshoreHours,0)), @ProjMgrOnshoreHours = sum(isnull(ProjMgrOnshoreHours,0)), @ProjMgrOffshoreHours = sum(isnull(ProjMgrOffshoreHours,0)), @ProgMgrOnshoreHours = sum(isnull(ProgMgrOnshoreHours,0)), @ProgMgrOffshoreHours = sum(isnull(ProgMgrOffshoreHours,0)), @JrProjMgrOffshoreHours = sum(isnull(JrProjMgrOffshoreHours,0)), @JrProgMgrOffshoreHours = sum(isnull(JrProgMgrOffshoreHours,0)), @SrProjMgrOffshoreHours = sum(isnull(SrProjMgrOffshoreHours,0)), @SrProgMgrOffshoreHours = sum(isnull(SrProgMgrOffshoreHours,0)) from #TEMP_OUT 
		where RecNumber = 30 and ITSABillingCat = 'EMD'
	update #TEMP_OUT set TotalHours = @TotalHours, COApprovedFTEs = @COApprovedFTEs, JrSEOnshoreHours = @JrSEOnshoreHours, JrSEOffshoreHours = @JrSEOffshoreHours, MidSEOnshoreHours = @MidSEOnshoreHours, MidSEOffshoreHours = @MidSEOffshoreHours, AdvSEOnshoreHours = @AdvSEOnshoreHours, AdvSEOffshoreHours = @AdvSEOffshoreHours, SenSEOnshoreHours = @SenSEOnshoreHours, SenSEOffshoreHours = @SenSEOffshoreHours, ConsArchOnshoreHours = @ConsArchOnshoreHours, ConsArchOffshoreHours = @ConsArchOffshoreHours, ProjLeadOnshoreHours = @ProjLeadOnshoreHours, ProjLeadOffshoreHours = @ProjLeadOffshoreHours, ProjMgrOnshoreHours = @ProjMgrOnshoreHours, ProjMgrOffshoreHours = @ProjMgrOffshoreHours, ProgMgrOnshoreHours = @ProgMgrOnshoreHours, ProgMgrOffshoreHours = @ProgMgrOffshoreHours, JrProjMgrOffshoreHours = @JrProjMgrOffshoreHours, JrProgMgrOffshoreHours = @JrProgMgrOffshoreHours, SrProjMgrOffshoreHours = @SrProjMgrOffshoreHours, SrProgMgrOffshoreHours = @SrProgMgrOffshoreHours, FTPStaffAugOnshoreHours = @FTPStaffAugOnshoreHours, FTPStaffAugOffshoreHours = @FTPStaffAugOffshoreHours 
		where RecNumber = 3 and RecType = 'TotalEMD'
	update #TEMP_OUT set TotalFTEs = ( (JrSEOnshoreHours + MidSEOnshoreHours + AdvSEOnshoreHours + SenSEOnshoreHours + ConsArchOnshoreHours + ProjLeadOnshoreHours + ProjMgrOnshoreHours + ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (JrSEOffshoreHours + MidSEOffshoreHours + AdvSEOffshoreHours + SenSEOffshoreHours + ConsArchOffshoreHours + ProjLeadOffshoreHours + ProjMgrOffshoreHours + ProgMgrOffshoreHours + JrProjMgrOffshoreHours + JrProgMgrOffshoreHours) / @OffshoreFTERate), ActualFTEs = ( (JrSEOnshoreHours + MidSEOnshoreHours + AdvSEOnshoreHours + SenSEOnshoreHours + ConsArchOnshoreHours + ProjLeadOnshoreHours + ProjMgrOnshoreHours + ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (JrSEOffshoreHours + MidSEOffshoreHours + AdvSEOffshoreHours + SenSEOffshoreHours + ConsArchOffshoreHours + ProjLeadOffshoreHours + ProjMgrOffshoreHours + ProgMgrOffshoreHours + JrProjMgrOffshoreHours + JrProgMgrOffshoreHours + SrProjMgrOffshoreHours + SrProgMgrOffshoreHours) / @OffshoreFTERate) 
		where RecNumber = 3 and RecType = 'TotalEMD'
	update #TEMP_OUT set TotalHours = ( (@JrSEOnshoreHours + @MidSEOnshoreHours + @AdvSEOnshoreHours + @SenSEOnshoreHours + @ConsArchOnshoreHours + @ProjLeadOnshoreHours + @ProjMgrOnshoreHours + @ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (@JrSEOffshoreHours + @MidSEOffshoreHours + @AdvSEOffshoreHours + @SenSEOffshoreHours + @ConsArchOffshoreHours + @ProjLeadOffshoreHours + @ProjMgrOffshoreHours + @ProgMgrOffshoreHours + @JrProjMgrOffshoreHours + @JrProgMgrOffshoreHours) / @OffshoreFTERate), TotalFTEs = ( (@JrSEOnshoreHours + @MidSEOnshoreHours + @AdvSEOnshoreHours + @SenSEOnshoreHours + @ConsArchOnshoreHours + @ProjLeadOnshoreHours + @ProjMgrOnshoreHours + @ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (@JrSEOffshoreHours + @MidSEOffshoreHours + @AdvSEOffshoreHours + @SenSEOffshoreHours + @ConsArchOffshoreHours + @ProjLeadOffshoreHours + @ProjMgrOffshoreHours + @ProgMgrOffshoreHours + @JrProjMgrOffshoreHours + @JrProgMgrOffshoreHours) / @OffshoreFTERate), ActualFTEs = ( (@JrSEOnshoreHours + @MidSEOnshoreHours + @AdvSEOnshoreHours + @SenSEOnshoreHours + @ConsArchOnshoreHours + @ProjLeadOnshoreHours + @ProjMgrOnshoreHours + @ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (@JrSEOffshoreHours + @MidSEOffshoreHours + @AdvSEOffshoreHours + @SenSEOffshoreHours + @ConsArchOffshoreHours + @ProjLeadOffshoreHours + @ProjMgrOffshoreHours + @ProgMgrOffshoreHours + @JrProjMgrOffshoreHours + @JrProgMgrOffshoreHours) / @OffshoreFTERate), COApprovedFTEs = @COApprovedFTEs, JrSEOnshoreHours = @JrSEOnshoreHours/@OnshoreFTERate, JrSEOffshoreHours = @JrSEOffshoreHours/@OffshoreFTERate, MidSEOnshoreHours = @MidSEOnshoreHours/@OnshoreFTERate, MidSEOffshoreHours = @MidSEOffshoreHours/@OffshoreFTERate, AdvSEOnshoreHours = @AdvSEOnshoreHours/@OnshoreFTERate, AdvSEOffshoreHours = @AdvSEOffshoreHours/@OffshoreFTERate, SenSEOnshoreHours = @SenSEOnshoreHours/@OnshoreFTERate, SenSEOffshoreHours = @SenSEOffshoreHours/@OffshoreFTERate, ConsArchOnshoreHours = @ConsArchOnshoreHours/@OnshoreFTERate, ConsArchOffshoreHours = @ConsArchOffshoreHours/@OffshoreFTERate, ProjLeadOnshoreHours = @ProjLeadOnshoreHours/@OnshoreFTERate, ProjLeadOffshoreHours = @ProjLeadOffshoreHours/@OffshoreFTERate, ProjMgrOnshoreHours = @ProjMgrOnshoreHours/@OnshoreFTERate, ProjMgrOffshoreHours = @ProjMgrOffshoreHours/@OffshoreFTERate, ProgMgrOnshoreHours = @ProgMgrOnshoreHours/@OnshoreFTERate, ProgMgrOffshoreHours = @ProgMgrOffshoreHours/@OffshoreFTERate, JrProjMgrOffshoreHours = @JrProjMgrOffshoreHours/@OffshoreFTERate, JrProgMgrOffshoreHours = @JrProgMgrOffshoreHours/@OffshoreFTERate, SrProjMgrOffshoreHours = @SrProjMgrOffshoreHours/@OffshoreFTERate, SrProgMgrOffshoreHours = @SrProgMgrOffshoreHours/@OffshoreFTERate
		where RecNumber = 3 and RecType = 'TotalEMDConversion'	
	end
update #TEMP_OUT set EDSVariance = ActualFTEs - COApprovedFTEs where RecNumber = 3 and RecType in ('TotalEMD', 'TotalEMDConversion')

-- Calculate and Populate the 4 records (Total Outsource Svcs)
if ( @ITSABillingCatSelection = '-1' )
	begin
	select @TotalHours = sum(isnull(TotalHours,0)), @COApprovedFTEs = sum(isnull(COApprovedFTEs,0)), @JrSEOnshoreHours = sum(isnull(JrSEOnshoreHours,0)), @JrSEOffshoreHours = sum(isnull(JrSEOffshoreHours,0)), @MidSEOnshoreHours = sum(isnull(MidSEOnshoreHours,0)), @MidSEOffshoreHours = sum(isnull(MidSEOffshoreHours,0)), @AdvSEOnshoreHours = sum(isnull(AdvSEOnshoreHours,0)), @AdvSEOffshoreHours = sum(isnull(AdvSEOffshoreHours,0)), @SenSEOnshoreHours = sum(isnull(SenSEOnshoreHours,0)), @SenSEOffshoreHours = sum(isnull(SenSEOffshoreHours,0)), @ConsArchOnshoreHours = sum(isnull(ConsArchOnshoreHours,0)), @ConsArchOffshoreHours = sum(isnull(ConsArchOffshoreHours,0)), @ProjLeadOnshoreHours = sum(isnull(ProjLeadOnshoreHours,0)), @ProjLeadOffshoreHours = sum(isnull(ProjLeadOffshoreHours,0)), @ProjMgrOnshoreHours = sum(isnull(ProjMgrOnshoreHours,0)), @ProjMgrOffshoreHours = sum(isnull(ProjMgrOffshoreHours,0)), @ProgMgrOnshoreHours = sum(isnull(ProgMgrOnshoreHours,0)), @ProgMgrOffshoreHours = sum(isnull(ProgMgrOffshoreHours,0)), @JrProjMgrOffshoreHours = sum(isnull(JrProjMgrOffshoreHours,0)), @JrProgMgrOffshoreHours = sum(isnull(JrProgMgrOffshoreHours,0)), @SrProjMgrOffshoreHours = sum(isnull(SrProjMgrOffshoreHours,0)), @SrProgMgrOffshoreHours = sum(isnull(SrProgMgrOffshoreHours,0)), @FTPStaffAugOnshoreHours = sum(isnull(FTPStaffAugOnshoreHours,0)), @FTPStaffAugOffshoreHours = sum(isnull(FTPStaffAugOffshoreHours,0)) from #TEMP_OUT 
		where RecNumber = 30 and ITSABillingCat = 'Outsource Svcs'
	update #TEMP_OUT set TotalHours = @TotalHours, COApprovedFTEs = @COApprovedFTEs, JrSEOnshoreHours = @JrSEOnshoreHours, JrSEOffshoreHours = @JrSEOffshoreHours, MidSEOnshoreHours = @MidSEOnshoreHours, MidSEOffshoreHours = @MidSEOffshoreHours, AdvSEOnshoreHours = @AdvSEOnshoreHours, AdvSEOffshoreHours = @AdvSEOffshoreHours, SenSEOnshoreHours = @SenSEOnshoreHours, SenSEOffshoreHours = @SenSEOffshoreHours, ConsArchOnshoreHours = @ConsArchOnshoreHours, ConsArchOffshoreHours = @ConsArchOffshoreHours, ProjLeadOnshoreHours = @ProjLeadOnshoreHours, ProjLeadOffshoreHours = @ProjLeadOffshoreHours, ProjMgrOnshoreHours = @ProjMgrOnshoreHours, ProjMgrOffshoreHours = @ProjMgrOffshoreHours, ProgMgrOnshoreHours = @ProgMgrOnshoreHours, ProgMgrOffshoreHours = @ProgMgrOffshoreHours, JrProjMgrOffshoreHours = @JrProjMgrOffshoreHours, JrProgMgrOffshoreHours = @JrProgMgrOffshoreHours, SrProjMgrOffshoreHours = @SrProjMgrOffshoreHours, SrProgMgrOffshoreHours = @SrProgMgrOffshoreHours, FTPStaffAugOnshoreHours = @FTPStaffAugOnshoreHours, FTPStaffAugOffshoreHours = @FTPStaffAugOffshoreHours 
		where RecNumber = 4 and RecType = 'TotalOutsourceSvcs'
	update #TEMP_OUT set TotalFTEs = ( (JrSEOnshoreHours + MidSEOnshoreHours + AdvSEOnshoreHours + SenSEOnshoreHours + ConsArchOnshoreHours + ProjLeadOnshoreHours + ProjMgrOnshoreHours + ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (JrSEOffshoreHours + MidSEOffshoreHours + AdvSEOffshoreHours + SenSEOffshoreHours + ConsArchOffshoreHours + ProjLeadOffshoreHours + ProjMgrOffshoreHours + ProgMgrOffshoreHours + JrProjMgrOffshoreHours + JrProgMgrOffshoreHours) / @OffshoreFTERate), TotalFTPs = ( (FTPStaffAugOnshoreHours + FTPStaffAugOffshoreHours) / @FTPBillingRate ), ActualFTEs = ( (JrSEOnshoreHours + MidSEOnshoreHours + AdvSEOnshoreHours + SenSEOnshoreHours + ConsArchOnshoreHours + ProjLeadOnshoreHours + ProjMgrOnshoreHours + ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (JrSEOffshoreHours + MidSEOffshoreHours + AdvSEOffshoreHours + SenSEOffshoreHours + ConsArchOffshoreHours + ProjLeadOffshoreHours + ProjMgrOffshoreHours + ProgMgrOffshoreHours + JrProjMgrOffshoreHours + JrProgMgrOffshoreHours + SrProjMgrOffshoreHours + SrProgMgrOffshoreHours) / @OffshoreFTERate) + ( (FTPStaffAugOnshoreHours + FTPStaffAugOffshoreHours) / @FTPBillingRate ) 
		where RecNumber = 4 and RecType = 'TotalOutsourceSvcs'
	update #TEMP_OUT set TotalHours = ( (@JrSEOnshoreHours + @MidSEOnshoreHours + @AdvSEOnshoreHours + @SenSEOnshoreHours + @ConsArchOnshoreHours + @ProjLeadOnshoreHours + @ProjMgrOnshoreHours + @ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (@JrSEOffshoreHours + @MidSEOffshoreHours + @AdvSEOffshoreHours + @SenSEOffshoreHours + @ConsArchOffshoreHours + @ProjLeadOffshoreHours + @ProjMgrOffshoreHours + @ProgMgrOffshoreHours + @JrProjMgrOffshoreHours + @JrProgMgrOffshoreHours) / @OffshoreFTERate) + ( (@FTPStaffAugOnshoreHours + @FTPStaffAugOffshoreHours) / @FTPBillingRate ), TotalFTEs = ( (@JrSEOnshoreHours + @MidSEOnshoreHours + @AdvSEOnshoreHours + @SenSEOnshoreHours + @ConsArchOnshoreHours + @ProjLeadOnshoreHours + @ProjMgrOnshoreHours + @ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (@JrSEOffshoreHours + @MidSEOffshoreHours + @AdvSEOffshoreHours + @SenSEOffshoreHours + @ConsArchOffshoreHours + @ProjLeadOffshoreHours + @ProjMgrOffshoreHours + @ProgMgrOffshoreHours + @JrProjMgrOffshoreHours + @JrProgMgrOffshoreHours) / @OffshoreFTERate), TotalFTPs = ( (@FTPStaffAugOnshoreHours + @FTPStaffAugOffshoreHours) / @FTPBillingRate ), ActualFTEs = ( (@JrSEOnshoreHours + @MidSEOnshoreHours + @AdvSEOnshoreHours + @SenSEOnshoreHours + @ConsArchOnshoreHours + @ProjLeadOnshoreHours + @ProjMgrOnshoreHours + @ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (@JrSEOffshoreHours + @MidSEOffshoreHours + @AdvSEOffshoreHours + @SenSEOffshoreHours + @ConsArchOffshoreHours + @ProjLeadOffshoreHours + @ProjMgrOffshoreHours + @ProgMgrOffshoreHours + @JrProjMgrOffshoreHours + @JrProgMgrOffshoreHours) / @OffshoreFTERate) + ( (@FTPStaffAugOnshoreHours + @FTPStaffAugOffshoreHours) / @FTPBillingRate ), COApprovedFTEs = @COApprovedFTEs, JrSEOnshoreHours = @JrSEOnshoreHours/@OnshoreFTERate, JrSEOffshoreHours = @JrSEOffshoreHours/@OffshoreFTERate, MidSEOnshoreHours = @MidSEOnshoreHours/@OnshoreFTERate, MidSEOffshoreHours = @MidSEOffshoreHours/@OffshoreFTERate, AdvSEOnshoreHours = @AdvSEOnshoreHours/@OnshoreFTERate, AdvSEOffshoreHours = @AdvSEOffshoreHours/@OffshoreFTERate, SenSEOnshoreHours = @SenSEOnshoreHours/@OnshoreFTERate, SenSEOffshoreHours = @SenSEOffshoreHours/@OffshoreFTERate, 	ConsArchOnshoreHours = @ConsArchOnshoreHours/@OnshoreFTERate, ConsArchOffshoreHours = @ConsArchOffshoreHours/@OffshoreFTERate, ProjLeadOnshoreHours = @ProjLeadOnshoreHours/@OnshoreFTERate, ProjLeadOffshoreHours = @ProjLeadOffshoreHours/@OffshoreFTERate, ProjMgrOnshoreHours = @ProjMgrOnshoreHours/@OnshoreFTERate, ProjMgrOffshoreHours = @ProjMgrOffshoreHours/@OffshoreFTERate, ProgMgrOnshoreHours = @ProgMgrOnshoreHours/@OnshoreFTERate, ProgMgrOffshoreHours = @ProgMgrOffshoreHours/@OffshoreFTERate, JrProjMgrOffshoreHours = @JrProjMgrOffshoreHours/@OffshoreFTERate, JrProgMgrOffshoreHours = @JrProgMgrOffshoreHours/@OffshoreFTERate, SrProjMgrOffshoreHours = @SrProjMgrOffshoreHours/@OffshoreFTERate, SrProgMgrOffshoreHours = @SrProgMgrOffshoreHours/@OffshoreFTERate, FTPStaffAugOnshoreHours = @FTPStaffAugOnshoreHours/@FTPBillingRate, FTPStaffAugOffshoreHours = @FTPStaffAugOffshoreHours/@FTPBillingRate 
		where RecNumber = 4 and RecType = 'TotalOutsourceSvcsConversion'	
	end
else
	begin
	select @TotalHours = sum(isnull(TotalHours,0)), @COApprovedFTEs = sum(isnull(COApprovedFTEs,0)), @JrSEOnshoreHours = sum(isnull(JrSEOnshoreHours,0)), @JrSEOffshoreHours = sum(isnull(JrSEOffshoreHours,0)), @MidSEOnshoreHours = sum(isnull(MidSEOnshoreHours,0)), @MidSEOffshoreHours = sum(isnull(MidSEOffshoreHours,0)), @AdvSEOnshoreHours = sum(isnull(AdvSEOnshoreHours,0)), @AdvSEOffshoreHours = sum(isnull(AdvSEOffshoreHours,0)), @SenSEOnshoreHours = sum(isnull(SenSEOnshoreHours,0)), @SenSEOffshoreHours = sum(isnull(SenSEOffshoreHours,0)), @ConsArchOnshoreHours = sum(isnull(ConsArchOnshoreHours,0)), @ConsArchOffshoreHours = sum(isnull(ConsArchOffshoreHours,0)), @ProjLeadOnshoreHours = sum(isnull(ProjLeadOnshoreHours,0)), @ProjLeadOffshoreHours = sum(isnull(ProjLeadOffshoreHours,0)), @ProjMgrOnshoreHours = sum(isnull(ProjMgrOnshoreHours,0)), @ProjMgrOffshoreHours = sum(isnull(ProjMgrOffshoreHours,0)), @ProgMgrOnshoreHours = sum(isnull(ProgMgrOnshoreHours,0)), @ProgMgrOffshoreHours = sum(isnull(ProgMgrOffshoreHours,0)), @JrProjMgrOffshoreHours = sum(isnull(JrProjMgrOffshoreHours,0)), @JrProgMgrOffshoreHours = sum(isnull(JrProgMgrOffshoreHours,0)), @SrProjMgrOffshoreHours = sum(isnull(SrProjMgrOffshoreHours,0)), @SrProgMgrOffshoreHours = sum(isnull(SrProgMgrOffshoreHours,0)) from #TEMP_OUT 
		where RecNumber = 30 and ITSABillingCat = 'Outsource Svcs'
	update #TEMP_OUT set TotalHours = @TotalHours, COApprovedFTEs = @COApprovedFTEs, JrSEOnshoreHours = @JrSEOnshoreHours, JrSEOffshoreHours = @JrSEOffshoreHours, MidSEOnshoreHours = @MidSEOnshoreHours, MidSEOffshoreHours = @MidSEOffshoreHours, AdvSEOnshoreHours = @AdvSEOnshoreHours, AdvSEOffshoreHours = @AdvSEOffshoreHours, SenSEOnshoreHours = @SenSEOnshoreHours, SenSEOffshoreHours = @SenSEOffshoreHours, ConsArchOnshoreHours = @ConsArchOnshoreHours, ConsArchOffshoreHours = @ConsArchOffshoreHours, ProjLeadOnshoreHours = @ProjLeadOnshoreHours, ProjLeadOffshoreHours = @ProjLeadOffshoreHours, ProjMgrOnshoreHours = @ProjMgrOnshoreHours, ProjMgrOffshoreHours = @ProjMgrOffshoreHours, ProgMgrOnshoreHours = @ProgMgrOnshoreHours, ProgMgrOffshoreHours = @ProgMgrOffshoreHours, JrProjMgrOffshoreHours = @JrProjMgrOffshoreHours, JrProgMgrOffshoreHours = @JrProgMgrOffshoreHours, SrProjMgrOffshoreHours = @SrProjMgrOffshoreHours, SrProgMgrOffshoreHours = @SrProgMgrOffshoreHours, FTPStaffAugOnshoreHours = @FTPStaffAugOnshoreHours, FTPStaffAugOffshoreHours = @FTPStaffAugOffshoreHours 
		where RecNumber = 4 and RecType = 'TotalOutsourceSvcs'
	update #TEMP_OUT set TotalFTEs = ( (JrSEOnshoreHours + MidSEOnshoreHours + AdvSEOnshoreHours + SenSEOnshoreHours + ConsArchOnshoreHours + ProjLeadOnshoreHours + ProjMgrOnshoreHours + ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (JrSEOffshoreHours + MidSEOffshoreHours + AdvSEOffshoreHours + SenSEOffshoreHours + ConsArchOffshoreHours + ProjLeadOffshoreHours + ProjMgrOffshoreHours + ProgMgrOffshoreHours + JrProjMgrOffshoreHours + JrProgMgrOffshoreHours) / @OffshoreFTERate), ActualFTEs = ( (JrSEOnshoreHours + MidSEOnshoreHours + AdvSEOnshoreHours + SenSEOnshoreHours + ConsArchOnshoreHours + ProjLeadOnshoreHours + ProjMgrOnshoreHours + ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (JrSEOffshoreHours + MidSEOffshoreHours + AdvSEOffshoreHours + SenSEOffshoreHours + ConsArchOffshoreHours + ProjLeadOffshoreHours + ProjMgrOffshoreHours + ProgMgrOffshoreHours + JrProjMgrOffshoreHours + JrProgMgrOffshoreHours + SrProjMgrOffshoreHours + SrProgMgrOffshoreHours) / @OffshoreFTERate) 
		where RecNumber = 4 and RecType = 'TotalOutsourceSvcs'
	update #TEMP_OUT set TotalHours = ( (@JrSEOnshoreHours + @MidSEOnshoreHours + @AdvSEOnshoreHours + @SenSEOnshoreHours + @ConsArchOnshoreHours + @ProjLeadOnshoreHours + @ProjMgrOnshoreHours + @ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (@JrSEOffshoreHours + @MidSEOffshoreHours + @AdvSEOffshoreHours + @SenSEOffshoreHours + @ConsArchOffshoreHours + @ProjLeadOffshoreHours + @ProjMgrOffshoreHours + @ProgMgrOffshoreHours + @JrProjMgrOffshoreHours + @JrProgMgrOffshoreHours) / @OffshoreFTERate), TotalFTEs = ( (@JrSEOnshoreHours + @MidSEOnshoreHours + @AdvSEOnshoreHours + @SenSEOnshoreHours + @ConsArchOnshoreHours + @ProjLeadOnshoreHours + @ProjMgrOnshoreHours + @ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (@JrSEOffshoreHours + @MidSEOffshoreHours + @AdvSEOffshoreHours + @SenSEOffshoreHours + @ConsArchOffshoreHours + @ProjLeadOffshoreHours + @ProjMgrOffshoreHours + @ProgMgrOffshoreHours + @JrProjMgrOffshoreHours + @JrProgMgrOffshoreHours) / @OffshoreFTERate), ActualFTEs = ( (@JrSEOnshoreHours + @MidSEOnshoreHours + @AdvSEOnshoreHours + @SenSEOnshoreHours + @ConsArchOnshoreHours + @ProjLeadOnshoreHours + @ProjMgrOnshoreHours + @ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (@JrSEOffshoreHours + @MidSEOffshoreHours + @AdvSEOffshoreHours + @SenSEOffshoreHours + @ConsArchOffshoreHours + @ProjLeadOffshoreHours + @ProjMgrOffshoreHours + @ProgMgrOffshoreHours + @JrProjMgrOffshoreHours + @JrProgMgrOffshoreHours) / @OffshoreFTERate), COApprovedFTEs = @COApprovedFTEs, JrSEOnshoreHours = @JrSEOnshoreHours/@OnshoreFTERate, JrSEOffshoreHours = @JrSEOffshoreHours/@OffshoreFTERate, MidSEOnshoreHours = @MidSEOnshoreHours/@OnshoreFTERate, MidSEOffshoreHours = @MidSEOffshoreHours/@OffshoreFTERate, AdvSEOnshoreHours = @AdvSEOnshoreHours/@OnshoreFTERate, AdvSEOffshoreHours = @AdvSEOffshoreHours/@OffshoreFTERate, SenSEOnshoreHours = @SenSEOnshoreHours/@OnshoreFTERate, SenSEOffshoreHours = @SenSEOffshoreHours/@OffshoreFTERate, ConsArchOnshoreHours = @ConsArchOnshoreHours/@OnshoreFTERate, ConsArchOffshoreHours = @ConsArchOffshoreHours/@OffshoreFTERate, ProjLeadOnshoreHours = @ProjLeadOnshoreHours/@OnshoreFTERate, ProjLeadOffshoreHours = @ProjLeadOffshoreHours/@OffshoreFTERate, ProjMgrOnshoreHours = @ProjMgrOnshoreHours/@OnshoreFTERate, ProjMgrOffshoreHours = @ProjMgrOffshoreHours/@OffshoreFTERate, ProgMgrOnshoreHours = @ProgMgrOnshoreHours/@OnshoreFTERate, ProgMgrOffshoreHours = @ProgMgrOffshoreHours/@OffshoreFTERate, JrProjMgrOffshoreHours = @JrProjMgrOffshoreHours/@OffshoreFTERate, JrProgMgrOffshoreHours = @JrProgMgrOffshoreHours/@OffshoreFTERate, SrProjMgrOffshoreHours = @SrProjMgrOffshoreHours/@OffshoreFTERate, SrProgMgrOffshoreHours = @SrProgMgrOffshoreHours/@OffshoreFTERate
		where RecNumber = 4 and RecType = 'TotalOutsourceSvcsConversion'	
	end
update #TEMP_OUT set EDSVariance = ActualFTEs - COApprovedFTEs where RecNumber = 4 and RecType in ('TotalOutsourceSvcs', 'TotalOutsourceSvcsConversion')

-- Calculate and Populate the 5 records (Total PSS Co Investment)
if ( @ITSABillingCatSelection = '-1' )
	begin
	select @TotalHours = sum(isnull(TotalHours,0)), @COApprovedFTEs = sum(isnull(COApprovedFTEs,0)), @JrSEOnshoreHours = sum(isnull(JrSEOnshoreHours,0)), @JrSEOffshoreHours = sum(isnull(JrSEOffshoreHours,0)), @MidSEOnshoreHours = sum(isnull(MidSEOnshoreHours,0)), @MidSEOffshoreHours = sum(isnull(MidSEOffshoreHours,0)), @AdvSEOnshoreHours = sum(isnull(AdvSEOnshoreHours,0)), @AdvSEOffshoreHours = sum(isnull(AdvSEOffshoreHours,0)), @SenSEOnshoreHours = sum(isnull(SenSEOnshoreHours,0)), @SenSEOffshoreHours = sum(isnull(SenSEOffshoreHours,0)), @ConsArchOnshoreHours = sum(isnull(ConsArchOnshoreHours,0)), @ConsArchOffshoreHours = sum(isnull(ConsArchOffshoreHours,0)), @ProjLeadOnshoreHours = sum(isnull(ProjLeadOnshoreHours,0)), @ProjLeadOffshoreHours = sum(isnull(ProjLeadOffshoreHours,0)), @ProjMgrOnshoreHours = sum(isnull(ProjMgrOnshoreHours,0)), @ProjMgrOffshoreHours = sum(isnull(ProjMgrOffshoreHours,0)), @ProgMgrOnshoreHours = sum(isnull(ProgMgrOnshoreHours,0)), @ProgMgrOffshoreHours = sum(isnull(ProgMgrOffshoreHours,0)), @JrProjMgrOffshoreHours = sum(isnull(JrProjMgrOffshoreHours,0)), @JrProgMgrOffshoreHours = sum(isnull(JrProgMgrOffshoreHours,0)), @SrProjMgrOffshoreHours = sum(isnull(SrProjMgrOffshoreHours,0)), @SrProgMgrOffshoreHours = sum(isnull(SrProgMgrOffshoreHours,0)), @FTPStaffAugOnshoreHours = sum(isnull(FTPStaffAugOnshoreHours,0)), @FTPStaffAugOffshoreHours = sum(isnull(FTPStaffAugOffshoreHours,0)) from #TEMP_OUT 
		where RecNumber = 30 and ITSABillingCat = 'PSS Co Investment'
	update #TEMP_OUT set TotalHours = @TotalHours, COApprovedFTEs = @COApprovedFTEs, JrSEOnshoreHours = @JrSEOnshoreHours, JrSEOffshoreHours = @JrSEOffshoreHours, MidSEOnshoreHours = @MidSEOnshoreHours, MidSEOffshoreHours = @MidSEOffshoreHours, AdvSEOnshoreHours = @AdvSEOnshoreHours, AdvSEOffshoreHours = @AdvSEOffshoreHours, SenSEOnshoreHours = @SenSEOnshoreHours, SenSEOffshoreHours = @SenSEOffshoreHours, ConsArchOnshoreHours = @ConsArchOnshoreHours, ConsArchOffshoreHours = @ConsArchOffshoreHours, ProjLeadOnshoreHours = @ProjLeadOnshoreHours, ProjLeadOffshoreHours = @ProjLeadOffshoreHours, ProjMgrOnshoreHours = @ProjMgrOnshoreHours, ProjMgrOffshoreHours = @ProjMgrOffshoreHours, ProgMgrOnshoreHours = @ProgMgrOnshoreHours, ProgMgrOffshoreHours = @ProgMgrOffshoreHours, JrProjMgrOffshoreHours = @JrProjMgrOffshoreHours, JrProgMgrOffshoreHours = @JrProgMgrOffshoreHours, SrProjMgrOffshoreHours = @SrProjMgrOffshoreHours, SrProgMgrOffshoreHours = @SrProgMgrOffshoreHours, FTPStaffAugOnshoreHours = @FTPStaffAugOnshoreHours, FTPStaffAugOffshoreHours = @FTPStaffAugOffshoreHours 
		where RecNumber = 5 and RecType = 'TotalPSS'
	update #TEMP_OUT set TotalFTEs = ( (JrSEOnshoreHours + MidSEOnshoreHours + AdvSEOnshoreHours + SenSEOnshoreHours + ConsArchOnshoreHours + ProjLeadOnshoreHours + ProjMgrOnshoreHours + ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (JrSEOffshoreHours + MidSEOffshoreHours + AdvSEOffshoreHours + SenSEOffshoreHours + ConsArchOffshoreHours + ProjLeadOffshoreHours + ProjMgrOffshoreHours + ProgMgrOffshoreHours + JrProjMgrOffshoreHours + JrProgMgrOffshoreHours) / @OffshoreFTERate), TotalFTPs = ( (FTPStaffAugOnshoreHours + FTPStaffAugOffshoreHours) / @FTPBillingRate ), ActualFTEs = ( (JrSEOnshoreHours + MidSEOnshoreHours + AdvSEOnshoreHours + SenSEOnshoreHours + ConsArchOnshoreHours + ProjLeadOnshoreHours + ProjMgrOnshoreHours + ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (JrSEOffshoreHours + MidSEOffshoreHours + AdvSEOffshoreHours + SenSEOffshoreHours + ConsArchOffshoreHours + ProjLeadOffshoreHours + ProjMgrOffshoreHours + ProgMgrOffshoreHours + JrProjMgrOffshoreHours + JrProgMgrOffshoreHours + SrProjMgrOffshoreHours + SrProgMgrOffshoreHours) / @OffshoreFTERate) + ( (FTPStaffAugOnshoreHours + FTPStaffAugOffshoreHours) / @FTPBillingRate ) 
		where RecNumber = 5 and RecType = 'TotalPSS'
	update #TEMP_OUT set TotalHours = ( (@JrSEOnshoreHours + @MidSEOnshoreHours + @AdvSEOnshoreHours + @SenSEOnshoreHours + @ConsArchOnshoreHours + @ProjLeadOnshoreHours + @ProjMgrOnshoreHours + @ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (@JrSEOffshoreHours + @MidSEOffshoreHours + @AdvSEOffshoreHours + @SenSEOffshoreHours + @ConsArchOffshoreHours + @ProjLeadOffshoreHours + @ProjMgrOffshoreHours + @ProgMgrOffshoreHours + @JrProjMgrOffshoreHours + @JrProgMgrOffshoreHours) / @OffshoreFTERate) + ( (@FTPStaffAugOnshoreHours + @FTPStaffAugOffshoreHours) / @FTPBillingRate ), TotalFTEs = ( (@JrSEOnshoreHours + @MidSEOnshoreHours + @AdvSEOnshoreHours + @SenSEOnshoreHours + @ConsArchOnshoreHours + @ProjLeadOnshoreHours + @ProjMgrOnshoreHours + @ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (@JrSEOffshoreHours + @MidSEOffshoreHours + @AdvSEOffshoreHours + @SenSEOffshoreHours + @ConsArchOffshoreHours + @ProjLeadOffshoreHours + @ProjMgrOffshoreHours + @ProgMgrOffshoreHours + @JrProjMgrOffshoreHours + @JrProgMgrOffshoreHours) / @OffshoreFTERate), TotalFTPs = ( (@FTPStaffAugOnshoreHours + @FTPStaffAugOffshoreHours) / @FTPBillingRate ), ActualFTEs = ( (@JrSEOnshoreHours + @MidSEOnshoreHours + @AdvSEOnshoreHours + @SenSEOnshoreHours + @ConsArchOnshoreHours + @ProjLeadOnshoreHours + @ProjMgrOnshoreHours + @ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (@JrSEOffshoreHours + @MidSEOffshoreHours + @AdvSEOffshoreHours + @SenSEOffshoreHours + @ConsArchOffshoreHours + @ProjLeadOffshoreHours + @ProjMgrOffshoreHours + @ProgMgrOffshoreHours + @JrProjMgrOffshoreHours + @JrProgMgrOffshoreHours) / @OffshoreFTERate) + ( (@FTPStaffAugOnshoreHours + @FTPStaffAugOffshoreHours) / @FTPBillingRate ), COApprovedFTEs = @COApprovedFTEs, JrSEOnshoreHours = @JrSEOnshoreHours/@OnshoreFTERate, JrSEOffshoreHours = @JrSEOffshoreHours/@OffshoreFTERate, MidSEOnshoreHours = @MidSEOnshoreHours/@OnshoreFTERate, MidSEOffshoreHours = @MidSEOffshoreHours/@OffshoreFTERate, AdvSEOnshoreHours = @AdvSEOnshoreHours/@OnshoreFTERate, AdvSEOffshoreHours = @AdvSEOffshoreHours/@OffshoreFTERate, SenSEOnshoreHours = @SenSEOnshoreHours/@OnshoreFTERate, SenSEOffshoreHours = @SenSEOffshoreHours/@OffshoreFTERate, 	ConsArchOnshoreHours = @ConsArchOnshoreHours/@OnshoreFTERate, ConsArchOffshoreHours = @ConsArchOffshoreHours/@OffshoreFTERate, ProjLeadOnshoreHours = @ProjLeadOnshoreHours/@OnshoreFTERate, ProjLeadOffshoreHours = @ProjLeadOffshoreHours/@OffshoreFTERate, ProjMgrOnshoreHours = @ProjMgrOnshoreHours/@OnshoreFTERate, ProjMgrOffshoreHours = @ProjMgrOffshoreHours/@OffshoreFTERate, ProgMgrOnshoreHours = @ProgMgrOnshoreHours/@OnshoreFTERate, ProgMgrOffshoreHours = @ProgMgrOffshoreHours/@OffshoreFTERate, JrProjMgrOffshoreHours = @JrProjMgrOffshoreHours/@OffshoreFTERate, JrProgMgrOffshoreHours = @JrProgMgrOffshoreHours/@OffshoreFTERate, SrProjMgrOffshoreHours = @SrProjMgrOffshoreHours/@OffshoreFTERate, SrProgMgrOffshoreHours = @SrProgMgrOffshoreHours/@OffshoreFTERate, FTPStaffAugOnshoreHours = @FTPStaffAugOnshoreHours/@FTPBillingRate, FTPStaffAugOffshoreHours = @FTPStaffAugOffshoreHours/@FTPBillingRate 
		where RecNumber = 5 and RecType = 'TotalPSSConversion'	
	end
else
	begin
	select @TotalHours = sum(isnull(TotalHours,0)), @COApprovedFTEs = sum(isnull(COApprovedFTEs,0)), @JrSEOnshoreHours = sum(isnull(JrSEOnshoreHours,0)), @JrSEOffshoreHours = sum(isnull(JrSEOffshoreHours,0)), @MidSEOnshoreHours = sum(isnull(MidSEOnshoreHours,0)), @MidSEOffshoreHours = sum(isnull(MidSEOffshoreHours,0)), @AdvSEOnshoreHours = sum(isnull(AdvSEOnshoreHours,0)), @AdvSEOffshoreHours = sum(isnull(AdvSEOffshoreHours,0)), @SenSEOnshoreHours = sum(isnull(SenSEOnshoreHours,0)), @SenSEOffshoreHours = sum(isnull(SenSEOffshoreHours,0)), @ConsArchOnshoreHours = sum(isnull(ConsArchOnshoreHours,0)), @ConsArchOffshoreHours = sum(isnull(ConsArchOffshoreHours,0)), @ProjLeadOnshoreHours = sum(isnull(ProjLeadOnshoreHours,0)), @ProjLeadOffshoreHours = sum(isnull(ProjLeadOffshoreHours,0)), @ProjMgrOnshoreHours = sum(isnull(ProjMgrOnshoreHours,0)), @ProjMgrOffshoreHours = sum(isnull(ProjMgrOffshoreHours,0)), @ProgMgrOnshoreHours = sum(isnull(ProgMgrOnshoreHours,0)), @ProgMgrOffshoreHours = sum(isnull(ProgMgrOffshoreHours,0)), @JrProjMgrOffshoreHours = sum(isnull(JrProjMgrOffshoreHours,0)), @JrProgMgrOffshoreHours = sum(isnull(JrProgMgrOffshoreHours,0)), @SrProjMgrOffshoreHours = sum(isnull(SrProjMgrOffshoreHours,0)), @SrProgMgrOffshoreHours = sum(isnull(SrProgMgrOffshoreHours,0)) from #TEMP_OUT 
		where RecNumber = 30 and ITSABillingCat = 'PSS Co Investment'
	update #TEMP_OUT set TotalHours = @TotalHours, COApprovedFTEs = @COApprovedFTEs, JrSEOnshoreHours = @JrSEOnshoreHours, JrSEOffshoreHours = @JrSEOffshoreHours, MidSEOnshoreHours = @MidSEOnshoreHours, MidSEOffshoreHours = @MidSEOffshoreHours, AdvSEOnshoreHours = @AdvSEOnshoreHours, AdvSEOffshoreHours = @AdvSEOffshoreHours, SenSEOnshoreHours = @SenSEOnshoreHours, SenSEOffshoreHours = @SenSEOffshoreHours, ConsArchOnshoreHours = @ConsArchOnshoreHours, ConsArchOffshoreHours = @ConsArchOffshoreHours, ProjLeadOnshoreHours = @ProjLeadOnshoreHours, ProjLeadOffshoreHours = @ProjLeadOffshoreHours, ProjMgrOnshoreHours = @ProjMgrOnshoreHours, ProjMgrOffshoreHours = @ProjMgrOffshoreHours, ProgMgrOnshoreHours = @ProgMgrOnshoreHours, ProgMgrOffshoreHours = @ProgMgrOffshoreHours, JrProjMgrOffshoreHours = @JrProjMgrOffshoreHours, JrProgMgrOffshoreHours = @JrProgMgrOffshoreHours, SrProjMgrOffshoreHours = @SrProjMgrOffshoreHours, SrProgMgrOffshoreHours = @SrProgMgrOffshoreHours, FTPStaffAugOnshoreHours = @FTPStaffAugOnshoreHours, FTPStaffAugOffshoreHours = @FTPStaffAugOffshoreHours 
		where RecNumber = 5 and RecType = 'TotalPSS'
	update #TEMP_OUT set TotalFTEs = ( (JrSEOnshoreHours + MidSEOnshoreHours + AdvSEOnshoreHours + SenSEOnshoreHours + ConsArchOnshoreHours + ProjLeadOnshoreHours + ProjMgrOnshoreHours + ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (JrSEOffshoreHours + MidSEOffshoreHours + AdvSEOffshoreHours + SenSEOffshoreHours + ConsArchOffshoreHours + ProjLeadOffshoreHours + ProjMgrOffshoreHours + ProgMgrOffshoreHours + JrProjMgrOffshoreHours + JrProgMgrOffshoreHours) / @OffshoreFTERate), ActualFTEs = ( (JrSEOnshoreHours + MidSEOnshoreHours + AdvSEOnshoreHours + SenSEOnshoreHours + ConsArchOnshoreHours + ProjLeadOnshoreHours + ProjMgrOnshoreHours + ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (JrSEOffshoreHours + MidSEOffshoreHours + AdvSEOffshoreHours + SenSEOffshoreHours + ConsArchOffshoreHours + ProjLeadOffshoreHours + ProjMgrOffshoreHours + ProgMgrOffshoreHours + JrProjMgrOffshoreHours + JrProgMgrOffshoreHours + SrProjMgrOffshoreHours + SrProgMgrOffshoreHours) / @OffshoreFTERate) 
		where RecNumber = 5 and RecType = 'TotalPSS'
	update #TEMP_OUT set TotalHours = ( (@JrSEOnshoreHours + @MidSEOnshoreHours + @AdvSEOnshoreHours + @SenSEOnshoreHours + @ConsArchOnshoreHours + @ProjLeadOnshoreHours + @ProjMgrOnshoreHours + @ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (@JrSEOffshoreHours + @MidSEOffshoreHours + @AdvSEOffshoreHours + @SenSEOffshoreHours + @ConsArchOffshoreHours + @ProjLeadOffshoreHours + @ProjMgrOffshoreHours + @ProgMgrOffshoreHours + @JrProjMgrOffshoreHours + @JrProgMgrOffshoreHours) / @OffshoreFTERate), TotalFTEs = ( (@JrSEOnshoreHours + @MidSEOnshoreHours + @AdvSEOnshoreHours + @SenSEOnshoreHours + @ConsArchOnshoreHours + @ProjLeadOnshoreHours + @ProjMgrOnshoreHours + @ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (@JrSEOffshoreHours + @MidSEOffshoreHours + @AdvSEOffshoreHours + @SenSEOffshoreHours + @ConsArchOffshoreHours + @ProjLeadOffshoreHours + @ProjMgrOffshoreHours + @ProgMgrOffshoreHours + @JrProjMgrOffshoreHours + @JrProgMgrOffshoreHours) / @OffshoreFTERate), ActualFTEs = ( (@JrSEOnshoreHours + @MidSEOnshoreHours + @AdvSEOnshoreHours + @SenSEOnshoreHours + @ConsArchOnshoreHours + @ProjLeadOnshoreHours + @ProjMgrOnshoreHours + @ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (@JrSEOffshoreHours + @MidSEOffshoreHours + @AdvSEOffshoreHours + @SenSEOffshoreHours + @ConsArchOffshoreHours + @ProjLeadOffshoreHours + @ProjMgrOffshoreHours + @ProgMgrOffshoreHours + @JrProjMgrOffshoreHours + @JrProgMgrOffshoreHours) / @OffshoreFTERate), COApprovedFTEs = @COApprovedFTEs, JrSEOnshoreHours = @JrSEOnshoreHours/@OnshoreFTERate, JrSEOffshoreHours = @JrSEOffshoreHours/@OffshoreFTERate, MidSEOnshoreHours = @MidSEOnshoreHours/@OnshoreFTERate, MidSEOffshoreHours = @MidSEOffshoreHours/@OffshoreFTERate, AdvSEOnshoreHours = @AdvSEOnshoreHours/@OnshoreFTERate, AdvSEOffshoreHours = @AdvSEOffshoreHours/@OffshoreFTERate, SenSEOnshoreHours = @SenSEOnshoreHours/@OnshoreFTERate, SenSEOffshoreHours = @SenSEOffshoreHours/@OffshoreFTERate, ConsArchOnshoreHours = @ConsArchOnshoreHours/@OnshoreFTERate, ConsArchOffshoreHours = @ConsArchOffshoreHours/@OffshoreFTERate, ProjLeadOnshoreHours = @ProjLeadOnshoreHours/@OnshoreFTERate, ProjLeadOffshoreHours = @ProjLeadOffshoreHours/@OffshoreFTERate, ProjMgrOnshoreHours = @ProjMgrOnshoreHours/@OnshoreFTERate, ProjMgrOffshoreHours = @ProjMgrOffshoreHours/@OffshoreFTERate, ProgMgrOnshoreHours = @ProgMgrOnshoreHours/@OnshoreFTERate, ProgMgrOffshoreHours = @ProgMgrOffshoreHours/@OffshoreFTERate, JrProjMgrOffshoreHours = @JrProjMgrOffshoreHours/@OffshoreFTERate, JrProgMgrOffshoreHours = @JrProgMgrOffshoreHours/@OffshoreFTERate, SrProjMgrOffshoreHours = @SrProjMgrOffshoreHours/@OffshoreFTERate, SrProgMgrOffshoreHours = @SrProgMgrOffshoreHours/@OffshoreFTERate
		where RecNumber = 5 and RecType = 'TotalPSSConversion'	
	end
update #TEMP_OUT set EDSVariance = ActualFTEs - COApprovedFTEs where RecNumber = 5 and RecType in ('TotalPSS', 'TotalPSSConversion')

-- Calculate and Populate the 6 records (Total IROP)
if ( @ITSABillingCatSelection = '-1' )
	begin
	select @TotalHours = sum(isnull(TotalHours,0)), @COApprovedFTEs = sum(isnull(COApprovedFTEs,0)), @JrSEOnshoreHours = sum(isnull(JrSEOnshoreHours,0)), @JrSEOffshoreHours = sum(isnull(JrSEOffshoreHours,0)), @MidSEOnshoreHours = sum(isnull(MidSEOnshoreHours,0)), @MidSEOffshoreHours = sum(isnull(MidSEOffshoreHours,0)), @AdvSEOnshoreHours = sum(isnull(AdvSEOnshoreHours,0)), @AdvSEOffshoreHours = sum(isnull(AdvSEOffshoreHours,0)), @SenSEOnshoreHours = sum(isnull(SenSEOnshoreHours,0)), @SenSEOffshoreHours = sum(isnull(SenSEOffshoreHours,0)), @ConsArchOnshoreHours = sum(isnull(ConsArchOnshoreHours,0)), @ConsArchOffshoreHours = sum(isnull(ConsArchOffshoreHours,0)), @ProjLeadOnshoreHours = sum(isnull(ProjLeadOnshoreHours,0)), @ProjLeadOffshoreHours = sum(isnull(ProjLeadOffshoreHours,0)), @ProjMgrOnshoreHours = sum(isnull(ProjMgrOnshoreHours,0)), @ProjMgrOffshoreHours = sum(isnull(ProjMgrOffshoreHours,0)), @ProgMgrOnshoreHours = sum(isnull(ProgMgrOnshoreHours,0)), @ProgMgrOffshoreHours = sum(isnull(ProgMgrOffshoreHours,0)), @JrProjMgrOffshoreHours = sum(isnull(JrProjMgrOffshoreHours,0)), @JrProgMgrOffshoreHours = sum(isnull(JrProgMgrOffshoreHours,0)), @SrProjMgrOffshoreHours = sum(isnull(SrProjMgrOffshoreHours,0)), @SrProgMgrOffshoreHours = sum(isnull(SrProgMgrOffshoreHours,0)), @FTPStaffAugOnshoreHours = sum(isnull(FTPStaffAugOnshoreHours,0)), @FTPStaffAugOffshoreHours = sum(isnull(FTPStaffAugOffshoreHours,0)) from #TEMP_OUT 
		where RecNumber = 30 and ITSABillingCat = 'IROP'
	update #TEMP_OUT set TotalHours = @TotalHours, COApprovedFTEs = @COApprovedFTEs, JrSEOnshoreHours = @JrSEOnshoreHours, JrSEOffshoreHours = @JrSEOffshoreHours, MidSEOnshoreHours = @MidSEOnshoreHours, MidSEOffshoreHours = @MidSEOffshoreHours, AdvSEOnshoreHours = @AdvSEOnshoreHours, AdvSEOffshoreHours = @AdvSEOffshoreHours, SenSEOnshoreHours = @SenSEOnshoreHours, SenSEOffshoreHours = @SenSEOffshoreHours, ConsArchOnshoreHours = @ConsArchOnshoreHours, ConsArchOffshoreHours = @ConsArchOffshoreHours, ProjLeadOnshoreHours = @ProjLeadOnshoreHours, ProjLeadOffshoreHours = @ProjLeadOffshoreHours, ProjMgrOnshoreHours = @ProjMgrOnshoreHours, ProjMgrOffshoreHours = @ProjMgrOffshoreHours, ProgMgrOnshoreHours = @ProgMgrOnshoreHours, ProgMgrOffshoreHours = @ProgMgrOffshoreHours, JrProjMgrOffshoreHours = @JrProjMgrOffshoreHours, JrProgMgrOffshoreHours = @JrProgMgrOffshoreHours, SrProjMgrOffshoreHours = @SrProjMgrOffshoreHours, SrProgMgrOffshoreHours = @SrProgMgrOffshoreHours, FTPStaffAugOnshoreHours = @FTPStaffAugOnshoreHours, FTPStaffAugOffshoreHours = @FTPStaffAugOffshoreHours 
		where RecNumber = 6 and RecType = 'TotalIROP'		
	update #TEMP_OUT set TotalFTEs = ( (JrSEOnshoreHours + MidSEOnshoreHours + AdvSEOnshoreHours + SenSEOnshoreHours + ConsArchOnshoreHours + ProjLeadOnshoreHours + ProjMgrOnshoreHours + ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (JrSEOffshoreHours + MidSEOffshoreHours + AdvSEOffshoreHours + SenSEOffshoreHours + ConsArchOffshoreHours + ProjLeadOffshoreHours + ProjMgrOffshoreHours + ProgMgrOffshoreHours + JrProjMgrOffshoreHours + JrProgMgrOffshoreHours) / @OffshoreFTERate), TotalFTPs = ( (FTPStaffAugOnshoreHours + FTPStaffAugOffshoreHours) / @FTPBillingRate ), ActualFTEs = ( (JrSEOnshoreHours + MidSEOnshoreHours + AdvSEOnshoreHours + SenSEOnshoreHours + ConsArchOnshoreHours + ProjLeadOnshoreHours + ProjMgrOnshoreHours + ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (JrSEOffshoreHours + MidSEOffshoreHours + AdvSEOffshoreHours + SenSEOffshoreHours + ConsArchOffshoreHours + ProjLeadOffshoreHours + ProjMgrOffshoreHours + ProgMgrOffshoreHours + JrProjMgrOffshoreHours + JrProgMgrOffshoreHours + SrProjMgrOffshoreHours + SrProgMgrOffshoreHours) / @OffshoreFTERate) + ( (FTPStaffAugOnshoreHours + FTPStaffAugOffshoreHours) / @FTPBillingRate ) 
		where RecNumber = 6 and RecType = 'TotalIROP'		
	update #TEMP_OUT set TotalHours = ( (@JrSEOnshoreHours + @MidSEOnshoreHours + @AdvSEOnshoreHours + @SenSEOnshoreHours + @ConsArchOnshoreHours + @ProjLeadOnshoreHours + @ProjMgrOnshoreHours + @ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (@JrSEOffshoreHours + @MidSEOffshoreHours + @AdvSEOffshoreHours + @SenSEOffshoreHours + @ConsArchOffshoreHours + @ProjLeadOffshoreHours + @ProjMgrOffshoreHours + @ProgMgrOffshoreHours + @JrProjMgrOffshoreHours + @JrProgMgrOffshoreHours) / @OffshoreFTERate) + ( (@FTPStaffAugOnshoreHours + @FTPStaffAugOffshoreHours) / @FTPBillingRate ), TotalFTEs = ( (@JrSEOnshoreHours + @MidSEOnshoreHours + @AdvSEOnshoreHours + @SenSEOnshoreHours + @ConsArchOnshoreHours + @ProjLeadOnshoreHours + @ProjMgrOnshoreHours + @ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (@JrSEOffshoreHours + @MidSEOffshoreHours + @AdvSEOffshoreHours + @SenSEOffshoreHours + @ConsArchOffshoreHours + @ProjLeadOffshoreHours + @ProjMgrOffshoreHours + @ProgMgrOffshoreHours + @JrProjMgrOffshoreHours + @JrProgMgrOffshoreHours) / @OffshoreFTERate), TotalFTPs = ( (@FTPStaffAugOnshoreHours + @FTPStaffAugOffshoreHours) / @FTPBillingRate ), ActualFTEs = ( (@JrSEOnshoreHours + @MidSEOnshoreHours + @AdvSEOnshoreHours + @SenSEOnshoreHours + @ConsArchOnshoreHours + @ProjLeadOnshoreHours + @ProjMgrOnshoreHours + @ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (@JrSEOffshoreHours + @MidSEOffshoreHours + @AdvSEOffshoreHours + @SenSEOffshoreHours + @ConsArchOffshoreHours + @ProjLeadOffshoreHours + @ProjMgrOffshoreHours + @ProgMgrOffshoreHours + @JrProjMgrOffshoreHours + @JrProgMgrOffshoreHours) / @OffshoreFTERate) + ( (@FTPStaffAugOnshoreHours + @FTPStaffAugOffshoreHours) / @FTPBillingRate ), COApprovedFTEs = @COApprovedFTEs, JrSEOnshoreHours = @JrSEOnshoreHours/@OnshoreFTERate, JrSEOffshoreHours = @JrSEOffshoreHours/@OffshoreFTERate, MidSEOnshoreHours = @MidSEOnshoreHours/@OnshoreFTERate, MidSEOffshoreHours = @MidSEOffshoreHours/@OffshoreFTERate, AdvSEOnshoreHours = @AdvSEOnshoreHours/@OnshoreFTERate, AdvSEOffshoreHours = @AdvSEOffshoreHours/@OffshoreFTERate, SenSEOnshoreHours = @SenSEOnshoreHours/@OnshoreFTERate, SenSEOffshoreHours = @SenSEOffshoreHours/@OffshoreFTERate, 	ConsArchOnshoreHours = @ConsArchOnshoreHours/@OnshoreFTERate, ConsArchOffshoreHours = @ConsArchOffshoreHours/@OffshoreFTERate, ProjLeadOnshoreHours = @ProjLeadOnshoreHours/@OnshoreFTERate, ProjLeadOffshoreHours = @ProjLeadOffshoreHours/@OffshoreFTERate, ProjMgrOnshoreHours = @ProjMgrOnshoreHours/@OnshoreFTERate, ProjMgrOffshoreHours = @ProjMgrOffshoreHours/@OffshoreFTERate, ProgMgrOnshoreHours = @ProgMgrOnshoreHours/@OnshoreFTERate, ProgMgrOffshoreHours = @ProgMgrOffshoreHours/@OffshoreFTERate, JrProjMgrOffshoreHours = @JrProjMgrOffshoreHours/@OffshoreFTERate, JrProgMgrOffshoreHours = @JrProgMgrOffshoreHours/@OffshoreFTERate, SrProjMgrOffshoreHours = @SrProjMgrOffshoreHours/@OffshoreFTERate, SrProgMgrOffshoreHours = @SrProgMgrOffshoreHours/@OffshoreFTERate, FTPStaffAugOnshoreHours = @FTPStaffAugOnshoreHours/@FTPBillingRate, FTPStaffAugOffshoreHours = @FTPStaffAugOffshoreHours/@FTPBillingRate 
		where RecNumber = 6 and RecType = 'TotalIROPConversion'
	end
else
	begin
	select @TotalHours = sum(isnull(TotalHours,0)), @COApprovedFTEs = sum(isnull(COApprovedFTEs,0)), @JrSEOnshoreHours = sum(isnull(JrSEOnshoreHours,0)), @JrSEOffshoreHours = sum(isnull(JrSEOffshoreHours,0)), @MidSEOnshoreHours = sum(isnull(MidSEOnshoreHours,0)), @MidSEOffshoreHours = sum(isnull(MidSEOffshoreHours,0)), @AdvSEOnshoreHours = sum(isnull(AdvSEOnshoreHours,0)), @AdvSEOffshoreHours = sum(isnull(AdvSEOffshoreHours,0)), @SenSEOnshoreHours = sum(isnull(SenSEOnshoreHours,0)), @SenSEOffshoreHours = sum(isnull(SenSEOffshoreHours,0)), @ConsArchOnshoreHours = sum(isnull(ConsArchOnshoreHours,0)), @ConsArchOffshoreHours = sum(isnull(ConsArchOffshoreHours,0)), @ProjLeadOnshoreHours = sum(isnull(ProjLeadOnshoreHours,0)), @ProjLeadOffshoreHours = sum(isnull(ProjLeadOffshoreHours,0)), @ProjMgrOnshoreHours = sum(isnull(ProjMgrOnshoreHours,0)), @ProjMgrOffshoreHours = sum(isnull(ProjMgrOffshoreHours,0)), @ProgMgrOnshoreHours = sum(isnull(ProgMgrOnshoreHours,0)), @ProgMgrOffshoreHours = sum(isnull(ProgMgrOffshoreHours,0)), @JrProjMgrOffshoreHours = sum(isnull(JrProjMgrOffshoreHours,0)), @JrProgMgrOffshoreHours = sum(isnull(JrProgMgrOffshoreHours,0)), @SrProjMgrOffshoreHours = sum(isnull(SrProjMgrOffshoreHours,0)), @SrProgMgrOffshoreHours = sum(isnull(SrProgMgrOffshoreHours,0)) from #TEMP_OUT 
		where RecNumber = 30 and ITSABillingCat = 'IROP'
	update #TEMP_OUT set TotalHours = @TotalHours, COApprovedFTEs = @COApprovedFTEs, JrSEOnshoreHours = @JrSEOnshoreHours, JrSEOffshoreHours = @JrSEOffshoreHours, MidSEOnshoreHours = @MidSEOnshoreHours, MidSEOffshoreHours = @MidSEOffshoreHours, AdvSEOnshoreHours = @AdvSEOnshoreHours, AdvSEOffshoreHours = @AdvSEOffshoreHours, SenSEOnshoreHours = @SenSEOnshoreHours, SenSEOffshoreHours = @SenSEOffshoreHours, ConsArchOnshoreHours = @ConsArchOnshoreHours, ConsArchOffshoreHours = @ConsArchOffshoreHours, ProjLeadOnshoreHours = @ProjLeadOnshoreHours, ProjLeadOffshoreHours = @ProjLeadOffshoreHours, ProjMgrOnshoreHours = @ProjMgrOnshoreHours, ProjMgrOffshoreHours = @ProjMgrOffshoreHours, ProgMgrOnshoreHours = @ProgMgrOnshoreHours, ProgMgrOffshoreHours = @ProgMgrOffshoreHours, JrProjMgrOffshoreHours = @JrProjMgrOffshoreHours, JrProgMgrOffshoreHours = @JrProgMgrOffshoreHours, SrProjMgrOffshoreHours = @SrProjMgrOffshoreHours, SrProgMgrOffshoreHours = @SrProgMgrOffshoreHours, FTPStaffAugOnshoreHours = @FTPStaffAugOnshoreHours, FTPStaffAugOffshoreHours = @FTPStaffAugOffshoreHours 
		where RecNumber = 6 and RecType = 'TotalIROP'
	update #TEMP_OUT set TotalFTEs = ( (JrSEOnshoreHours + MidSEOnshoreHours + AdvSEOnshoreHours + SenSEOnshoreHours + ConsArchOnshoreHours + ProjLeadOnshoreHours + ProjMgrOnshoreHours + ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (JrSEOffshoreHours + MidSEOffshoreHours + AdvSEOffshoreHours + SenSEOffshoreHours + ConsArchOffshoreHours + ProjLeadOffshoreHours + ProjMgrOffshoreHours + ProgMgrOffshoreHours + JrProjMgrOffshoreHours + JrProgMgrOffshoreHours) / @OffshoreFTERate), ActualFTEs = ( (JrSEOnshoreHours + MidSEOnshoreHours + AdvSEOnshoreHours + SenSEOnshoreHours + ConsArchOnshoreHours + ProjLeadOnshoreHours + ProjMgrOnshoreHours + ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (JrSEOffshoreHours + MidSEOffshoreHours + AdvSEOffshoreHours + SenSEOffshoreHours + ConsArchOffshoreHours + ProjLeadOffshoreHours + ProjMgrOffshoreHours + ProgMgrOffshoreHours + JrProjMgrOffshoreHours + JrProgMgrOffshoreHours + SrProjMgrOffshoreHours + SrProgMgrOffshoreHours) / @OffshoreFTERate) 
		where RecNumber = 6 and RecType = 'TotalIROP'	
	update #TEMP_OUT set TotalHours = ( (@JrSEOnshoreHours + @MidSEOnshoreHours + @AdvSEOnshoreHours + @SenSEOnshoreHours + @ConsArchOnshoreHours + @ProjLeadOnshoreHours + @ProjMgrOnshoreHours + @ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (@JrSEOffshoreHours + @MidSEOffshoreHours + @AdvSEOffshoreHours + @SenSEOffshoreHours + @ConsArchOffshoreHours + @ProjLeadOffshoreHours + @ProjMgrOffshoreHours + @ProgMgrOffshoreHours + @JrProjMgrOffshoreHours + @JrProgMgrOffshoreHours) / @OffshoreFTERate), TotalFTEs = ( (@JrSEOnshoreHours + @MidSEOnshoreHours + @AdvSEOnshoreHours + @SenSEOnshoreHours + @ConsArchOnshoreHours + @ProjLeadOnshoreHours + @ProjMgrOnshoreHours + @ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (@JrSEOffshoreHours + @MidSEOffshoreHours + @AdvSEOffshoreHours + @SenSEOffshoreHours + @ConsArchOffshoreHours + @ProjLeadOffshoreHours + @ProjMgrOffshoreHours + @ProgMgrOffshoreHours + @JrProjMgrOffshoreHours + @JrProgMgrOffshoreHours) / @OffshoreFTERate), ActualFTEs = ( (@JrSEOnshoreHours + @MidSEOnshoreHours + @AdvSEOnshoreHours + @SenSEOnshoreHours + @ConsArchOnshoreHours + @ProjLeadOnshoreHours + @ProjMgrOnshoreHours + @ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (@JrSEOffshoreHours + @MidSEOffshoreHours + @AdvSEOffshoreHours + @SenSEOffshoreHours + @ConsArchOffshoreHours + @ProjLeadOffshoreHours + @ProjMgrOffshoreHours + @ProgMgrOffshoreHours + @JrProjMgrOffshoreHours + @JrProgMgrOffshoreHours) / @OffshoreFTERate), COApprovedFTEs = @COApprovedFTEs, JrSEOnshoreHours = @JrSEOnshoreHours/@OnshoreFTERate, JrSEOffshoreHours = @JrSEOffshoreHours/@OffshoreFTERate, MidSEOnshoreHours = @MidSEOnshoreHours/@OnshoreFTERate, MidSEOffshoreHours = @MidSEOffshoreHours/@OffshoreFTERate, AdvSEOnshoreHours = @AdvSEOnshoreHours/@OnshoreFTERate, AdvSEOffshoreHours = @AdvSEOffshoreHours/@OffshoreFTERate, SenSEOnshoreHours = @SenSEOnshoreHours/@OnshoreFTERate, SenSEOffshoreHours = @SenSEOffshoreHours/@OffshoreFTERate, ConsArchOnshoreHours = @ConsArchOnshoreHours/@OnshoreFTERate, ConsArchOffshoreHours = @ConsArchOffshoreHours/@OffshoreFTERate, ProjLeadOnshoreHours = @ProjLeadOnshoreHours/@OnshoreFTERate, ProjLeadOffshoreHours = @ProjLeadOffshoreHours/@OffshoreFTERate, ProjMgrOnshoreHours = @ProjMgrOnshoreHours/@OnshoreFTERate, ProjMgrOffshoreHours = @ProjMgrOffshoreHours/@OffshoreFTERate, ProgMgrOnshoreHours = @ProgMgrOnshoreHours/@OnshoreFTERate, ProgMgrOffshoreHours = @ProgMgrOffshoreHours/@OffshoreFTERate, JrProjMgrOffshoreHours = @JrProjMgrOffshoreHours/@OffshoreFTERate, JrProgMgrOffshoreHours = @JrProgMgrOffshoreHours/@OffshoreFTERate, SrProjMgrOffshoreHours = @SrProjMgrOffshoreHours/@OffshoreFTERate, SrProgMgrOffshoreHours = @SrProgMgrOffshoreHours/@OffshoreFTERate
		where RecNumber = 6 and RecType = 'TotalIROPConversion'
	end
update #TEMP_OUT set EDSVariance = ActualFTEs - COApprovedFTEs where RecNumber = 6 and RecType in ('TotalIROP','TotalIROPConversion')

-- Calculate and Populate the 7 records (Total Staff Augmentation)
if ( @ITSABillingCatSelection = '-1' )
	begin
	select @TotalHours = sum(isnull(TotalHours,0)), @COApprovedFTEs = sum(isnull(COApprovedFTEs,0)), @JrSEOnshoreHours = sum(isnull(JrSEOnshoreHours,0)), @JrSEOffshoreHours = sum(isnull(JrSEOffshoreHours,0)), @MidSEOnshoreHours = sum(isnull(MidSEOnshoreHours,0)), @MidSEOffshoreHours = sum(isnull(MidSEOffshoreHours,0)), @AdvSEOnshoreHours = sum(isnull(AdvSEOnshoreHours,0)), @AdvSEOffshoreHours = sum(isnull(AdvSEOffshoreHours,0)), @SenSEOnshoreHours = sum(isnull(SenSEOnshoreHours,0)), @SenSEOffshoreHours = sum(isnull(SenSEOffshoreHours,0)), @ConsArchOnshoreHours = sum(isnull(ConsArchOnshoreHours,0)), @ConsArchOffshoreHours = sum(isnull(ConsArchOffshoreHours,0)), @ProjLeadOnshoreHours = sum(isnull(ProjLeadOnshoreHours,0)), @ProjLeadOffshoreHours = sum(isnull(ProjLeadOffshoreHours,0)), @ProjMgrOnshoreHours = sum(isnull(ProjMgrOnshoreHours,0)), @ProjMgrOffshoreHours = sum(isnull(ProjMgrOffshoreHours,0)), @ProgMgrOnshoreHours = sum(isnull(ProgMgrOnshoreHours,0)), @ProgMgrOffshoreHours = sum(isnull(ProgMgrOffshoreHours,0)), @JrProjMgrOffshoreHours = sum(isnull(JrProjMgrOffshoreHours,0)), @JrProgMgrOffshoreHours = sum(isnull(JrProgMgrOffshoreHours,0)), @SrProjMgrOffshoreHours = sum(isnull(SrProjMgrOffshoreHours,0)), @SrProgMgrOffshoreHours = sum(isnull(SrProgMgrOffshoreHours,0)), @FTPStaffAugOnshoreHours = sum(isnull(FTPStaffAugOnshoreHours,0)), @FTPStaffAugOffshoreHours = sum(isnull(FTPStaffAugOffshoreHours,0)) from #TEMP_OUT 
		where RecNumber = 30 and ITSABillingCat = 'Staff Aug'
	update #TEMP_OUT set TotalHours = @TotalHours, COApprovedFTEs = @COApprovedFTEs, JrSEOnshoreHours = @JrSEOnshoreHours, JrSEOffshoreHours = @JrSEOffshoreHours, MidSEOnshoreHours = @MidSEOnshoreHours, MidSEOffshoreHours = @MidSEOffshoreHours, AdvSEOnshoreHours = @AdvSEOnshoreHours, AdvSEOffshoreHours = @AdvSEOffshoreHours, SenSEOnshoreHours = @SenSEOnshoreHours, SenSEOffshoreHours = @SenSEOffshoreHours, ConsArchOnshoreHours = @ConsArchOnshoreHours, ConsArchOffshoreHours = @ConsArchOffshoreHours, ProjLeadOnshoreHours = @ProjLeadOnshoreHours, ProjLeadOffshoreHours = @ProjLeadOffshoreHours, ProjMgrOnshoreHours = @ProjMgrOnshoreHours, ProjMgrOffshoreHours = @ProjMgrOffshoreHours, ProgMgrOnshoreHours = @ProgMgrOnshoreHours, ProgMgrOffshoreHours = @ProgMgrOffshoreHours, JrProjMgrOffshoreHours = @JrProjMgrOffshoreHours, JrProgMgrOffshoreHours = @JrProgMgrOffshoreHours, SrProjMgrOffshoreHours = @SrProjMgrOffshoreHours, SrProgMgrOffshoreHours = @SrProgMgrOffshoreHours, FTPStaffAugOnshoreHours = @FTPStaffAugOnshoreHours, FTPStaffAugOffshoreHours = @FTPStaffAugOffshoreHours 
		where RecNumber = 7 and RecType = 'TotalStaffAug'		
	update #TEMP_OUT set TotalFTEs = ( (JrSEOnshoreHours + MidSEOnshoreHours + AdvSEOnshoreHours + SenSEOnshoreHours + ConsArchOnshoreHours + ProjLeadOnshoreHours + ProjMgrOnshoreHours + ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (JrSEOffshoreHours + MidSEOffshoreHours + AdvSEOffshoreHours + SenSEOffshoreHours + ConsArchOffshoreHours + ProjLeadOffshoreHours + ProjMgrOffshoreHours + ProgMgrOffshoreHours + JrProjMgrOffshoreHours + JrProgMgrOffshoreHours) / @OffshoreFTERate), TotalFTPs = ( (FTPStaffAugOnshoreHours + FTPStaffAugOffshoreHours) / @FTPBillingRate ), ActualFTEs = ( (JrSEOnshoreHours + MidSEOnshoreHours + AdvSEOnshoreHours + SenSEOnshoreHours + ConsArchOnshoreHours + ProjLeadOnshoreHours + ProjMgrOnshoreHours + ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (JrSEOffshoreHours + MidSEOffshoreHours + AdvSEOffshoreHours + SenSEOffshoreHours + ConsArchOffshoreHours + ProjLeadOffshoreHours + ProjMgrOffshoreHours + ProgMgrOffshoreHours + JrProjMgrOffshoreHours + JrProgMgrOffshoreHours + SrProjMgrOffshoreHours + SrProgMgrOffshoreHours) / @OffshoreFTERate) + ( (FTPStaffAugOnshoreHours + FTPStaffAugOffshoreHours) / @FTPBillingRate ) 
		where RecNumber = 7 and RecType = 'TotalStaffAug'	
	update #TEMP_OUT set TotalHours = ( (@JrSEOnshoreHours + @MidSEOnshoreHours + @AdvSEOnshoreHours + @SenSEOnshoreHours + @ConsArchOnshoreHours + @ProjLeadOnshoreHours + @ProjMgrOnshoreHours + @ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (@JrSEOffshoreHours + @MidSEOffshoreHours + @AdvSEOffshoreHours + @SenSEOffshoreHours + @ConsArchOffshoreHours + @ProjLeadOffshoreHours + @ProjMgrOffshoreHours + @ProgMgrOffshoreHours + @JrProjMgrOffshoreHours + @JrProgMgrOffshoreHours) / @OffshoreFTERate) + ( (@FTPStaffAugOnshoreHours + @FTPStaffAugOffshoreHours) / @FTPBillingRate ), TotalFTEs = ( (@JrSEOnshoreHours + @MidSEOnshoreHours + @AdvSEOnshoreHours + @SenSEOnshoreHours + @ConsArchOnshoreHours + @ProjLeadOnshoreHours + @ProjMgrOnshoreHours + @ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (@JrSEOffshoreHours + @MidSEOffshoreHours + @AdvSEOffshoreHours + @SenSEOffshoreHours + @ConsArchOffshoreHours + @ProjLeadOffshoreHours + @ProjMgrOffshoreHours + @ProgMgrOffshoreHours + @JrProjMgrOffshoreHours + @JrProgMgrOffshoreHours) / @OffshoreFTERate), TotalFTPs = ( (@FTPStaffAugOnshoreHours + @FTPStaffAugOffshoreHours) / @FTPBillingRate ), ActualFTEs = ( (@JrSEOnshoreHours + @MidSEOnshoreHours + @AdvSEOnshoreHours + @SenSEOnshoreHours + @ConsArchOnshoreHours + @ProjLeadOnshoreHours + @ProjMgrOnshoreHours + @ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (@JrSEOffshoreHours + @MidSEOffshoreHours + @AdvSEOffshoreHours + @SenSEOffshoreHours + @ConsArchOffshoreHours + @ProjLeadOffshoreHours + @ProjMgrOffshoreHours + @ProgMgrOffshoreHours + @JrProjMgrOffshoreHours + @JrProgMgrOffshoreHours) / @OffshoreFTERate) + ( (@FTPStaffAugOnshoreHours + @FTPStaffAugOffshoreHours) / @FTPBillingRate ), COApprovedFTEs = @COApprovedFTEs, JrSEOnshoreHours = @JrSEOnshoreHours/@OnshoreFTERate, JrSEOffshoreHours = @JrSEOffshoreHours/@OffshoreFTERate, MidSEOnshoreHours = @MidSEOnshoreHours/@OnshoreFTERate, MidSEOffshoreHours = @MidSEOffshoreHours/@OffshoreFTERate, AdvSEOnshoreHours = @AdvSEOnshoreHours/@OnshoreFTERate, AdvSEOffshoreHours = @AdvSEOffshoreHours/@OffshoreFTERate, SenSEOnshoreHours = @SenSEOnshoreHours/@OnshoreFTERate, SenSEOffshoreHours = @SenSEOffshoreHours/@OffshoreFTERate, 	ConsArchOnshoreHours = @ConsArchOnshoreHours/@OnshoreFTERate, ConsArchOffshoreHours = @ConsArchOffshoreHours/@OffshoreFTERate, ProjLeadOnshoreHours = @ProjLeadOnshoreHours/@OnshoreFTERate, ProjLeadOffshoreHours = @ProjLeadOffshoreHours/@OffshoreFTERate, ProjMgrOnshoreHours = @ProjMgrOnshoreHours/@OnshoreFTERate, ProjMgrOffshoreHours = @ProjMgrOffshoreHours/@OffshoreFTERate, ProgMgrOnshoreHours = @ProgMgrOnshoreHours/@OnshoreFTERate, ProgMgrOffshoreHours = @ProgMgrOffshoreHours/@OffshoreFTERate, JrProjMgrOffshoreHours = @JrProjMgrOffshoreHours/@OffshoreFTERate, JrProgMgrOffshoreHours = @JrProgMgrOffshoreHours/@OffshoreFTERate, SrProjMgrOffshoreHours = @SrProjMgrOffshoreHours/@OffshoreFTERate, SrProgMgrOffshoreHours = @SrProgMgrOffshoreHours/@OffshoreFTERate, FTPStaffAugOnshoreHours = @FTPStaffAugOnshoreHours/@FTPBillingRate, FTPStaffAugOffshoreHours = @FTPStaffAugOffshoreHours/@FTPBillingRate 
		where RecNumber = 7 and RecType = 'TotalStafAugConversion'
	end
else
	begin
	select @TotalHours = sum(isnull(TotalHours,0)), @COApprovedFTEs = sum(isnull(COApprovedFTEs,0)), @JrSEOnshoreHours = sum(isnull(JrSEOnshoreHours,0)), @JrSEOffshoreHours = sum(isnull(JrSEOffshoreHours,0)), @MidSEOnshoreHours = sum(isnull(MidSEOnshoreHours,0)), @MidSEOffshoreHours = sum(isnull(MidSEOffshoreHours,0)), @AdvSEOnshoreHours = sum(isnull(AdvSEOnshoreHours,0)), @AdvSEOffshoreHours = sum(isnull(AdvSEOffshoreHours,0)), @SenSEOnshoreHours = sum(isnull(SenSEOnshoreHours,0)), @SenSEOffshoreHours = sum(isnull(SenSEOffshoreHours,0)), @ConsArchOnshoreHours = sum(isnull(ConsArchOnshoreHours,0)), @ConsArchOffshoreHours = sum(isnull(ConsArchOffshoreHours,0)), @ProjLeadOnshoreHours = sum(isnull(ProjLeadOnshoreHours,0)), @ProjLeadOffshoreHours = sum(isnull(ProjLeadOffshoreHours,0)), @ProjMgrOnshoreHours = sum(isnull(ProjMgrOnshoreHours,0)), @ProjMgrOffshoreHours = sum(isnull(ProjMgrOffshoreHours,0)), @ProgMgrOnshoreHours = sum(isnull(ProgMgrOnshoreHours,0)), @ProgMgrOffshoreHours = sum(isnull(ProgMgrOffshoreHours,0)), @JrProjMgrOffshoreHours = sum(isnull(JrProjMgrOffshoreHours,0)), @JrProgMgrOffshoreHours = sum(isnull(JrProgMgrOffshoreHours,0)), @SrProjMgrOffshoreHours = sum(isnull(SrProjMgrOffshoreHours,0)), @SrProgMgrOffshoreHours = sum(isnull(SrProgMgrOffshoreHours,0)) from #TEMP_OUT 
		where RecNumber = 30 and ITSABillingCat = 'Staff Aug'
	update #TEMP_OUT set TotalHours = @TotalHours, COApprovedFTEs = @COApprovedFTEs, JrSEOnshoreHours = @JrSEOnshoreHours, JrSEOffshoreHours = @JrSEOffshoreHours, MidSEOnshoreHours = @MidSEOnshoreHours, MidSEOffshoreHours = @MidSEOffshoreHours, AdvSEOnshoreHours = @AdvSEOnshoreHours, AdvSEOffshoreHours = @AdvSEOffshoreHours, SenSEOnshoreHours = @SenSEOnshoreHours, SenSEOffshoreHours = @SenSEOffshoreHours, ConsArchOnshoreHours = @ConsArchOnshoreHours, ConsArchOffshoreHours = @ConsArchOffshoreHours, ProjLeadOnshoreHours = @ProjLeadOnshoreHours, ProjLeadOffshoreHours = @ProjLeadOffshoreHours, ProjMgrOnshoreHours = @ProjMgrOnshoreHours, ProjMgrOffshoreHours = @ProjMgrOffshoreHours, ProgMgrOnshoreHours = @ProgMgrOnshoreHours, ProgMgrOffshoreHours = @ProgMgrOffshoreHours, JrProjMgrOffshoreHours = @JrProjMgrOffshoreHours, JrProgMgrOffshoreHours = @JrProgMgrOffshoreHours, SrProjMgrOffshoreHours = @SrProjMgrOffshoreHours, SrProgMgrOffshoreHours = @SrProgMgrOffshoreHours, FTPStaffAugOnshoreHours = @FTPStaffAugOnshoreHours, FTPStaffAugOffshoreHours = @FTPStaffAugOffshoreHours 
		where RecNumber = 7 and RecType = 'TotalStaffAug'
	update #TEMP_OUT set TotalFTEs = ( (JrSEOnshoreHours + MidSEOnshoreHours + AdvSEOnshoreHours + SenSEOnshoreHours + ConsArchOnshoreHours + ProjLeadOnshoreHours + ProjMgrOnshoreHours + ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (JrSEOffshoreHours + MidSEOffshoreHours + AdvSEOffshoreHours + SenSEOffshoreHours + ConsArchOffshoreHours + ProjLeadOffshoreHours + ProjMgrOffshoreHours + ProgMgrOffshoreHours + JrProjMgrOffshoreHours + JrProgMgrOffshoreHours) / @OffshoreFTERate), ActualFTEs = ( (JrSEOnshoreHours + MidSEOnshoreHours + AdvSEOnshoreHours + SenSEOnshoreHours + ConsArchOnshoreHours + ProjLeadOnshoreHours + ProjMgrOnshoreHours + ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (JrSEOffshoreHours + MidSEOffshoreHours + AdvSEOffshoreHours + SenSEOffshoreHours + ConsArchOffshoreHours + ProjLeadOffshoreHours + ProjMgrOffshoreHours + ProgMgrOffshoreHours + JrProjMgrOffshoreHours + JrProgMgrOffshoreHours + SrProjMgrOffshoreHours + SrProgMgrOffshoreHours) / @OffshoreFTERate) 
		where RecNumber = 7 and RecType = 'TotalStaffAug'
	update #TEMP_OUT set TotalHours = ( (@JrSEOnshoreHours + @MidSEOnshoreHours + @AdvSEOnshoreHours + @SenSEOnshoreHours + @ConsArchOnshoreHours + @ProjLeadOnshoreHours + @ProjMgrOnshoreHours + @ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (@JrSEOffshoreHours + @MidSEOffshoreHours + @AdvSEOffshoreHours + @SenSEOffshoreHours + @ConsArchOffshoreHours + @ProjLeadOffshoreHours + @ProjMgrOffshoreHours + @ProgMgrOffshoreHours + @JrProjMgrOffshoreHours + @JrProgMgrOffshoreHours) / @OffshoreFTERate), TotalFTEs = ( (@JrSEOnshoreHours + @MidSEOnshoreHours + @AdvSEOnshoreHours + @SenSEOnshoreHours + @ConsArchOnshoreHours + @ProjLeadOnshoreHours + @ProjMgrOnshoreHours + @ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (@JrSEOffshoreHours + @MidSEOffshoreHours + @AdvSEOffshoreHours + @SenSEOffshoreHours + @ConsArchOffshoreHours + @ProjLeadOffshoreHours + @ProjMgrOffshoreHours + @ProgMgrOffshoreHours + @JrProjMgrOffshoreHours + @JrProgMgrOffshoreHours) / @OffshoreFTERate), ActualFTEs = ( (@JrSEOnshoreHours + @MidSEOnshoreHours + @AdvSEOnshoreHours + @SenSEOnshoreHours + @ConsArchOnshoreHours + @ProjLeadOnshoreHours + @ProjMgrOnshoreHours + @ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (@JrSEOffshoreHours + @MidSEOffshoreHours + @AdvSEOffshoreHours + @SenSEOffshoreHours + @ConsArchOffshoreHours + @ProjLeadOffshoreHours + @ProjMgrOffshoreHours + @ProgMgrOffshoreHours + @JrProjMgrOffshoreHours + @JrProgMgrOffshoreHours) / @OffshoreFTERate), COApprovedFTEs = @COApprovedFTEs, JrSEOnshoreHours = @JrSEOnshoreHours/@OnshoreFTERate, JrSEOffshoreHours = @JrSEOffshoreHours/@OffshoreFTERate, MidSEOnshoreHours = @MidSEOnshoreHours/@OnshoreFTERate, MidSEOffshoreHours = @MidSEOffshoreHours/@OffshoreFTERate, AdvSEOnshoreHours = @AdvSEOnshoreHours/@OnshoreFTERate, AdvSEOffshoreHours = @AdvSEOffshoreHours/@OffshoreFTERate, SenSEOnshoreHours = @SenSEOnshoreHours/@OnshoreFTERate, SenSEOffshoreHours = @SenSEOffshoreHours/@OffshoreFTERate, ConsArchOnshoreHours = @ConsArchOnshoreHours/@OnshoreFTERate, ConsArchOffshoreHours = @ConsArchOffshoreHours/@OffshoreFTERate, ProjLeadOnshoreHours = @ProjLeadOnshoreHours/@OnshoreFTERate, ProjLeadOffshoreHours = @ProjLeadOffshoreHours/@OffshoreFTERate, ProjMgrOnshoreHours = @ProjMgrOnshoreHours/@OnshoreFTERate, ProjMgrOffshoreHours = @ProjMgrOffshoreHours/@OffshoreFTERate, ProgMgrOnshoreHours = @ProgMgrOnshoreHours/@OnshoreFTERate, ProgMgrOffshoreHours = @ProgMgrOffshoreHours/@OffshoreFTERate, JrProjMgrOffshoreHours = @JrProjMgrOffshoreHours/@OffshoreFTERate, JrProgMgrOffshoreHours = @JrProgMgrOffshoreHours/@OffshoreFTERate, SrProjMgrOffshoreHours = @SrProjMgrOffshoreHours/@OffshoreFTERate, SrProgMgrOffshoreHours = @SrProgMgrOffshoreHours/@OffshoreFTERate
		where RecNumber = 7 and RecType = 'TotalStafAugConversion'
	end
update #TEMP_OUT set EDSVariance = ActualFTEs - COApprovedFTEs where RecNumber = 7 and RecType in ('TotalStaffAug','TotalStafAugConversion')

-- Calculate and Populate the 8 records (COSMOS Pgm)
if ( @ITSABillingCatSelection = '-1' )
	begin
	select @TotalHours = sum(isnull(TotalHours,0)), @COApprovedFTEs = sum(isnull(COApprovedFTEs,0)), @JrSEOnshoreHours = sum(isnull(JrSEOnshoreHours,0)), @JrSEOffshoreHours = sum(isnull(JrSEOffshoreHours,0)), @MidSEOnshoreHours = sum(isnull(MidSEOnshoreHours,0)), @MidSEOffshoreHours = sum(isnull(MidSEOffshoreHours,0)), @AdvSEOnshoreHours = sum(isnull(AdvSEOnshoreHours,0)), @AdvSEOffshoreHours = sum(isnull(AdvSEOffshoreHours,0)), @SenSEOnshoreHours = sum(isnull(SenSEOnshoreHours,0)), @SenSEOffshoreHours = sum(isnull(SenSEOffshoreHours,0)), @ConsArchOnshoreHours = sum(isnull(ConsArchOnshoreHours,0)), @ConsArchOffshoreHours = sum(isnull(ConsArchOffshoreHours,0)), @ProjLeadOnshoreHours = sum(isnull(ProjLeadOnshoreHours,0)), @ProjLeadOffshoreHours = sum(isnull(ProjLeadOffshoreHours,0)), @ProjMgrOnshoreHours = sum(isnull(ProjMgrOnshoreHours,0)), @ProjMgrOffshoreHours = sum(isnull(ProjMgrOffshoreHours,0)), @ProgMgrOnshoreHours = sum(isnull(ProgMgrOnshoreHours,0)), @ProgMgrOffshoreHours = sum(isnull(ProgMgrOffshoreHours,0)), @JrProjMgrOffshoreHours = sum(isnull(JrProjMgrOffshoreHours,0)), @JrProgMgrOffshoreHours = sum(isnull(JrProgMgrOffshoreHours,0)), @SrProjMgrOffshoreHours = sum(isnull(SrProjMgrOffshoreHours,0)), @SrProgMgrOffshoreHours = sum(isnull(SrProgMgrOffshoreHours,0)), @FTPStaffAugOnshoreHours = sum(isnull(FTPStaffAugOnshoreHours,0)), @FTPStaffAugOffshoreHours = sum(isnull(FTPStaffAugOffshoreHours,0)) from #TEMP_OUT 
		where RecNumber = 30 and ITSABillingCat = 'COSMOS Pgm'
	update #TEMP_OUT set TotalHours = @TotalHours, COApprovedFTEs = @COApprovedFTEs, JrSEOnshoreHours = @JrSEOnshoreHours, JrSEOffshoreHours = @JrSEOffshoreHours, MidSEOnshoreHours = @MidSEOnshoreHours, MidSEOffshoreHours = @MidSEOffshoreHours, AdvSEOnshoreHours = @AdvSEOnshoreHours, AdvSEOffshoreHours = @AdvSEOffshoreHours, SenSEOnshoreHours = @SenSEOnshoreHours, SenSEOffshoreHours = @SenSEOffshoreHours, ConsArchOnshoreHours = @ConsArchOnshoreHours, ConsArchOffshoreHours = @ConsArchOffshoreHours, ProjLeadOnshoreHours = @ProjLeadOnshoreHours, ProjLeadOffshoreHours = @ProjLeadOffshoreHours, ProjMgrOnshoreHours = @ProjMgrOnshoreHours, ProjMgrOffshoreHours = @ProjMgrOffshoreHours, ProgMgrOnshoreHours = @ProgMgrOnshoreHours, ProgMgrOffshoreHours = @ProgMgrOffshoreHours, JrProjMgrOffshoreHours = @JrProjMgrOffshoreHours, JrProgMgrOffshoreHours = @JrProgMgrOffshoreHours, SrProjMgrOffshoreHours = @SrProjMgrOffshoreHours, SrProgMgrOffshoreHours = @SrProgMgrOffshoreHours, FTPStaffAugOnshoreHours = @FTPStaffAugOnshoreHours, FTPStaffAugOffshoreHours = @FTPStaffAugOffshoreHours 
		where RecNumber = 8 and RecType = 'TotalCOSMOSPgm'
	update #TEMP_OUT set TotalFTEs = ( (JrSEOnshoreHours + MidSEOnshoreHours + AdvSEOnshoreHours + SenSEOnshoreHours + ConsArchOnshoreHours + ProjLeadOnshoreHours + ProjMgrOnshoreHours + ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (JrSEOffshoreHours + MidSEOffshoreHours + AdvSEOffshoreHours + SenSEOffshoreHours + ConsArchOffshoreHours + ProjLeadOffshoreHours + ProjMgrOffshoreHours + ProgMgrOffshoreHours + JrProjMgrOffshoreHours + JrProgMgrOffshoreHours) / @OffshoreFTERate), TotalFTPs = ( (FTPStaffAugOnshoreHours + FTPStaffAugOffshoreHours) / @FTPBillingRate ), ActualFTEs = ( (JrSEOnshoreHours + MidSEOnshoreHours + AdvSEOnshoreHours + SenSEOnshoreHours + ConsArchOnshoreHours + ProjLeadOnshoreHours + ProjMgrOnshoreHours + ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (JrSEOffshoreHours + MidSEOffshoreHours + AdvSEOffshoreHours + SenSEOffshoreHours + ConsArchOffshoreHours + ProjLeadOffshoreHours + ProjMgrOffshoreHours + ProgMgrOffshoreHours + JrProjMgrOffshoreHours + JrProgMgrOffshoreHours + SrProjMgrOffshoreHours + SrProgMgrOffshoreHours) / @OffshoreFTERate) + ( (FTPStaffAugOnshoreHours + FTPStaffAugOffshoreHours) / @FTPBillingRate ) 
		where RecNumber = 8 and RecType = 'TotalCOSMOSPgm'	
	update #TEMP_OUT set TotalHours = ( (@JrSEOnshoreHours + @MidSEOnshoreHours + @AdvSEOnshoreHours + @SenSEOnshoreHours + @ConsArchOnshoreHours + @ProjLeadOnshoreHours + @ProjMgrOnshoreHours + @ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (@JrSEOffshoreHours + @MidSEOffshoreHours + @AdvSEOffshoreHours + @SenSEOffshoreHours + @ConsArchOffshoreHours + @ProjLeadOffshoreHours + @ProjMgrOffshoreHours + @ProgMgrOffshoreHours + @JrProjMgrOffshoreHours + @JrProgMgrOffshoreHours) / @OffshoreFTERate) + ( (@FTPStaffAugOnshoreHours + @FTPStaffAugOffshoreHours) / @FTPBillingRate ), TotalFTEs = ( (@JrSEOnshoreHours + @MidSEOnshoreHours + @AdvSEOnshoreHours + @SenSEOnshoreHours + @ConsArchOnshoreHours + @ProjLeadOnshoreHours + @ProjMgrOnshoreHours + @ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (@JrSEOffshoreHours + @MidSEOffshoreHours + @AdvSEOffshoreHours + @SenSEOffshoreHours + @ConsArchOffshoreHours + @ProjLeadOffshoreHours + @ProjMgrOffshoreHours + @ProgMgrOffshoreHours + @JrProjMgrOffshoreHours + @JrProgMgrOffshoreHours) / @OffshoreFTERate), TotalFTPs = ( (@FTPStaffAugOnshoreHours + @FTPStaffAugOffshoreHours) / @FTPBillingRate ), ActualFTEs = ( (@JrSEOnshoreHours + @MidSEOnshoreHours + @AdvSEOnshoreHours + @SenSEOnshoreHours + @ConsArchOnshoreHours + @ProjLeadOnshoreHours + @ProjMgrOnshoreHours + @ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (@JrSEOffshoreHours + @MidSEOffshoreHours + @AdvSEOffshoreHours + @SenSEOffshoreHours + @ConsArchOffshoreHours + @ProjLeadOffshoreHours + @ProjMgrOffshoreHours + @ProgMgrOffshoreHours + @JrProjMgrOffshoreHours + @JrProgMgrOffshoreHours) / @OffshoreFTERate) + ( (@FTPStaffAugOnshoreHours + @FTPStaffAugOffshoreHours) / @FTPBillingRate ), COApprovedFTEs = @COApprovedFTEs, JrSEOnshoreHours = @JrSEOnshoreHours/@OnshoreFTERate, JrSEOffshoreHours = @JrSEOffshoreHours/@OffshoreFTERate, MidSEOnshoreHours = @MidSEOnshoreHours/@OnshoreFTERate, MidSEOffshoreHours = @MidSEOffshoreHours/@OffshoreFTERate, AdvSEOnshoreHours = @AdvSEOnshoreHours/@OnshoreFTERate, AdvSEOffshoreHours = @AdvSEOffshoreHours/@OffshoreFTERate, SenSEOnshoreHours = @SenSEOnshoreHours/@OnshoreFTERate, SenSEOffshoreHours = @SenSEOffshoreHours/@OffshoreFTERate, 	ConsArchOnshoreHours = @ConsArchOnshoreHours/@OnshoreFTERate, ConsArchOffshoreHours = @ConsArchOffshoreHours/@OffshoreFTERate, ProjLeadOnshoreHours = @ProjLeadOnshoreHours/@OnshoreFTERate, ProjLeadOffshoreHours = @ProjLeadOffshoreHours/@OffshoreFTERate, ProjMgrOnshoreHours = @ProjMgrOnshoreHours/@OnshoreFTERate, ProjMgrOffshoreHours = @ProjMgrOffshoreHours/@OffshoreFTERate, ProgMgrOnshoreHours = @ProgMgrOnshoreHours/@OnshoreFTERate, ProgMgrOffshoreHours = @ProgMgrOffshoreHours/@OffshoreFTERate, JrProjMgrOffshoreHours = @JrProjMgrOffshoreHours/@OffshoreFTERate, JrProgMgrOffshoreHours = @JrProgMgrOffshoreHours/@OffshoreFTERate, SrProjMgrOffshoreHours = @SrProjMgrOffshoreHours/@OffshoreFTERate, SrProgMgrOffshoreHours = @SrProgMgrOffshoreHours/@OffshoreFTERate, FTPStaffAugOnshoreHours = @FTPStaffAugOnshoreHours/@FTPBillingRate, FTPStaffAugOffshoreHours = @FTPStaffAugOffshoreHours/@FTPBillingRate 
		where RecNumber = 8 and RecType = 'TotalCOSMOSPgmConversion'
	end
else
	begin
	select @TotalHours = sum(isnull(TotalHours,0)), @COApprovedFTEs = sum(isnull(COApprovedFTEs,0)), @JrSEOnshoreHours = sum(isnull(JrSEOnshoreHours,0)), @JrSEOffshoreHours = sum(isnull(JrSEOffshoreHours,0)), @MidSEOnshoreHours = sum(isnull(MidSEOnshoreHours,0)), @MidSEOffshoreHours = sum(isnull(MidSEOffshoreHours,0)), @AdvSEOnshoreHours = sum(isnull(AdvSEOnshoreHours,0)), @AdvSEOffshoreHours = sum(isnull(AdvSEOffshoreHours,0)), @SenSEOnshoreHours = sum(isnull(SenSEOnshoreHours,0)), @SenSEOffshoreHours = sum(isnull(SenSEOffshoreHours,0)), @ConsArchOnshoreHours = sum(isnull(ConsArchOnshoreHours,0)), @ConsArchOffshoreHours = sum(isnull(ConsArchOffshoreHours,0)), @ProjLeadOnshoreHours = sum(isnull(ProjLeadOnshoreHours,0)), @ProjLeadOffshoreHours = sum(isnull(ProjLeadOffshoreHours,0)), @ProjMgrOnshoreHours = sum(isnull(ProjMgrOnshoreHours,0)), @ProjMgrOffshoreHours = sum(isnull(ProjMgrOffshoreHours,0)), @ProgMgrOnshoreHours = sum(isnull(ProgMgrOnshoreHours,0)), @ProgMgrOffshoreHours = sum(isnull(ProgMgrOffshoreHours,0)), @JrProjMgrOffshoreHours = sum(isnull(JrProjMgrOffshoreHours,0)), @JrProgMgrOffshoreHours = sum(isnull(JrProgMgrOffshoreHours,0)), @SrProjMgrOffshoreHours = sum(isnull(SrProjMgrOffshoreHours,0)), @SrProgMgrOffshoreHours = sum(isnull(SrProgMgrOffshoreHours,0)) from #TEMP_OUT 
		where RecNumber = 30 and ITSABillingCat = 'COSMOS Pgm'
	update #TEMP_OUT set TotalHours = @TotalHours, COApprovedFTEs = @COApprovedFTEs, JrSEOnshoreHours = @JrSEOnshoreHours, JrSEOffshoreHours = @JrSEOffshoreHours, MidSEOnshoreHours = @MidSEOnshoreHours, MidSEOffshoreHours = @MidSEOffshoreHours, AdvSEOnshoreHours = @AdvSEOnshoreHours, AdvSEOffshoreHours = @AdvSEOffshoreHours, SenSEOnshoreHours = @SenSEOnshoreHours, SenSEOffshoreHours = @SenSEOffshoreHours, ConsArchOnshoreHours = @ConsArchOnshoreHours, ConsArchOffshoreHours = @ConsArchOffshoreHours, ProjLeadOnshoreHours = @ProjLeadOnshoreHours, ProjLeadOffshoreHours = @ProjLeadOffshoreHours, ProjMgrOnshoreHours = @ProjMgrOnshoreHours, ProjMgrOffshoreHours = @ProjMgrOffshoreHours, ProgMgrOnshoreHours = @ProgMgrOnshoreHours, ProgMgrOffshoreHours = @ProgMgrOffshoreHours, JrProjMgrOffshoreHours = @JrProjMgrOffshoreHours, JrProgMgrOffshoreHours = @JrProgMgrOffshoreHours, SrProjMgrOffshoreHours = @SrProjMgrOffshoreHours, SrProgMgrOffshoreHours = @SrProgMgrOffshoreHours, FTPStaffAugOnshoreHours = @FTPStaffAugOnshoreHours, FTPStaffAugOffshoreHours = @FTPStaffAugOffshoreHours 
		where RecNumber = 8 and RecType = 'TotalCOSMOSPgm'
	update #TEMP_OUT set TotalFTEs = ( (JrSEOnshoreHours + MidSEOnshoreHours + AdvSEOnshoreHours + SenSEOnshoreHours + ConsArchOnshoreHours + ProjLeadOnshoreHours + ProjMgrOnshoreHours + ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (JrSEOffshoreHours + MidSEOffshoreHours + AdvSEOffshoreHours + SenSEOffshoreHours + ConsArchOffshoreHours + ProjLeadOffshoreHours + ProjMgrOffshoreHours + ProgMgrOffshoreHours + JrProjMgrOffshoreHours + JrProgMgrOffshoreHours) / @OffshoreFTERate), ActualFTEs = ( (JrSEOnshoreHours + MidSEOnshoreHours + AdvSEOnshoreHours + SenSEOnshoreHours + ConsArchOnshoreHours + ProjLeadOnshoreHours + ProjMgrOnshoreHours + ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (JrSEOffshoreHours + MidSEOffshoreHours + AdvSEOffshoreHours + SenSEOffshoreHours + ConsArchOffshoreHours + ProjLeadOffshoreHours + ProjMgrOffshoreHours + ProgMgrOffshoreHours + JrProjMgrOffshoreHours + JrProgMgrOffshoreHours + SrProjMgrOffshoreHours + SrProgMgrOffshoreHours) / @OffshoreFTERate) 
		where RecNumber = 8 and RecType = 'TotalCOSMOSPgm'
	update #TEMP_OUT set TotalHours = ( (@JrSEOnshoreHours + @MidSEOnshoreHours + @AdvSEOnshoreHours + @SenSEOnshoreHours + @ConsArchOnshoreHours + @ProjLeadOnshoreHours + @ProjMgrOnshoreHours + @ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (@JrSEOffshoreHours + @MidSEOffshoreHours + @AdvSEOffshoreHours + @SenSEOffshoreHours + @ConsArchOffshoreHours + @ProjLeadOffshoreHours + @ProjMgrOffshoreHours + @ProgMgrOffshoreHours + @JrProjMgrOffshoreHours + @JrProgMgrOffshoreHours) / @OffshoreFTERate), TotalFTEs = ( (@JrSEOnshoreHours + @MidSEOnshoreHours + @AdvSEOnshoreHours + @SenSEOnshoreHours + @ConsArchOnshoreHours + @ProjLeadOnshoreHours + @ProjMgrOnshoreHours + @ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (@JrSEOffshoreHours + @MidSEOffshoreHours + @AdvSEOffshoreHours + @SenSEOffshoreHours + @ConsArchOffshoreHours + @ProjLeadOffshoreHours + @ProjMgrOffshoreHours + @ProgMgrOffshoreHours + @JrProjMgrOffshoreHours + @JrProgMgrOffshoreHours) / @OffshoreFTERate), ActualFTEs = ( (@JrSEOnshoreHours + @MidSEOnshoreHours + @AdvSEOnshoreHours + @SenSEOnshoreHours + @ConsArchOnshoreHours + @ProjLeadOnshoreHours + @ProjMgrOnshoreHours + @ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (@JrSEOffshoreHours + @MidSEOffshoreHours + @AdvSEOffshoreHours + @SenSEOffshoreHours + @ConsArchOffshoreHours + @ProjLeadOffshoreHours + @ProjMgrOffshoreHours + @ProgMgrOffshoreHours + @JrProjMgrOffshoreHours + @JrProgMgrOffshoreHours) / @OffshoreFTERate), COApprovedFTEs = @COApprovedFTEs, JrSEOnshoreHours = @JrSEOnshoreHours/@OnshoreFTERate, JrSEOffshoreHours = @JrSEOffshoreHours/@OffshoreFTERate, MidSEOnshoreHours = @MidSEOnshoreHours/@OnshoreFTERate, MidSEOffshoreHours = @MidSEOffshoreHours/@OffshoreFTERate, AdvSEOnshoreHours = @AdvSEOnshoreHours/@OnshoreFTERate, AdvSEOffshoreHours = @AdvSEOffshoreHours/@OffshoreFTERate, SenSEOnshoreHours = @SenSEOnshoreHours/@OnshoreFTERate, SenSEOffshoreHours = @SenSEOffshoreHours/@OffshoreFTERate, ConsArchOnshoreHours = @ConsArchOnshoreHours/@OnshoreFTERate, ConsArchOffshoreHours = @ConsArchOffshoreHours/@OffshoreFTERate, ProjLeadOnshoreHours = @ProjLeadOnshoreHours/@OnshoreFTERate, ProjLeadOffshoreHours = @ProjLeadOffshoreHours/@OffshoreFTERate, ProjMgrOnshoreHours = @ProjMgrOnshoreHours/@OnshoreFTERate, ProjMgrOffshoreHours = @ProjMgrOffshoreHours/@OffshoreFTERate, ProgMgrOnshoreHours = @ProgMgrOnshoreHours/@OnshoreFTERate, ProgMgrOffshoreHours = @ProgMgrOffshoreHours/@OffshoreFTERate, JrProjMgrOffshoreHours = @JrProjMgrOffshoreHours/@OffshoreFTERate, JrProgMgrOffshoreHours = @JrProgMgrOffshoreHours/@OffshoreFTERate, SrProjMgrOffshoreHours = @SrProjMgrOffshoreHours/@OffshoreFTERate, SrProgMgrOffshoreHours = @SrProgMgrOffshoreHours/@OffshoreFTERate
	where RecNumber = 8 and RecType = 'TotalCOSMOSPgmConversion'
end
update #TEMP_OUT set EDSVariance = ActualFTEs - COApprovedFTEs where RecNumber = 8 and RecType in ('TotalCOSMOSPgm','TotalCOSMOSPgmConversion')

-- Calculate and Populate the 9 records (ACE)
if ( @ITSABillingCatSelection = '-1' )
	begin
	select @TotalHours = sum(isnull(TotalHours,0)), @COApprovedFTEs = sum(isnull(COApprovedFTEs,0)), @JrSEOnshoreHours = sum(isnull(JrSEOnshoreHours,0)), @JrSEOffshoreHours = sum(isnull(JrSEOffshoreHours,0)), @MidSEOnshoreHours = sum(isnull(MidSEOnshoreHours,0)), @MidSEOffshoreHours = sum(isnull(MidSEOffshoreHours,0)), @AdvSEOnshoreHours = sum(isnull(AdvSEOnshoreHours,0)), @AdvSEOffshoreHours = sum(isnull(AdvSEOffshoreHours,0)), @SenSEOnshoreHours = sum(isnull(SenSEOnshoreHours,0)), @SenSEOffshoreHours = sum(isnull(SenSEOffshoreHours,0)), @ConsArchOnshoreHours = sum(isnull(ConsArchOnshoreHours,0)), @ConsArchOffshoreHours = sum(isnull(ConsArchOffshoreHours,0)), @ProjLeadOnshoreHours = sum(isnull(ProjLeadOnshoreHours,0)), @ProjLeadOffshoreHours = sum(isnull(ProjLeadOffshoreHours,0)), @ProjMgrOnshoreHours = sum(isnull(ProjMgrOnshoreHours,0)), @ProjMgrOffshoreHours = sum(isnull(ProjMgrOffshoreHours,0)), @ProgMgrOnshoreHours = sum(isnull(ProgMgrOnshoreHours,0)), @ProgMgrOffshoreHours = sum(isnull(ProgMgrOffshoreHours,0)), @JrProjMgrOffshoreHours = sum(isnull(JrProjMgrOffshoreHours,0)), @JrProgMgrOffshoreHours = sum(isnull(JrProgMgrOffshoreHours,0)), @SrProjMgrOffshoreHours = sum(isnull(SrProjMgrOffshoreHours,0)), @SrProgMgrOffshoreHours = sum(isnull(SrProgMgrOffshoreHours,0)), @FTPStaffAugOnshoreHours = sum(isnull(FTPStaffAugOnshoreHours,0)), @FTPStaffAugOffshoreHours = sum(isnull(FTPStaffAugOffshoreHours,0)) from #TEMP_OUT 
		where RecNumber = 30 and ITSABillingCat = 'ACE'
	update #TEMP_OUT set TotalHours = @TotalHours, COApprovedFTEs = @COApprovedFTEs, JrSEOnshoreHours = @JrSEOnshoreHours, JrSEOffshoreHours = @JrSEOffshoreHours, MidSEOnshoreHours = @MidSEOnshoreHours, MidSEOffshoreHours = @MidSEOffshoreHours, AdvSEOnshoreHours = @AdvSEOnshoreHours, AdvSEOffshoreHours = @AdvSEOffshoreHours, SenSEOnshoreHours = @SenSEOnshoreHours, SenSEOffshoreHours = @SenSEOffshoreHours, ConsArchOnshoreHours = @ConsArchOnshoreHours, ConsArchOffshoreHours = @ConsArchOffshoreHours, ProjLeadOnshoreHours = @ProjLeadOnshoreHours, ProjLeadOffshoreHours = @ProjLeadOffshoreHours, ProjMgrOnshoreHours = @ProjMgrOnshoreHours, ProjMgrOffshoreHours = @ProjMgrOffshoreHours, ProgMgrOnshoreHours = @ProgMgrOnshoreHours, ProgMgrOffshoreHours = @ProgMgrOffshoreHours, JrProjMgrOffshoreHours = @JrProjMgrOffshoreHours, JrProgMgrOffshoreHours = @JrProgMgrOffshoreHours, SrProjMgrOffshoreHours = @SrProjMgrOffshoreHours, SrProgMgrOffshoreHours = @SrProgMgrOffshoreHours, FTPStaffAugOnshoreHours = @FTPStaffAugOnshoreHours, FTPStaffAugOffshoreHours = @FTPStaffAugOffshoreHours 
		where RecNumber = 9 and RecType = 'TotalACE'
	update #TEMP_OUT set TotalFTEs = ( (JrSEOnshoreHours + MidSEOnshoreHours + AdvSEOnshoreHours + SenSEOnshoreHours + ConsArchOnshoreHours + ProjLeadOnshoreHours + ProjMgrOnshoreHours + ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (JrSEOffshoreHours + MidSEOffshoreHours + AdvSEOffshoreHours + SenSEOffshoreHours + ConsArchOffshoreHours + ProjLeadOffshoreHours + ProjMgrOffshoreHours + ProgMgrOffshoreHours + JrProjMgrOffshoreHours + JrProgMgrOffshoreHours) / @OffshoreFTERate), TotalFTPs = ( (FTPStaffAugOnshoreHours + FTPStaffAugOffshoreHours) / @FTPBillingRate ), ActualFTEs = ( (JrSEOnshoreHours + MidSEOnshoreHours + AdvSEOnshoreHours + SenSEOnshoreHours + ConsArchOnshoreHours + ProjLeadOnshoreHours + ProjMgrOnshoreHours + ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (JrSEOffshoreHours + MidSEOffshoreHours + AdvSEOffshoreHours + SenSEOffshoreHours + ConsArchOffshoreHours + ProjLeadOffshoreHours + ProjMgrOffshoreHours + ProgMgrOffshoreHours + JrProjMgrOffshoreHours + JrProgMgrOffshoreHours + SrProjMgrOffshoreHours + SrProgMgrOffshoreHours) / @OffshoreFTERate) + ( (FTPStaffAugOnshoreHours + FTPStaffAugOffshoreHours) / @FTPBillingRate ) 
		where RecNumber = 9 and RecType = 'TotalACE'	
	update #TEMP_OUT set TotalHours = ( (@JrSEOnshoreHours + @MidSEOnshoreHours + @AdvSEOnshoreHours + @SenSEOnshoreHours + @ConsArchOnshoreHours + @ProjLeadOnshoreHours + @ProjMgrOnshoreHours + @ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (@JrSEOffshoreHours + @MidSEOffshoreHours + @AdvSEOffshoreHours + @SenSEOffshoreHours + @ConsArchOffshoreHours + @ProjLeadOffshoreHours + @ProjMgrOffshoreHours + @ProgMgrOffshoreHours + @JrProjMgrOffshoreHours + @JrProgMgrOffshoreHours) / @OffshoreFTERate) + ( (@FTPStaffAugOnshoreHours + @FTPStaffAugOffshoreHours) / @FTPBillingRate ), TotalFTEs = ( (@JrSEOnshoreHours + @MidSEOnshoreHours + @AdvSEOnshoreHours + @SenSEOnshoreHours + @ConsArchOnshoreHours + @ProjLeadOnshoreHours + @ProjMgrOnshoreHours + @ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (@JrSEOffshoreHours + @MidSEOffshoreHours + @AdvSEOffshoreHours + @SenSEOffshoreHours + @ConsArchOffshoreHours + @ProjLeadOffshoreHours + @ProjMgrOffshoreHours + @ProgMgrOffshoreHours + @JrProjMgrOffshoreHours + @JrProgMgrOffshoreHours) / @OffshoreFTERate), TotalFTPs = ( (@FTPStaffAugOnshoreHours + @FTPStaffAugOffshoreHours) / @FTPBillingRate ), ActualFTEs = ( (@JrSEOnshoreHours + @MidSEOnshoreHours + @AdvSEOnshoreHours + @SenSEOnshoreHours + @ConsArchOnshoreHours + @ProjLeadOnshoreHours + @ProjMgrOnshoreHours + @ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (@JrSEOffshoreHours + @MidSEOffshoreHours + @AdvSEOffshoreHours + @SenSEOffshoreHours + @ConsArchOffshoreHours + @ProjLeadOffshoreHours + @ProjMgrOffshoreHours + @ProgMgrOffshoreHours + @JrProjMgrOffshoreHours + @JrProgMgrOffshoreHours) / @OffshoreFTERate) + ( (@FTPStaffAugOnshoreHours + @FTPStaffAugOffshoreHours) / @FTPBillingRate ), COApprovedFTEs = @COApprovedFTEs, JrSEOnshoreHours = @JrSEOnshoreHours/@OnshoreFTERate, JrSEOffshoreHours = @JrSEOffshoreHours/@OffshoreFTERate, MidSEOnshoreHours = @MidSEOnshoreHours/@OnshoreFTERate, MidSEOffshoreHours = @MidSEOffshoreHours/@OffshoreFTERate, AdvSEOnshoreHours = @AdvSEOnshoreHours/@OnshoreFTERate, AdvSEOffshoreHours = @AdvSEOffshoreHours/@OffshoreFTERate, SenSEOnshoreHours = @SenSEOnshoreHours/@OnshoreFTERate, SenSEOffshoreHours = @SenSEOffshoreHours/@OffshoreFTERate, 	ConsArchOnshoreHours = @ConsArchOnshoreHours/@OnshoreFTERate, ConsArchOffshoreHours = @ConsArchOffshoreHours/@OffshoreFTERate, ProjLeadOnshoreHours = @ProjLeadOnshoreHours/@OnshoreFTERate, ProjLeadOffshoreHours = @ProjLeadOffshoreHours/@OffshoreFTERate, ProjMgrOnshoreHours = @ProjMgrOnshoreHours/@OnshoreFTERate, ProjMgrOffshoreHours = @ProjMgrOffshoreHours/@OffshoreFTERate, ProgMgrOnshoreHours = @ProgMgrOnshoreHours/@OnshoreFTERate, ProgMgrOffshoreHours = @ProgMgrOffshoreHours/@OffshoreFTERate, JrProjMgrOffshoreHours = @JrProjMgrOffshoreHours/@OffshoreFTERate, JrProgMgrOffshoreHours = @JrProgMgrOffshoreHours/@OffshoreFTERate, SrProjMgrOffshoreHours = @SrProjMgrOffshoreHours/@OffshoreFTERate, SrProgMgrOffshoreHours = @SrProgMgrOffshoreHours/@OffshoreFTERate, FTPStaffAugOnshoreHours = @FTPStaffAugOnshoreHours/@FTPBillingRate, FTPStaffAugOffshoreHours = @FTPStaffAugOffshoreHours/@FTPBillingRate 
		where RecNumber = 9 and RecType = 'TotalACEConversion'
	end
else
	begin
	select @TotalHours = sum(isnull(TotalHours,0)), @COApprovedFTEs = sum(isnull(COApprovedFTEs,0)), @JrSEOnshoreHours = sum(isnull(JrSEOnshoreHours,0)), @JrSEOffshoreHours = sum(isnull(JrSEOffshoreHours,0)), @MidSEOnshoreHours = sum(isnull(MidSEOnshoreHours,0)), @MidSEOffshoreHours = sum(isnull(MidSEOffshoreHours,0)), @AdvSEOnshoreHours = sum(isnull(AdvSEOnshoreHours,0)), @AdvSEOffshoreHours = sum(isnull(AdvSEOffshoreHours,0)), @SenSEOnshoreHours = sum(isnull(SenSEOnshoreHours,0)), @SenSEOffshoreHours = sum(isnull(SenSEOffshoreHours,0)), @ConsArchOnshoreHours = sum(isnull(ConsArchOnshoreHours,0)), @ConsArchOffshoreHours = sum(isnull(ConsArchOffshoreHours,0)), @ProjLeadOnshoreHours = sum(isnull(ProjLeadOnshoreHours,0)), @ProjLeadOffshoreHours = sum(isnull(ProjLeadOffshoreHours,0)), @ProjMgrOnshoreHours = sum(isnull(ProjMgrOnshoreHours,0)), @ProjMgrOffshoreHours = sum(isnull(ProjMgrOffshoreHours,0)), @ProgMgrOnshoreHours = sum(isnull(ProgMgrOnshoreHours,0)), @ProgMgrOffshoreHours = sum(isnull(ProgMgrOffshoreHours,0)), @JrProjMgrOffshoreHours = sum(isnull(JrProjMgrOffshoreHours,0)), @JrProgMgrOffshoreHours = sum(isnull(JrProgMgrOffshoreHours,0)), @SrProjMgrOffshoreHours = sum(isnull(SrProjMgrOffshoreHours,0)), @SrProgMgrOffshoreHours = sum(isnull(SrProgMgrOffshoreHours,0)) from #TEMP_OUT 
		where RecNumber = 30 and ITSABillingCat = 'ACE'
	update #TEMP_OUT set TotalHours = @TotalHours, COApprovedFTEs = @COApprovedFTEs, JrSEOnshoreHours = @JrSEOnshoreHours, JrSEOffshoreHours = @JrSEOffshoreHours, MidSEOnshoreHours = @MidSEOnshoreHours, MidSEOffshoreHours = @MidSEOffshoreHours, AdvSEOnshoreHours = @AdvSEOnshoreHours, AdvSEOffshoreHours = @AdvSEOffshoreHours, SenSEOnshoreHours = @SenSEOnshoreHours, SenSEOffshoreHours = @SenSEOffshoreHours, ConsArchOnshoreHours = @ConsArchOnshoreHours, ConsArchOffshoreHours = @ConsArchOffshoreHours, ProjLeadOnshoreHours = @ProjLeadOnshoreHours, ProjLeadOffshoreHours = @ProjLeadOffshoreHours, ProjMgrOnshoreHours = @ProjMgrOnshoreHours, ProjMgrOffshoreHours = @ProjMgrOffshoreHours, ProgMgrOnshoreHours = @ProgMgrOnshoreHours, ProgMgrOffshoreHours = @ProgMgrOffshoreHours, JrProjMgrOffshoreHours = @JrProjMgrOffshoreHours, JrProgMgrOffshoreHours = @JrProgMgrOffshoreHours, SrProjMgrOffshoreHours = @SrProjMgrOffshoreHours, SrProgMgrOffshoreHours = @SrProgMgrOffshoreHours, FTPStaffAugOnshoreHours = @FTPStaffAugOnshoreHours, FTPStaffAugOffshoreHours = @FTPStaffAugOffshoreHours 
		where RecNumber = 9 and RecType = 'TotalACE'
	update #TEMP_OUT set TotalFTEs = ( (JrSEOnshoreHours + MidSEOnshoreHours + AdvSEOnshoreHours + SenSEOnshoreHours + ConsArchOnshoreHours + ProjLeadOnshoreHours + ProjMgrOnshoreHours + ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (JrSEOffshoreHours + MidSEOffshoreHours + AdvSEOffshoreHours + SenSEOffshoreHours + ConsArchOffshoreHours + ProjLeadOffshoreHours + ProjMgrOffshoreHours + ProgMgrOffshoreHours + JrProjMgrOffshoreHours + JrProgMgrOffshoreHours) / @OffshoreFTERate), ActualFTEs = ( (JrSEOnshoreHours + MidSEOnshoreHours + AdvSEOnshoreHours + SenSEOnshoreHours + ConsArchOnshoreHours + ProjLeadOnshoreHours + ProjMgrOnshoreHours + ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (JrSEOffshoreHours + MidSEOffshoreHours + AdvSEOffshoreHours + SenSEOffshoreHours + ConsArchOffshoreHours + ProjLeadOffshoreHours + ProjMgrOffshoreHours + ProgMgrOffshoreHours + JrProjMgrOffshoreHours + JrProgMgrOffshoreHours + SrProjMgrOffshoreHours + SrProgMgrOffshoreHours) / @OffshoreFTERate) 
		where RecNumber = 9 and RecType = 'TotalACE'
	update #TEMP_OUT set TotalHours = ( (@JrSEOnshoreHours + @MidSEOnshoreHours + @AdvSEOnshoreHours + @SenSEOnshoreHours + @ConsArchOnshoreHours + @ProjLeadOnshoreHours + @ProjMgrOnshoreHours + @ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (@JrSEOffshoreHours + @MidSEOffshoreHours + @AdvSEOffshoreHours + @SenSEOffshoreHours + @ConsArchOffshoreHours + @ProjLeadOffshoreHours + @ProjMgrOffshoreHours + @ProgMgrOffshoreHours + @JrProjMgrOffshoreHours + @JrProgMgrOffshoreHours) / @OffshoreFTERate), TotalFTEs = ( (@JrSEOnshoreHours + @MidSEOnshoreHours + @AdvSEOnshoreHours + @SenSEOnshoreHours + @ConsArchOnshoreHours + @ProjLeadOnshoreHours + @ProjMgrOnshoreHours + @ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (@JrSEOffshoreHours + @MidSEOffshoreHours + @AdvSEOffshoreHours + @SenSEOffshoreHours + @ConsArchOffshoreHours + @ProjLeadOffshoreHours + @ProjMgrOffshoreHours + @ProgMgrOffshoreHours + @JrProjMgrOffshoreHours + @JrProgMgrOffshoreHours) / @OffshoreFTERate), ActualFTEs = ( (@JrSEOnshoreHours + @MidSEOnshoreHours + @AdvSEOnshoreHours + @SenSEOnshoreHours + @ConsArchOnshoreHours + @ProjLeadOnshoreHours + @ProjMgrOnshoreHours + @ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (@JrSEOffshoreHours + @MidSEOffshoreHours + @AdvSEOffshoreHours + @SenSEOffshoreHours + @ConsArchOffshoreHours + @ProjLeadOffshoreHours + @ProjMgrOffshoreHours + @ProgMgrOffshoreHours + @JrProjMgrOffshoreHours + @JrProgMgrOffshoreHours) / @OffshoreFTERate), COApprovedFTEs = @COApprovedFTEs, JrSEOnshoreHours = @JrSEOnshoreHours/@OnshoreFTERate, JrSEOffshoreHours = @JrSEOffshoreHours/@OffshoreFTERate, MidSEOnshoreHours = @MidSEOnshoreHours/@OnshoreFTERate, MidSEOffshoreHours = @MidSEOffshoreHours/@OffshoreFTERate, AdvSEOnshoreHours = @AdvSEOnshoreHours/@OnshoreFTERate, AdvSEOffshoreHours = @AdvSEOffshoreHours/@OffshoreFTERate, SenSEOnshoreHours = @SenSEOnshoreHours/@OnshoreFTERate, SenSEOffshoreHours = @SenSEOffshoreHours/@OffshoreFTERate, ConsArchOnshoreHours = @ConsArchOnshoreHours/@OnshoreFTERate, ConsArchOffshoreHours = @ConsArchOffshoreHours/@OffshoreFTERate, ProjLeadOnshoreHours = @ProjLeadOnshoreHours/@OnshoreFTERate, ProjLeadOffshoreHours = @ProjLeadOffshoreHours/@OffshoreFTERate, ProjMgrOnshoreHours = @ProjMgrOnshoreHours/@OnshoreFTERate, ProjMgrOffshoreHours = @ProjMgrOffshoreHours/@OffshoreFTERate, ProgMgrOnshoreHours = @ProgMgrOnshoreHours/@OnshoreFTERate, ProgMgrOffshoreHours = @ProgMgrOffshoreHours/@OffshoreFTERate, JrProjMgrOffshoreHours = @JrProjMgrOffshoreHours/@OffshoreFTERate, JrProgMgrOffshoreHours = @JrProgMgrOffshoreHours/@OffshoreFTERate, SrProjMgrOffshoreHours = @SrProjMgrOffshoreHours/@OffshoreFTERate, SrProgMgrOffshoreHours = @SrProgMgrOffshoreHours/@OffshoreFTERate
		where RecNumber = 9 and RecType = 'TotalACEConversion'
	end
update #TEMP_OUT set EDSVariance = ActualFTEs - COApprovedFTEs where RecNumber = 9 and RecType in ('TotalACE','TotalACEConversion')

-- Calculate and Populate the 91 records (NDC)
if ( @ITSABillingCatSelection = '-1' )
	begin
	select @TotalHours = sum(isnull(TotalHours,0)), @COApprovedFTEs = sum(isnull(COApprovedFTEs,0)), @JrSEOnshoreHours = sum(isnull(JrSEOnshoreHours,0)), @JrSEOffshoreHours = sum(isnull(JrSEOffshoreHours,0)), @MidSEOnshoreHours = sum(isnull(MidSEOnshoreHours,0)), @MidSEOffshoreHours = sum(isnull(MidSEOffshoreHours,0)), @AdvSEOnshoreHours = sum(isnull(AdvSEOnshoreHours,0)), @AdvSEOffshoreHours = sum(isnull(AdvSEOffshoreHours,0)), @SenSEOnshoreHours = sum(isnull(SenSEOnshoreHours,0)), @SenSEOffshoreHours = sum(isnull(SenSEOffshoreHours,0)), @ConsArchOnshoreHours = sum(isnull(ConsArchOnshoreHours,0)), @ConsArchOffshoreHours = sum(isnull(ConsArchOffshoreHours,0)), @ProjLeadOnshoreHours = sum(isnull(ProjLeadOnshoreHours,0)), @ProjLeadOffshoreHours = sum(isnull(ProjLeadOffshoreHours,0)), @ProjMgrOnshoreHours = sum(isnull(ProjMgrOnshoreHours,0)), @ProjMgrOffshoreHours = sum(isnull(ProjMgrOffshoreHours,0)), @ProgMgrOnshoreHours = sum(isnull(ProgMgrOnshoreHours,0)), @ProgMgrOffshoreHours = sum(isnull(ProgMgrOffshoreHours,0)), @JrProjMgrOffshoreHours = sum(isnull(JrProjMgrOffshoreHours,0)), @JrProgMgrOffshoreHours = sum(isnull(JrProgMgrOffshoreHours,0)), @SrProjMgrOffshoreHours = sum(isnull(SrProjMgrOffshoreHours,0)), @SrProgMgrOffshoreHours = sum(isnull(SrProgMgrOffshoreHours,0)), @FTPStaffAugOnshoreHours = sum(isnull(FTPStaffAugOnshoreHours,0)), @FTPStaffAugOffshoreHours = sum(isnull(FTPStaffAugOffshoreHours,0)) from #TEMP_OUT 
		where RecNumber = 30 and ITSABillingCat = 'NDC'
	update #TEMP_OUT set TotalHours = @TotalHours, COApprovedFTEs = @COApprovedFTEs, JrSEOnshoreHours = @JrSEOnshoreHours, JrSEOffshoreHours = @JrSEOffshoreHours, MidSEOnshoreHours = @MidSEOnshoreHours, MidSEOffshoreHours = @MidSEOffshoreHours, AdvSEOnshoreHours = @AdvSEOnshoreHours, AdvSEOffshoreHours = @AdvSEOffshoreHours, SenSEOnshoreHours = @SenSEOnshoreHours, SenSEOffshoreHours = @SenSEOffshoreHours, ConsArchOnshoreHours = @ConsArchOnshoreHours, ConsArchOffshoreHours = @ConsArchOffshoreHours, ProjLeadOnshoreHours = @ProjLeadOnshoreHours, ProjLeadOffshoreHours = @ProjLeadOffshoreHours, ProjMgrOnshoreHours = @ProjMgrOnshoreHours, ProjMgrOffshoreHours = @ProjMgrOffshoreHours, ProgMgrOnshoreHours = @ProgMgrOnshoreHours, ProgMgrOffshoreHours = @ProgMgrOffshoreHours, JrProjMgrOffshoreHours = @JrProjMgrOffshoreHours, JrProgMgrOffshoreHours = @JrProgMgrOffshoreHours, SrProjMgrOffshoreHours = @SrProjMgrOffshoreHours, SrProgMgrOffshoreHours = @SrProgMgrOffshoreHours, FTPStaffAugOnshoreHours = @FTPStaffAugOnshoreHours, FTPStaffAugOffshoreHours = @FTPStaffAugOffshoreHours 
		where RecNumber = 91 and RecType = 'TotalNDC'
	update #TEMP_OUT set TotalFTEs = ( (JrSEOnshoreHours + MidSEOnshoreHours + AdvSEOnshoreHours + SenSEOnshoreHours + ConsArchOnshoreHours + ProjLeadOnshoreHours + ProjMgrOnshoreHours + ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (JrSEOffshoreHours + MidSEOffshoreHours + AdvSEOffshoreHours + SenSEOffshoreHours + ConsArchOffshoreHours + ProjLeadOffshoreHours + ProjMgrOffshoreHours + ProgMgrOffshoreHours + JrProjMgrOffshoreHours + JrProgMgrOffshoreHours) / @OffshoreFTERate), TotalFTPs = ( (FTPStaffAugOnshoreHours + FTPStaffAugOffshoreHours) / @FTPBillingRate ), ActualFTEs = ( (JrSEOnshoreHours + MidSEOnshoreHours + AdvSEOnshoreHours + SenSEOnshoreHours + ConsArchOnshoreHours + ProjLeadOnshoreHours + ProjMgrOnshoreHours + ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (JrSEOffshoreHours + MidSEOffshoreHours + AdvSEOffshoreHours + SenSEOffshoreHours + ConsArchOffshoreHours + ProjLeadOffshoreHours + ProjMgrOffshoreHours + ProgMgrOffshoreHours + JrProjMgrOffshoreHours + JrProgMgrOffshoreHours + SrProjMgrOffshoreHours + SrProgMgrOffshoreHours) / @OffshoreFTERate) + ( (FTPStaffAugOnshoreHours + FTPStaffAugOffshoreHours) / @FTPBillingRate ) 
		where RecNumber = 91 and RecType = 'TotalNDC'	
	update #TEMP_OUT set TotalHours = ( (@JrSEOnshoreHours + @MidSEOnshoreHours + @AdvSEOnshoreHours + @SenSEOnshoreHours + @ConsArchOnshoreHours + @ProjLeadOnshoreHours + @ProjMgrOnshoreHours + @ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (@JrSEOffshoreHours + @MidSEOffshoreHours + @AdvSEOffshoreHours + @SenSEOffshoreHours + @ConsArchOffshoreHours + @ProjLeadOffshoreHours + @ProjMgrOffshoreHours + @ProgMgrOffshoreHours + @JrProjMgrOffshoreHours + @JrProgMgrOffshoreHours) / @OffshoreFTERate) + ( (@FTPStaffAugOnshoreHours + @FTPStaffAugOffshoreHours) / @FTPBillingRate ), TotalFTEs = ( (@JrSEOnshoreHours + @MidSEOnshoreHours + @AdvSEOnshoreHours + @SenSEOnshoreHours + @ConsArchOnshoreHours + @ProjLeadOnshoreHours + @ProjMgrOnshoreHours + @ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (@JrSEOffshoreHours + @MidSEOffshoreHours + @AdvSEOffshoreHours + @SenSEOffshoreHours + @ConsArchOffshoreHours + @ProjLeadOffshoreHours + @ProjMgrOffshoreHours + @ProgMgrOffshoreHours + @JrProjMgrOffshoreHours + @JrProgMgrOffshoreHours) / @OffshoreFTERate), TotalFTPs = ( (@FTPStaffAugOnshoreHours + @FTPStaffAugOffshoreHours) / @FTPBillingRate ), ActualFTEs = ( (@JrSEOnshoreHours + @MidSEOnshoreHours + @AdvSEOnshoreHours + @SenSEOnshoreHours + @ConsArchOnshoreHours + @ProjLeadOnshoreHours + @ProjMgrOnshoreHours + @ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (@JrSEOffshoreHours + @MidSEOffshoreHours + @AdvSEOffshoreHours + @SenSEOffshoreHours + @ConsArchOffshoreHours + @ProjLeadOffshoreHours + @ProjMgrOffshoreHours + @ProgMgrOffshoreHours + @JrProjMgrOffshoreHours + @JrProgMgrOffshoreHours) / @OffshoreFTERate) + ( (@FTPStaffAugOnshoreHours + @FTPStaffAugOffshoreHours) / @FTPBillingRate ), COApprovedFTEs = @COApprovedFTEs, JrSEOnshoreHours = @JrSEOnshoreHours/@OnshoreFTERate, JrSEOffshoreHours = @JrSEOffshoreHours/@OffshoreFTERate, MidSEOnshoreHours = @MidSEOnshoreHours/@OnshoreFTERate, MidSEOffshoreHours = @MidSEOffshoreHours/@OffshoreFTERate, AdvSEOnshoreHours = @AdvSEOnshoreHours/@OnshoreFTERate, AdvSEOffshoreHours = @AdvSEOffshoreHours/@OffshoreFTERate, SenSEOnshoreHours = @SenSEOnshoreHours/@OnshoreFTERate, SenSEOffshoreHours = @SenSEOffshoreHours/@OffshoreFTERate, 	ConsArchOnshoreHours = @ConsArchOnshoreHours/@OnshoreFTERate, ConsArchOffshoreHours = @ConsArchOffshoreHours/@OffshoreFTERate, ProjLeadOnshoreHours = @ProjLeadOnshoreHours/@OnshoreFTERate, ProjLeadOffshoreHours = @ProjLeadOffshoreHours/@OffshoreFTERate, ProjMgrOnshoreHours = @ProjMgrOnshoreHours/@OnshoreFTERate, ProjMgrOffshoreHours = @ProjMgrOffshoreHours/@OffshoreFTERate, ProgMgrOnshoreHours = @ProgMgrOnshoreHours/@OnshoreFTERate, ProgMgrOffshoreHours = @ProgMgrOffshoreHours/@OffshoreFTERate, JrProjMgrOffshoreHours = @JrProjMgrOffshoreHours/@OffshoreFTERate, JrProgMgrOffshoreHours = @JrProgMgrOffshoreHours/@OffshoreFTERate, SrProjMgrOffshoreHours = @SrProjMgrOffshoreHours/@OffshoreFTERate, SrProgMgrOffshoreHours = @SrProgMgrOffshoreHours/@OffshoreFTERate, FTPStaffAugOnshoreHours = @FTPStaffAugOnshoreHours/@FTPBillingRate, FTPStaffAugOffshoreHours = @FTPStaffAugOffshoreHours/@FTPBillingRate 
		where RecNumber = 91 and RecType = 'TotalNDCConversion'
	end
else
	begin
	select @TotalHours = sum(isnull(TotalHours,0)), @COApprovedFTEs = sum(isnull(COApprovedFTEs,0)), @JrSEOnshoreHours = sum(isnull(JrSEOnshoreHours,0)), @JrSEOffshoreHours = sum(isnull(JrSEOffshoreHours,0)), @MidSEOnshoreHours = sum(isnull(MidSEOnshoreHours,0)), @MidSEOffshoreHours = sum(isnull(MidSEOffshoreHours,0)), @AdvSEOnshoreHours = sum(isnull(AdvSEOnshoreHours,0)), @AdvSEOffshoreHours = sum(isnull(AdvSEOffshoreHours,0)), @SenSEOnshoreHours = sum(isnull(SenSEOnshoreHours,0)), @SenSEOffshoreHours = sum(isnull(SenSEOffshoreHours,0)), @ConsArchOnshoreHours = sum(isnull(ConsArchOnshoreHours,0)), @ConsArchOffshoreHours = sum(isnull(ConsArchOffshoreHours,0)), @ProjLeadOnshoreHours = sum(isnull(ProjLeadOnshoreHours,0)), @ProjLeadOffshoreHours = sum(isnull(ProjLeadOffshoreHours,0)), @ProjMgrOnshoreHours = sum(isnull(ProjMgrOnshoreHours,0)), @ProjMgrOffshoreHours = sum(isnull(ProjMgrOffshoreHours,0)), @ProgMgrOnshoreHours = sum(isnull(ProgMgrOnshoreHours,0)), @ProgMgrOffshoreHours = sum(isnull(ProgMgrOffshoreHours,0)), @JrProjMgrOffshoreHours = sum(isnull(JrProjMgrOffshoreHours,0)), @JrProgMgrOffshoreHours = sum(isnull(JrProgMgrOffshoreHours,0)), @SrProjMgrOffshoreHours = sum(isnull(SrProjMgrOffshoreHours,0)), @SrProgMgrOffshoreHours = sum(isnull(SrProgMgrOffshoreHours,0)) from #TEMP_OUT 
		where RecNumber = 30 and ITSABillingCat = 'NDC'
	update #TEMP_OUT set TotalHours = @TotalHours, COApprovedFTEs = @COApprovedFTEs, JrSEOnshoreHours = @JrSEOnshoreHours, JrSEOffshoreHours = @JrSEOffshoreHours, MidSEOnshoreHours = @MidSEOnshoreHours, MidSEOffshoreHours = @MidSEOffshoreHours, AdvSEOnshoreHours = @AdvSEOnshoreHours, AdvSEOffshoreHours = @AdvSEOffshoreHours, SenSEOnshoreHours = @SenSEOnshoreHours, SenSEOffshoreHours = @SenSEOffshoreHours, ConsArchOnshoreHours = @ConsArchOnshoreHours, ConsArchOffshoreHours = @ConsArchOffshoreHours, ProjLeadOnshoreHours = @ProjLeadOnshoreHours, ProjLeadOffshoreHours = @ProjLeadOffshoreHours, ProjMgrOnshoreHours = @ProjMgrOnshoreHours, ProjMgrOffshoreHours = @ProjMgrOffshoreHours, ProgMgrOnshoreHours = @ProgMgrOnshoreHours, ProgMgrOffshoreHours = @ProgMgrOffshoreHours, JrProjMgrOffshoreHours = @JrProjMgrOffshoreHours, JrProgMgrOffshoreHours = @JrProgMgrOffshoreHours, SrProjMgrOffshoreHours = @SrProjMgrOffshoreHours, SrProgMgrOffshoreHours = @SrProgMgrOffshoreHours, FTPStaffAugOnshoreHours = @FTPStaffAugOnshoreHours, FTPStaffAugOffshoreHours = @FTPStaffAugOffshoreHours 
		where RecNumber = 91 and RecType = 'TotalNDC'
	update #TEMP_OUT set TotalFTEs = ( (JrSEOnshoreHours + MidSEOnshoreHours + AdvSEOnshoreHours + SenSEOnshoreHours + ConsArchOnshoreHours + ProjLeadOnshoreHours + ProjMgrOnshoreHours + ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (JrSEOffshoreHours + MidSEOffshoreHours + AdvSEOffshoreHours + SenSEOffshoreHours + ConsArchOffshoreHours + ProjLeadOffshoreHours + ProjMgrOffshoreHours + ProgMgrOffshoreHours + JrProjMgrOffshoreHours + JrProgMgrOffshoreHours) / @OffshoreFTERate), ActualFTEs = ( (JrSEOnshoreHours + MidSEOnshoreHours + AdvSEOnshoreHours + SenSEOnshoreHours + ConsArchOnshoreHours + ProjLeadOnshoreHours + ProjMgrOnshoreHours + ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (JrSEOffshoreHours + MidSEOffshoreHours + AdvSEOffshoreHours + SenSEOffshoreHours + ConsArchOffshoreHours + ProjLeadOffshoreHours + ProjMgrOffshoreHours + ProgMgrOffshoreHours + JrProjMgrOffshoreHours + JrProgMgrOffshoreHours + SrProjMgrOffshoreHours + SrProgMgrOffshoreHours) / @OffshoreFTERate) 
		where RecNumber = 91 and RecType = 'TotalNDC'
	update #TEMP_OUT set TotalHours = ( (@JrSEOnshoreHours + @MidSEOnshoreHours + @AdvSEOnshoreHours + @SenSEOnshoreHours + @ConsArchOnshoreHours + @ProjLeadOnshoreHours + @ProjMgrOnshoreHours + @ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (@JrSEOffshoreHours + @MidSEOffshoreHours + @AdvSEOffshoreHours + @SenSEOffshoreHours + @ConsArchOffshoreHours + @ProjLeadOffshoreHours + @ProjMgrOffshoreHours + @ProgMgrOffshoreHours + @JrProjMgrOffshoreHours + @JrProgMgrOffshoreHours) / @OffshoreFTERate), TotalFTEs = ( (@JrSEOnshoreHours + @MidSEOnshoreHours + @AdvSEOnshoreHours + @SenSEOnshoreHours + @ConsArchOnshoreHours + @ProjLeadOnshoreHours + @ProjMgrOnshoreHours + @ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (@JrSEOffshoreHours + @MidSEOffshoreHours + @AdvSEOffshoreHours + @SenSEOffshoreHours + @ConsArchOffshoreHours + @ProjLeadOffshoreHours + @ProjMgrOffshoreHours + @ProgMgrOffshoreHours + @JrProjMgrOffshoreHours + @JrProgMgrOffshoreHours) / @OffshoreFTERate), ActualFTEs = ( (@JrSEOnshoreHours + @MidSEOnshoreHours + @AdvSEOnshoreHours + @SenSEOnshoreHours + @ConsArchOnshoreHours + @ProjLeadOnshoreHours + @ProjMgrOnshoreHours + @ProgMgrOnshoreHours) / @OnshoreFTERate) + ( (@JrSEOffshoreHours + @MidSEOffshoreHours + @AdvSEOffshoreHours + @SenSEOffshoreHours + @ConsArchOffshoreHours + @ProjLeadOffshoreHours + @ProjMgrOffshoreHours + @ProgMgrOffshoreHours + @JrProjMgrOffshoreHours + @JrProgMgrOffshoreHours) / @OffshoreFTERate), COApprovedFTEs = @COApprovedFTEs, JrSEOnshoreHours = @JrSEOnshoreHours/@OnshoreFTERate, JrSEOffshoreHours = @JrSEOffshoreHours/@OffshoreFTERate, MidSEOnshoreHours = @MidSEOnshoreHours/@OnshoreFTERate, MidSEOffshoreHours = @MidSEOffshoreHours/@OffshoreFTERate, AdvSEOnshoreHours = @AdvSEOnshoreHours/@OnshoreFTERate, AdvSEOffshoreHours = @AdvSEOffshoreHours/@OffshoreFTERate, SenSEOnshoreHours = @SenSEOnshoreHours/@OnshoreFTERate, SenSEOffshoreHours = @SenSEOffshoreHours/@OffshoreFTERate, ConsArchOnshoreHours = @ConsArchOnshoreHours/@OnshoreFTERate, ConsArchOffshoreHours = @ConsArchOffshoreHours/@OffshoreFTERate, ProjLeadOnshoreHours = @ProjLeadOnshoreHours/@OnshoreFTERate, ProjLeadOffshoreHours = @ProjLeadOffshoreHours/@OffshoreFTERate, ProjMgrOnshoreHours = @ProjMgrOnshoreHours/@OnshoreFTERate, ProjMgrOffshoreHours = @ProjMgrOffshoreHours/@OffshoreFTERate, ProgMgrOnshoreHours = @ProgMgrOnshoreHours/@OnshoreFTERate, ProgMgrOffshoreHours = @ProgMgrOffshoreHours/@OffshoreFTERate, JrProjMgrOffshoreHours = @JrProjMgrOffshoreHours/@OffshoreFTERate, JrProgMgrOffshoreHours = @JrProgMgrOffshoreHours/@OffshoreFTERate, SrProjMgrOffshoreHours = @SrProjMgrOffshoreHours/@OffshoreFTERate, SrProgMgrOffshoreHours = @SrProgMgrOffshoreHours/@OffshoreFTERate
		where RecNumber = 91 and RecType = 'TotalNDCConversion'
	end
update #TEMP_OUT set EDSVariance = ActualFTEs - COApprovedFTEs where RecNumber = 91 and RecType in ('TotalNDC','TotalNDCConversion')
	
-- Set the Factor.
declare @Factor decimal(5,2)
if ( month(@datefrom) <> month(getdate())) or ( year(@datefrom) <> year(getdate()))
	set @Factor = 1
else
	select @Factor = convert(float, day(getdate())) / convert(float, day(DATEADD(d, -DAY(DATEADD(m,1,getdate())),DATEADD(m,1,getdate()))))

-- Remove any rows that have ZERO values in the TotalHours and the COApprovedFTEs
delete #TEMP_OUT where RecNumber in (10,20,30) and (TotalHours = 0 or TotalHours is NULL) and COApprovedFTEs = 0
delete #TEMP_OUT where (TotalHours = 0 or TotalHours is NULL) and (COApprovedFTEs = 0 or COApprovedFTEs is NULL)

----------------------------------------------------------------------------------------------------------------------

select * from #TEMP_OUT order by AutoKey


